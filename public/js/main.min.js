!function t(e,r,n){function i(a,s){if(!r[a]){if(!e[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var h=r[a]={exports:{}};e[a][0].call(h.exports,function(t){var r=e[a][1][t];return i(r?r:t)},h,h.exports,t,e,r,n)}return r[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)i(n[a]);return i}({1:[function(t,e,r){},{}],2:[function(t,e,r){r.glMatrix=t("./gl-matrix/common.js"),r.mat2=t("./gl-matrix/mat2.js"),r.mat2d=t("./gl-matrix/mat2d.js"),r.mat3=t("./gl-matrix/mat3.js"),r.mat4=t("./gl-matrix/mat4.js"),r.quat=t("./gl-matrix/quat.js"),r.vec2=t("./gl-matrix/vec2.js"),r.vec3=t("./gl-matrix/vec3.js"),r.vec4=t("./gl-matrix/vec4.js")},{"./gl-matrix/common.js":3,"./gl-matrix/mat2.js":4,"./gl-matrix/mat2d.js":5,"./gl-matrix/mat3.js":6,"./gl-matrix/mat4.js":7,"./gl-matrix/quat.js":8,"./gl-matrix/vec2.js":9,"./gl-matrix/vec3.js":10,"./gl-matrix/vec4.js":11}],3:[function(t,e,r){var n={};n.EPSILON=1e-6,n.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,n.RANDOM=Math.random,n.ENABLE_SIMD=!1,n.SIMD_AVAILABLE=n.ARRAY_TYPE===Float32Array&&"SIMD"in this,n.USE_SIMD=n.ENABLE_SIMD&&n.SIMD_AVAILABLE,n.setMatrixArrayType=function(t){n.ARRAY_TYPE=t};var i=Math.PI/180;n.toRadian=function(t){return t*i},n.equals=function(t,e){return Math.abs(t-e)<=n.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.exports=n},{}],4:[function(t,e,r){var n=t("./common.js"),i={};i.create=function(){var t=new n.ARRAY_TYPE(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},i.clone=function(t){var e=new n.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},i.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},i.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},i.fromValues=function(t,e,r,i){var o=new n.ARRAY_TYPE(4);return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o},i.set=function(t,e,r,n,i){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t},i.transpose=function(t,e){if(t===e){var r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},i.invert=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=r*o-i*n;return a?(a=1/a,t[0]=o*a,t[1]=-n*a,t[2]=-i*a,t[3]=r*a,t):null},i.adjoint=function(t,e){var r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t},i.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},i.multiply=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=r[0],u=r[1],l=r[2],h=r[3];return t[0]=n*s+o*u,t[1]=i*s+a*u,t[2]=n*l+o*h,t[3]=i*l+a*h,t},i.mul=i.multiply,i.rotate=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(r),u=Math.cos(r);return t[0]=n*u+o*s,t[1]=i*u+a*s,t[2]=n*-s+o*u,t[3]=i*-s+a*u,t},i.scale=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=r[0],u=r[1];return t[0]=n*s,t[1]=i*s,t[2]=o*u,t[3]=a*u,t},i.fromRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t},i.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},i.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},i.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))},i.LDU=function(t,e,r,n){return t[2]=n[2]/n[0],r[0]=n[0],r[1]=n[1],r[3]=n[3]-t[2]*r[1],[t,e,r]},i.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},i.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t},i.sub=i.subtract,i.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},i.equals=function(t,e){var r=t[0],i=t[1],o=t[2],a=t[3],s=e[0],u=e[1],l=e[2],h=e[3];return Math.abs(r-s)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-u)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(o-l)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(a-h)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(h))},i.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},i.multiplyScalarAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t},e.exports=i},{"./common.js":3}],5:[function(t,e,r){var n=t("./common.js"),i={};i.create=function(){var t=new n.ARRAY_TYPE(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},i.clone=function(t){var e=new n.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},i.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},i.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},i.fromValues=function(t,e,r,i,o,a){var s=new n.ARRAY_TYPE(6);return s[0]=t,s[1]=e,s[2]=r,s[3]=i,s[4]=o,s[5]=a,s},i.set=function(t,e,r,n,i,o,a){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=o,t[5]=a,t},i.invert=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=r*o-n*i;return u?(u=1/u,t[0]=o*u,t[1]=-n*u,t[2]=-i*u,t[3]=r*u,t[4]=(i*s-o*a)*u,t[5]=(n*a-r*s)*u,t):null},i.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},i.multiply=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=r[0],h=r[1],c=r[2],f=r[3],d=r[4],p=r[5];return t[0]=n*l+o*h,t[1]=i*l+a*h,t[2]=n*c+o*f,t[3]=i*c+a*f,t[4]=n*d+o*p+s,t[5]=i*d+a*p+u,t},i.mul=i.multiply,i.rotate=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=Math.sin(r),h=Math.cos(r);return t[0]=n*h+o*l,t[1]=i*h+a*l,t[2]=n*-l+o*h,t[3]=i*-l+a*h,t[4]=s,t[5]=u,t},i.scale=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=r[0],h=r[1];return t[0]=n*l,t[1]=i*l,t[2]=o*h,t[3]=a*h,t[4]=s,t[5]=u,t},i.translate=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=r[0],h=r[1];return t[0]=n,t[1]=i,t[2]=o,t[3]=a,t[4]=n*l+o*h+s,t[5]=i*l+a*h+u,t},i.fromRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t[4]=0,t[5]=0,t},i.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},i.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},i.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},i.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)},i.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t},i.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t},i.sub=i.subtract,i.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t},i.multiplyScalarAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t},i.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},i.equals=function(t,e){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=e[0],h=e[1],c=e[2],f=e[3],d=e[4],p=e[5];return Math.abs(r-l)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-h)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(o-c)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(a-f)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(s-d)<=n.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(u-p)<=n.EPSILON*Math.max(1,Math.abs(u),Math.abs(p))},e.exports=i},{"./common.js":3}],6:[function(t,e,r){var n=t("./common.js"),i={};i.create=function(){var t=new n.ARRAY_TYPE(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},i.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},i.clone=function(t){var e=new n.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},i.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},i.fromValues=function(t,e,r,i,o,a,s,u,l){var h=new n.ARRAY_TYPE(9);return h[0]=t,h[1]=e,h[2]=r,h[3]=i,h[4]=o,h[5]=a,h[6]=s,h[7]=u,h[8]=l,h},i.set=function(t,e,r,n,i,o,a,s,u,l){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t[8]=l,t},i.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},i.transpose=function(t,e){if(t===e){var r=e[1],n=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},i.invert=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],h=e[8],c=h*a-s*l,f=-h*o+s*u,d=l*o-a*u,p=r*c+n*f+i*d;return p?(p=1/p,t[0]=c*p,t[1]=(-h*n+i*l)*p,t[2]=(s*n-i*a)*p,t[3]=f*p,t[4]=(h*r-i*u)*p,t[5]=(-s*r+i*o)*p,t[6]=d*p,t[7]=(-l*r+n*u)*p,t[8]=(a*r-n*o)*p,t):null},i.adjoint=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],h=e[8];return t[0]=a*h-s*l,t[1]=i*l-n*h,t[2]=n*s-i*a,t[3]=s*u-o*h,t[4]=r*h-i*u,t[5]=i*o-r*s,t[6]=o*l-a*u,t[7]=n*u-r*l,t[8]=r*a-n*o,t},i.determinant=function(t){var e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],l=t[8];return e*(l*o-a*u)+r*(-l*i+a*s)+n*(u*i-o*s)},i.multiply=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],h=e[7],c=e[8],f=r[0],d=r[1],p=r[2],m=r[3],M=r[4],g=r[5],x=r[6],v=r[7],b=r[8];return t[0]=f*n+d*a+p*l,t[1]=f*i+d*s+p*h,t[2]=f*o+d*u+p*c,t[3]=m*n+M*a+g*l,t[4]=m*i+M*s+g*h,t[5]=m*o+M*u+g*c,t[6]=x*n+v*a+b*l,t[7]=x*i+v*s+b*h,t[8]=x*o+v*u+b*c,t},i.mul=i.multiply,i.translate=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],h=e[7],c=e[8],f=r[0],d=r[1];return t[0]=n,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=f*n+d*a+l,t[7]=f*i+d*s+h,t[8]=f*o+d*u+c,t},i.rotate=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],h=e[7],c=e[8],f=Math.sin(r),d=Math.cos(r);return t[0]=d*n+f*a,t[1]=d*i+f*s,t[2]=d*o+f*u,t[3]=d*a-f*n,t[4]=d*s-f*i,t[5]=d*u-f*o,t[6]=l,t[7]=h,t[8]=c,t},i.scale=function(t,e,r){var n=r[0],i=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},i.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},i.fromRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},i.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},i.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},i.fromQuat=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=r+r,s=n+n,u=i+i,l=r*a,h=n*a,c=n*s,f=i*a,d=i*s,p=i*u,m=o*a,M=o*s,g=o*u;return t[0]=1-c-p,t[3]=h-g,t[6]=f+M,t[1]=h+g,t[4]=1-l-p,t[7]=d-m,t[2]=f-M,t[5]=d+m,t[8]=1-l-c,t},i.normalFromMat4=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],h=e[8],c=e[9],f=e[10],d=e[11],p=e[12],m=e[13],M=e[14],g=e[15],x=r*s-n*a,v=r*u-i*a,b=r*l-o*a,S=n*u-i*s,_=n*l-o*s,I=i*l-o*u,D=h*m-c*p,F=h*M-f*p,y=h*g-d*p,w=c*M-f*m,T=c*g-d*m,E=f*g-d*M,A=x*E-v*T+b*w+S*y-_*F+I*D;return A?(A=1/A,t[0]=(s*E-u*T+l*w)*A,t[1]=(u*y-a*E-l*F)*A,t[2]=(a*T-s*y+l*D)*A,t[3]=(i*T-n*E-o*w)*A,t[4]=(r*E-i*y+o*F)*A,t[5]=(n*y-r*T-o*D)*A,t[6]=(m*I-M*_+g*S)*A,t[7]=(M*b-p*I-g*v)*A,t[8]=(p*_-m*b+g*x)*A,t):null},i.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},i.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},i.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t},i.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t},i.sub=i.subtract,i.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t},i.multiplyScalarAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t},i.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},i.equals=function(t,e){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],h=t[7],c=t[8],f=e[0],d=e[1],p=e[2],m=e[3],M=e[4],g=e[5],x=t[6],v=e[7],b=e[8];return Math.abs(r-f)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(i-d)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(o-p)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-m)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(s-M)<=n.EPSILON*Math.max(1,Math.abs(s),Math.abs(M))&&Math.abs(u-g)<=n.EPSILON*Math.max(1,Math.abs(u),Math.abs(g))&&Math.abs(l-x)<=n.EPSILON*Math.max(1,Math.abs(l),Math.abs(x))&&Math.abs(h-v)<=n.EPSILON*Math.max(1,Math.abs(h),Math.abs(v))&&Math.abs(c-b)<=n.EPSILON*Math.max(1,Math.abs(c),Math.abs(b))},e.exports=i},{"./common.js":3}],7:[function(t,e,r){var n=t("./common.js"),i={scalar:{},SIMD:{}};i.create=function(){var t=new n.ARRAY_TYPE(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},i.clone=function(t){var e=new n.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},i.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},i.fromValues=function(t,e,r,i,o,a,s,u,l,h,c,f,d,p,m,M){var g=new n.ARRAY_TYPE(16);return g[0]=t,g[1]=e,g[2]=r,g[3]=i,g[4]=o,g[5]=a,g[6]=s,g[7]=u,g[8]=l,g[9]=h,g[10]=c,g[11]=f,g[12]=d,g[13]=p,g[14]=m,g[15]=M,g},i.set=function(t,e,r,n,i,o,a,s,u,l,h,c,f,d,p,m,M){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t[8]=l,t[9]=h,t[10]=c,t[11]=f,t[12]=d,t[13]=p,t[14]=m,t[15]=M,t},i.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},i.scalar.transpose=function(t,e){if(t===e){var r=e[1],n=e[2],i=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},i.SIMD.transpose=function(t,e){var r,n,i,o,a,s,u,l,h,c;return r=SIMD.Float32x4.load(e,0),n=SIMD.Float32x4.load(e,4),i=SIMD.Float32x4.load(e,8),o=SIMD.Float32x4.load(e,12),a=SIMD.Float32x4.shuffle(r,n,0,1,4,5),s=SIMD.Float32x4.shuffle(i,o,0,1,4,5),u=SIMD.Float32x4.shuffle(a,s,0,2,4,6),l=SIMD.Float32x4.shuffle(a,s,1,3,5,7),SIMD.Float32x4.store(t,0,u),SIMD.Float32x4.store(t,4,l),a=SIMD.Float32x4.shuffle(r,n,2,3,6,7),s=SIMD.Float32x4.shuffle(i,o,2,3,6,7),h=SIMD.Float32x4.shuffle(a,s,0,2,4,6),c=SIMD.Float32x4.shuffle(a,s,1,3,5,7),SIMD.Float32x4.store(t,8,h),SIMD.Float32x4.store(t,12,c),t},i.transpose=n.USE_SIMD?i.SIMD.transpose:i.scalar.transpose,i.scalar.invert=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],h=e[8],c=e[9],f=e[10],d=e[11],p=e[12],m=e[13],M=e[14],g=e[15],x=r*s-n*a,v=r*u-i*a,b=r*l-o*a,S=n*u-i*s,_=n*l-o*s,I=i*l-o*u,D=h*m-c*p,F=h*M-f*p,y=h*g-d*p,w=c*M-f*m,T=c*g-d*m,E=f*g-d*M,A=x*E-v*T+b*w+S*y-_*F+I*D;return A?(A=1/A,t[0]=(s*E-u*T+l*w)*A,t[1]=(i*T-n*E-o*w)*A,t[2]=(m*I-M*_+g*S)*A,t[3]=(f*_-c*I-d*S)*A,t[4]=(u*y-a*E-l*F)*A,t[5]=(r*E-i*y+o*F)*A,t[6]=(M*b-p*I-g*v)*A,t[7]=(h*I-f*b+d*v)*A,t[8]=(a*T-s*y+l*D)*A,t[9]=(n*y-r*T-o*D)*A,t[10]=(p*_-m*b+g*x)*A,t[11]=(c*b-h*_-d*x)*A,t[12]=(s*F-a*w-u*D)*A,t[13]=(r*w-n*F+i*D)*A,t[14]=(m*v-p*S-M*x)*A,t[15]=(h*S-c*v+f*x)*A,t):null},i.SIMD.invert=function(t,e){var r,n,i,o,a,s,u,l,h,c,f=SIMD.Float32x4.load(e,0),d=SIMD.Float32x4.load(e,4),p=SIMD.Float32x4.load(e,8),m=SIMD.Float32x4.load(e,12);return a=SIMD.Float32x4.shuffle(f,d,0,1,4,5),n=SIMD.Float32x4.shuffle(p,m,0,1,4,5),r=SIMD.Float32x4.shuffle(a,n,0,2,4,6),n=SIMD.Float32x4.shuffle(n,a,1,3,5,7),a=SIMD.Float32x4.shuffle(f,d,2,3,6,7),o=SIMD.Float32x4.shuffle(p,m,2,3,6,7),i=SIMD.Float32x4.shuffle(a,o,0,2,4,6),o=SIMD.Float32x4.shuffle(o,a,1,3,5,7),a=SIMD.Float32x4.mul(i,o),a=SIMD.Float32x4.swizzle(a,1,0,3,2),s=SIMD.Float32x4.mul(n,a),u=SIMD.Float32x4.mul(r,a),a=SIMD.Float32x4.swizzle(a,2,3,0,1),s=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,a),s),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,a),u),u=SIMD.Float32x4.swizzle(u,2,3,0,1),a=SIMD.Float32x4.mul(n,i),a=SIMD.Float32x4.swizzle(a,1,0,3,2),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,a),s),h=SIMD.Float32x4.mul(r,a),a=SIMD.Float32x4.swizzle(a,2,3,0,1),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(o,a)),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,a),h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),a=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(n,2,3,0,1),o),a=SIMD.Float32x4.swizzle(a,1,0,3,2),i=SIMD.Float32x4.swizzle(i,2,3,0,1),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(i,a),s),l=SIMD.Float32x4.mul(r,a),a=SIMD.Float32x4.swizzle(a,2,3,0,1),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(i,a)),l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,a),l),l=SIMD.Float32x4.swizzle(l,2,3,0,1),a=SIMD.Float32x4.mul(r,n),a=SIMD.Float32x4.swizzle(a,1,0,3,2),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,a),l),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,a),h),a=SIMD.Float32x4.swizzle(a,2,3,0,1),l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,a),l),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(i,a)),a=SIMD.Float32x4.mul(r,o),a=SIMD.Float32x4.swizzle(a,1,0,3,2),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(i,a)),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,a),l),a=SIMD.Float32x4.swizzle(a,2,3,0,1),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(i,a),u),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(n,a)),a=SIMD.Float32x4.mul(r,i),a=SIMD.Float32x4.swizzle(a,1,0,3,2),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(o,a),u),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(n,a)),a=SIMD.Float32x4.swizzle(a,2,3,0,1),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(o,a)),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(n,a),h),c=SIMD.Float32x4.mul(r,s),c=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(c,2,3,0,1),c),c=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(c,1,0,3,2),c),a=SIMD.Float32x4.reciprocalApproximation(c),c=SIMD.Float32x4.sub(SIMD.Float32x4.add(a,a),SIMD.Float32x4.mul(c,SIMD.Float32x4.mul(a,a))),(c=SIMD.Float32x4.swizzle(c,0,0,0,0))?(SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(c,s)),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(c,u)),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(c,l)),SIMD.Float32x4.store(t,12,SIMD.Float32x4.mul(c,h)),t):null},i.invert=n.USE_SIMD?i.SIMD.invert:i.scalar.invert,i.scalar.adjoint=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],h=e[8],c=e[9],f=e[10],d=e[11],p=e[12],m=e[13],M=e[14],g=e[15];return t[0]=s*(f*g-d*M)-c*(u*g-l*M)+m*(u*d-l*f),t[1]=-(n*(f*g-d*M)-c*(i*g-o*M)+m*(i*d-o*f)),t[2]=n*(u*g-l*M)-s*(i*g-o*M)+m*(i*l-o*u),t[3]=-(n*(u*d-l*f)-s*(i*d-o*f)+c*(i*l-o*u)),t[4]=-(a*(f*g-d*M)-h*(u*g-l*M)+p*(u*d-l*f)),t[5]=r*(f*g-d*M)-h*(i*g-o*M)+p*(i*d-o*f),t[6]=-(r*(u*g-l*M)-a*(i*g-o*M)+p*(i*l-o*u)),t[7]=r*(u*d-l*f)-a*(i*d-o*f)+h*(i*l-o*u),t[8]=a*(c*g-d*m)-h*(s*g-l*m)+p*(s*d-l*c),t[9]=-(r*(c*g-d*m)-h*(n*g-o*m)+p*(n*d-o*c)),t[10]=r*(s*g-l*m)-a*(n*g-o*m)+p*(n*l-o*s),t[11]=-(r*(s*d-l*c)-a*(n*d-o*c)+h*(n*l-o*s)),t[12]=-(a*(c*M-f*m)-h*(s*M-u*m)+p*(s*f-u*c)),t[13]=r*(c*M-f*m)-h*(n*M-i*m)+p*(n*f-i*c),t[14]=-(r*(s*M-u*m)-a*(n*M-i*m)+p*(n*u-i*s)),t[15]=r*(s*f-u*c)-a*(n*f-i*c)+h*(n*u-i*s),t},i.SIMD.adjoint=function(t,e){var r,n,i,o,a,s,u,l,h,c,f,d,p,r=SIMD.Float32x4.load(e,0),n=SIMD.Float32x4.load(e,4),i=SIMD.Float32x4.load(e,8),o=SIMD.Float32x4.load(e,12);return h=SIMD.Float32x4.shuffle(r,n,0,1,4,5),s=SIMD.Float32x4.shuffle(i,o,0,1,4,5),a=SIMD.Float32x4.shuffle(h,s,0,2,4,6),s=SIMD.Float32x4.shuffle(s,h,1,3,5,7),h=SIMD.Float32x4.shuffle(r,n,2,3,6,7),l=SIMD.Float32x4.shuffle(i,o,2,3,6,7),u=SIMD.Float32x4.shuffle(h,l,0,2,4,6),l=SIMD.Float32x4.shuffle(l,h,1,3,5,7),h=SIMD.Float32x4.mul(u,l),h=SIMD.Float32x4.swizzle(h,1,0,3,2),c=SIMD.Float32x4.mul(s,h),f=SIMD.Float32x4.mul(a,h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,h),c),f=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,h),f),f=SIMD.Float32x4.swizzle(f,2,3,0,1),h=SIMD.Float32x4.mul(s,u),h=SIMD.Float32x4.swizzle(h,1,0,3,2),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,h),c),p=SIMD.Float32x4.mul(a,h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(l,h)),p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,h),p),p=SIMD.Float32x4.swizzle(p,2,3,0,1),h=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,2,3,0,1),l),h=SIMD.Float32x4.swizzle(h,1,0,3,2),u=SIMD.Float32x4.swizzle(u,2,3,0,1),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,h),c),d=SIMD.Float32x4.mul(a,h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(u,h)),d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,h),d),d=SIMD.Float32x4.swizzle(d,2,3,0,1),h=SIMD.Float32x4.mul(a,s),h=SIMD.Float32x4.swizzle(h,1,0,3,2),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,h),d),p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(u,h),p),h=SIMD.Float32x4.swizzle(h,2,3,0,1),d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(l,h),d),p=SIMD.Float32x4.sub(p,SIMD.Float32x4.mul(u,h)),h=SIMD.Float32x4.mul(a,l),h=SIMD.Float32x4.swizzle(h,1,0,3,2),f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(u,h)),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,h),d),h=SIMD.Float32x4.swizzle(h,2,3,0,1),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,h),f),d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(s,h)),h=SIMD.Float32x4.mul(a,u),h=SIMD.Float32x4.swizzle(h,1,0,3,2),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,h),f),p=SIMD.Float32x4.sub(p,SIMD.Float32x4.mul(s,h)),h=SIMD.Float32x4.swizzle(h,2,3,0,1),f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(l,h)),p=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,h),p),SIMD.Float32x4.store(t,0,c),SIMD.Float32x4.store(t,4,f),SIMD.Float32x4.store(t,8,d),SIMD.Float32x4.store(t,12,p),t},i.adjoint=n.USE_SIMD?i.SIMD.adjoint:i.scalar.adjoint,i.determinant=function(t){var e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],l=t[8],h=t[9],c=t[10],f=t[11],d=t[12],p=t[13],m=t[14],M=t[15],g=e*a-r*o,x=e*s-n*o,v=e*u-i*o,b=r*s-n*a,S=r*u-i*a,_=n*u-i*s,I=l*p-h*d,D=l*m-c*d,F=l*M-f*d,y=h*m-c*p,w=h*M-f*p,T=c*M-f*m;return g*T-x*w+v*y+b*F-S*D+_*I},i.SIMD.multiply=function(t,e,r){var n=SIMD.Float32x4.load(e,0),i=SIMD.Float32x4.load(e,4),o=SIMD.Float32x4.load(e,8),a=SIMD.Float32x4.load(e,12),s=SIMD.Float32x4.load(r,0),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,0,0,0,0),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,1,1,1,1),i),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,3,3,3,3),a))));SIMD.Float32x4.store(t,0,u);var l=SIMD.Float32x4.load(r,4),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,0,0,0,0),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,1,1,1,1),i),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(l,3,3,3,3),a))));SIMD.Float32x4.store(t,4,h);var c=SIMD.Float32x4.load(r,8),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,0,0,0,0),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,1,1,1,1),i),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,3,3,3,3),a))));SIMD.Float32x4.store(t,8,f);var d=SIMD.Float32x4.load(r,12),p=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,0,0,0,0),n),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,1,1,1,1),i),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,2,2,2,2),o),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,3,3,3,3),a))));return SIMD.Float32x4.store(t,12,p),t},i.scalar.multiply=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],h=e[7],c=e[8],f=e[9],d=e[10],p=e[11],m=e[12],M=e[13],g=e[14],x=e[15],v=r[0],b=r[1],S=r[2],_=r[3];return t[0]=v*n+b*s+S*c+_*m,t[1]=v*i+b*u+S*f+_*M,t[2]=v*o+b*l+S*d+_*g,t[3]=v*a+b*h+S*p+_*x,v=r[4],b=r[5],S=r[6],_=r[7],t[4]=v*n+b*s+S*c+_*m,t[5]=v*i+b*u+S*f+_*M,t[6]=v*o+b*l+S*d+_*g,t[7]=v*a+b*h+S*p+_*x,v=r[8],b=r[9],S=r[10],_=r[11],t[8]=v*n+b*s+S*c+_*m,t[9]=v*i+b*u+S*f+_*M,t[10]=v*o+b*l+S*d+_*g,t[11]=v*a+b*h+S*p+_*x,v=r[12],b=r[13],S=r[14],_=r[15],t[12]=v*n+b*s+S*c+_*m,t[13]=v*i+b*u+S*f+_*M,t[14]=v*o+b*l+S*d+_*g,t[15]=v*a+b*h+S*p+_*x,t},i.multiply=n.USE_SIMD?i.SIMD.multiply:i.scalar.multiply,i.mul=i.multiply,i.scalar.translate=function(t,e,r){var n,i,o,a,s,u,l,h,c,f,d,p,m=r[0],M=r[1],g=r[2];return e===t?(t[12]=e[0]*m+e[4]*M+e[8]*g+e[12],t[13]=e[1]*m+e[5]*M+e[9]*g+e[13],t[14]=e[2]*m+e[6]*M+e[10]*g+e[14],t[15]=e[3]*m+e[7]*M+e[11]*g+e[15]):(n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],h=e[7],c=e[8],f=e[9],d=e[10],p=e[11],t[0]=n,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=l,t[7]=h,t[8]=c,t[9]=f,t[10]=d,t[11]=p,t[12]=n*m+s*M+c*g+e[12],t[13]=i*m+u*M+f*g+e[13],t[14]=o*m+l*M+d*g+e[14],t[15]=a*m+h*M+p*g+e[15]),t},i.SIMD.translate=function(t,e,r){var n=SIMD.Float32x4.load(e,0),i=SIMD.Float32x4.load(e,4),o=SIMD.Float32x4.load(e,8),a=SIMD.Float32x4.load(e,12),s=SIMD.Float32x4(r[0],r[1],r[2],0);e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11]),n=SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(s,0,0,0,0)),i=SIMD.Float32x4.mul(i,SIMD.Float32x4.swizzle(s,1,1,1,1)),o=SIMD.Float32x4.mul(o,SIMD.Float32x4.swizzle(s,2,2,2,2));var u=SIMD.Float32x4.add(n,SIMD.Float32x4.add(i,SIMD.Float32x4.add(o,a)));return SIMD.Float32x4.store(t,12,u),t},i.translate=n.USE_SIMD?i.SIMD.translate:i.scalar.translate,i.scalar.scale=function(t,e,r){var n=r[0],i=r[1],o=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},i.SIMD.scale=function(t,e,r){var n,i,o,a=SIMD.Float32x4(r[0],r[1],r[2],0);return n=SIMD.Float32x4.load(e,0),SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(n,SIMD.Float32x4.swizzle(a,0,0,0,0))),i=SIMD.Float32x4.load(e,4),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(i,SIMD.Float32x4.swizzle(a,1,1,1,1))),o=SIMD.Float32x4.load(e,8),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(o,SIMD.Float32x4.swizzle(a,2,2,2,2))),t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},i.scale=n.USE_SIMD?i.SIMD.scale:i.scalar.scale,i.rotate=function(t,e,r,i){var o,a,s,u,l,h,c,f,d,p,m,M,g,x,v,b,S,_,I,D,F,y,w,T,E=i[0],A=i[1],R=i[2],P=Math.sqrt(E*E+A*A+R*R);return Math.abs(P)<n.EPSILON?null:(P=1/P,E*=P,A*=P,R*=P,o=Math.sin(r),a=Math.cos(r),s=1-a,u=e[0],l=e[1],h=e[2],c=e[3],f=e[4],d=e[5],p=e[6],m=e[7],M=e[8],g=e[9],x=e[10],v=e[11],b=E*E*s+a,S=A*E*s+R*o,_=R*E*s-A*o,I=E*A*s-R*o,D=A*A*s+a,F=R*A*s+E*o,y=E*R*s+A*o,w=A*R*s-E*o,T=R*R*s+a,t[0]=u*b+f*S+M*_,t[1]=l*b+d*S+g*_,t[2]=h*b+p*S+x*_,t[3]=c*b+m*S+v*_,t[4]=u*I+f*D+M*F,t[5]=l*I+d*D+g*F,t[6]=h*I+p*D+x*F,t[7]=c*I+m*D+v*F,t[8]=u*y+f*w+M*T,t[9]=l*y+d*w+g*T,t[10]=h*y+p*w+x*T,t[11]=c*y+m*w+v*T,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},i.scalar.rotateX=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[4],a=e[5],s=e[6],u=e[7],l=e[8],h=e[9],c=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+l*n,t[5]=a*i+h*n,t[6]=s*i+c*n,t[7]=u*i+f*n,t[8]=l*i-o*n,t[9]=h*i-a*n,t[10]=c*i-s*n,t[11]=f*i-u*n,t},i.SIMD.rotateX=function(t,e,r){var n=SIMD.Float32x4.splat(Math.sin(r)),i=SIMD.Float32x4.splat(Math.cos(r));e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var o=SIMD.Float32x4.load(e,4),a=SIMD.Float32x4.load(e,8);return SIMD.Float32x4.store(t,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(o,i),SIMD.Float32x4.mul(a,n))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,i),SIMD.Float32x4.mul(o,n))),t},i.rotateX=n.USE_SIMD?i.SIMD.rotateX:i.scalar.rotateX,i.scalar.rotateY=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],a=e[1],s=e[2],u=e[3],l=e[8],h=e[9],c=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-l*n,t[1]=a*i-h*n,t[2]=s*i-c*n,t[3]=u*i-f*n,t[8]=o*n+l*i,t[9]=a*n+h*i,t[10]=s*n+c*i,t[11]=u*n+f*i,t},i.SIMD.rotateY=function(t,e,r){var n=SIMD.Float32x4.splat(Math.sin(r)),i=SIMD.Float32x4.splat(Math.cos(r));e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var o=SIMD.Float32x4.load(e,0),a=SIMD.Float32x4.load(e,8);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,i),SIMD.Float32x4.mul(a,n))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(o,n),SIMD.Float32x4.mul(a,i))),t},i.rotateY=n.USE_SIMD?i.SIMD.rotateY:i.scalar.rotateY,i.scalar.rotateZ=function(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],a=e[1],s=e[2],u=e[3],l=e[4],h=e[5],c=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+l*n,t[1]=a*i+h*n,t[2]=s*i+c*n,t[3]=u*i+f*n,t[4]=l*i-o*n,t[5]=h*i-a*n,t[6]=c*i-s*n,t[7]=f*i-u*n,t},i.SIMD.rotateZ=function(t,e,r){var n=SIMD.Float32x4.splat(Math.sin(r)),i=SIMD.Float32x4.splat(Math.cos(r));e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var o=SIMD.Float32x4.load(e,0),a=SIMD.Float32x4.load(e,4);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(o,i),SIMD.Float32x4.mul(a,n))),SIMD.Float32x4.store(t,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,i),SIMD.Float32x4.mul(o,n))),t},i.rotateZ=n.USE_SIMD?i.SIMD.rotateZ:i.scalar.rotateZ,i.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},i.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},i.fromRotation=function(t,e,r){var i,o,a,s=r[0],u=r[1],l=r[2],h=Math.sqrt(s*s+u*u+l*l);return Math.abs(h)<n.EPSILON?null:(h=1/h,s*=h,u*=h,l*=h,i=Math.sin(e),o=Math.cos(e),a=1-o,t[0]=s*s*a+o,t[1]=u*s*a+l*i,t[2]=l*s*a-u*i,t[3]=0,t[4]=s*u*a-l*i,t[5]=u*u*a+o,t[6]=l*u*a+s*i,t[7]=0,t[8]=s*l*a+u*i,t[9]=u*l*a-s*i,t[10]=l*l*a+o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},i.fromXRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},i.fromYRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},i.fromZRotation=function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},i.fromRotationTranslation=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=n+n,u=i+i,l=o+o,h=n*s,c=n*u,f=n*l,d=i*u,p=i*l,m=o*l,M=a*s,g=a*u,x=a*l;return t[0]=1-(d+m),t[1]=c+x,t[2]=f-g,t[3]=0,t[4]=c-x,t[5]=1-(h+m),t[6]=p+M,t[7]=0,t[8]=f+g,t[9]=p-M,t[10]=1-(h+d),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},i.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},i.getRotation=function(t,e){var r=e[0]+e[5]+e[10],n=0;return r>0?(n=2*Math.sqrt(r+1),t[3]=.25*n,t[0]=(e[6]-e[9])/n,t[1]=(e[8]-e[2])/n,t[2]=(e[1]-e[4])/n):e[0]>e[5]&e[0]>e[10]?(n=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/n,t[0]=.25*n,t[1]=(e[1]+e[4])/n,t[2]=(e[8]+e[2])/n):e[5]>e[10]?(n=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/n,t[0]=(e[1]+e[4])/n,
t[1]=.25*n,t[2]=(e[6]+e[9])/n):(n=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/n,t[0]=(e[8]+e[2])/n,t[1]=(e[6]+e[9])/n,t[2]=.25*n),t},i.fromRotationTranslationScale=function(t,e,r,n){var i=e[0],o=e[1],a=e[2],s=e[3],u=i+i,l=o+o,h=a+a,c=i*u,f=i*l,d=i*h,p=o*l,m=o*h,M=a*h,g=s*u,x=s*l,v=s*h,b=n[0],S=n[1],_=n[2];return t[0]=(1-(p+M))*b,t[1]=(f+v)*b,t[2]=(d-x)*b,t[3]=0,t[4]=(f-v)*S,t[5]=(1-(c+M))*S,t[6]=(m+g)*S,t[7]=0,t[8]=(d+x)*_,t[9]=(m-g)*_,t[10]=(1-(c+p))*_,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},i.fromRotationTranslationScaleOrigin=function(t,e,r,n,i){var o=e[0],a=e[1],s=e[2],u=e[3],l=o+o,h=a+a,c=s+s,f=o*l,d=o*h,p=o*c,m=a*h,M=a*c,g=s*c,x=u*l,v=u*h,b=u*c,S=n[0],_=n[1],I=n[2],D=i[0],F=i[1],y=i[2];return t[0]=(1-(m+g))*S,t[1]=(d+b)*S,t[2]=(p-v)*S,t[3]=0,t[4]=(d-b)*_,t[5]=(1-(f+g))*_,t[6]=(M+x)*_,t[7]=0,t[8]=(p+v)*I,t[9]=(M-x)*I,t[10]=(1-(f+m))*I,t[11]=0,t[12]=r[0]+D-(t[0]*D+t[4]*F+t[8]*y),t[13]=r[1]+F-(t[1]*D+t[5]*F+t[9]*y),t[14]=r[2]+y-(t[2]*D+t[6]*F+t[10]*y),t[15]=1,t},i.fromQuat=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=r+r,s=n+n,u=i+i,l=r*a,h=n*a,c=n*s,f=i*a,d=i*s,p=i*u,m=o*a,M=o*s,g=o*u;return t[0]=1-c-p,t[1]=h+g,t[2]=f-M,t[3]=0,t[4]=h-g,t[5]=1-l-p,t[6]=d+m,t[7]=0,t[8]=f+M,t[9]=d-m,t[10]=1-l-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},i.frustum=function(t,e,r,n,i,o,a){var s=1/(r-e),u=1/(i-n),l=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*u,t[6]=0,t[7]=0,t[8]=(r+e)*s,t[9]=(i+n)*u,t[10]=(a+o)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*l,t[15]=0,t},i.perspective=function(t,e,r,n,i){var o=1/Math.tan(e/2),a=1/(n-i);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+n)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*n*a,t[15]=0,t},i.perspectiveFromFieldOfView=function(t,e,r,n){var i=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),u=2/(a+s),l=2/(i+o);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=-((a-s)*u*.5),t[9]=(i-o)*l*.5,t[10]=n/(r-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*r/(r-n),t[15]=0,t},i.ortho=function(t,e,r,n,i,o,a){var s=1/(e-r),u=1/(n-i),l=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+r)*s,t[13]=(i+n)*u,t[14]=(a+o)*l,t[15]=1,t},i.lookAt=function(t,e,r,o){var a,s,u,l,h,c,f,d,p,m,M=e[0],g=e[1],x=e[2],v=o[0],b=o[1],S=o[2],_=r[0],I=r[1],D=r[2];return Math.abs(M-_)<n.EPSILON&&Math.abs(g-I)<n.EPSILON&&Math.abs(x-D)<n.EPSILON?i.identity(t):(f=M-_,d=g-I,p=x-D,m=1/Math.sqrt(f*f+d*d+p*p),f*=m,d*=m,p*=m,a=b*p-S*d,s=S*f-v*p,u=v*d-b*f,m=Math.sqrt(a*a+s*s+u*u),m?(m=1/m,a*=m,s*=m,u*=m):(a=0,s=0,u=0),l=d*u-p*s,h=p*a-f*u,c=f*s-d*a,m=Math.sqrt(l*l+h*h+c*c),m?(m=1/m,l*=m,h*=m,c*=m):(l=0,h=0,c=0),t[0]=a,t[1]=l,t[2]=f,t[3]=0,t[4]=s,t[5]=h,t[6]=d,t[7]=0,t[8]=u,t[9]=c,t[10]=p,t[11]=0,t[12]=-(a*M+s*g+u*x),t[13]=-(l*M+h*g+c*x),t[14]=-(f*M+d*g+p*x),t[15]=1,t)},i.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},i.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},i.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t},i.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t},i.sub=i.subtract,i.multiplyScalar=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t},i.multiplyScalarAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t[9]=e[9]+r[9]*n,t[10]=e[10]+r[10]*n,t[11]=e[11]+r[11]*n,t[12]=e[12]+r[12]*n,t[13]=e[13]+r[13]*n,t[14]=e[14]+r[14]*n,t[15]=e[15]+r[15]*n,t},i.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},i.equals=function(t,e){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],h=t[7],c=t[8],f=t[9],d=t[10],p=t[11],m=t[12],M=t[13],g=t[14],x=t[15],v=e[0],b=e[1],S=e[2],_=e[3],I=e[4],D=e[5],F=e[6],y=e[7],w=e[8],T=e[9],E=e[10],A=e[11],R=e[12],P=e[13],L=e[14],N=e[15];return Math.abs(r-v)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(i-b)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(o-S)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(S))&&Math.abs(a-_)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(s-I)<=n.EPSILON*Math.max(1,Math.abs(s),Math.abs(I))&&Math.abs(u-D)<=n.EPSILON*Math.max(1,Math.abs(u),Math.abs(D))&&Math.abs(l-F)<=n.EPSILON*Math.max(1,Math.abs(l),Math.abs(F))&&Math.abs(h-y)<=n.EPSILON*Math.max(1,Math.abs(h),Math.abs(y))&&Math.abs(c-w)<=n.EPSILON*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(f-T)<=n.EPSILON*Math.max(1,Math.abs(f),Math.abs(T))&&Math.abs(d-E)<=n.EPSILON*Math.max(1,Math.abs(d),Math.abs(E))&&Math.abs(p-A)<=n.EPSILON*Math.max(1,Math.abs(p),Math.abs(A))&&Math.abs(m-R)<=n.EPSILON*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(M-P)<=n.EPSILON*Math.max(1,Math.abs(M),Math.abs(P))&&Math.abs(g-L)<=n.EPSILON*Math.max(1,Math.abs(g),Math.abs(L))&&Math.abs(x-N)<=n.EPSILON*Math.max(1,Math.abs(x),Math.abs(N))},e.exports=i},{"./common.js":3}],8:[function(t,e,r){var n=t("./common.js"),i=t("./mat3.js"),o=t("./vec3.js"),a=t("./vec4.js"),s={};s.create=function(){var t=new n.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},s.rotationTo=function(){var t=o.create(),e=o.fromValues(1,0,0),r=o.fromValues(0,1,0);return function(n,i,a){var u=o.dot(i,a);return-.999999>u?(o.cross(t,e,i),o.length(t)<1e-6&&o.cross(t,r,i),o.normalize(t,t),s.setAxisAngle(n,t,Math.PI),n):u>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(o.cross(t,i,a),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+u,s.normalize(n,n))}}(),s.setAxes=function(){var t=i.create();return function(e,r,n,i){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],s.normalize(e,s.fromMat3(e,t))}}(),s.clone=a.clone,s.fromValues=a.fromValues,s.copy=a.copy,s.set=a.set,s.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},s.setAxisAngle=function(t,e,r){r=.5*r;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t},s.getAxisAngle=function(t,e){var r=2*Math.acos(e[3]),n=Math.sin(r/2);return 0!=n?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),r},s.add=a.add,s.multiply=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=r[0],u=r[1],l=r[2],h=r[3];return t[0]=n*h+a*s+i*l-o*u,t[1]=i*h+a*u+o*s-n*l,t[2]=o*h+a*l+n*u-i*s,t[3]=a*h-n*s-i*u-o*l,t},s.mul=s.multiply,s.scale=a.scale,s.rotateX=function(t,e,r){r*=.5;var n=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(r),u=Math.cos(r);return t[0]=n*u+a*s,t[1]=i*u+o*s,t[2]=o*u-i*s,t[3]=a*u-n*s,t},s.rotateY=function(t,e,r){r*=.5;var n=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(r),u=Math.cos(r);return t[0]=n*u-o*s,t[1]=i*u+a*s,t[2]=o*u+n*s,t[3]=a*u-i*s,t},s.rotateZ=function(t,e,r){r*=.5;var n=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(r),u=Math.cos(r);return t[0]=n*u+i*s,t[1]=i*u-n*s,t[2]=o*u+a*s,t[3]=a*u-o*s,t},s.calculateW=function(t,e){var r=e[0],n=e[1],i=e[2];return t[0]=r,t[1]=n,t[2]=i,t[3]=Math.sqrt(Math.abs(1-r*r-n*n-i*i)),t},s.dot=a.dot,s.lerp=a.lerp,s.slerp=function(t,e,r,n){var i,o,a,s,u,l=e[0],h=e[1],c=e[2],f=e[3],d=r[0],p=r[1],m=r[2],M=r[3];return o=l*d+h*p+c*m+f*M,0>o&&(o=-o,d=-d,p=-p,m=-m,M=-M),1-o>1e-6?(i=Math.acos(o),a=Math.sin(i),s=Math.sin((1-n)*i)/a,u=Math.sin(n*i)/a):(s=1-n,u=n),t[0]=s*l+u*d,t[1]=s*h+u*p,t[2]=s*c+u*m,t[3]=s*f+u*M,t},s.sqlerp=function(){var t=s.create(),e=s.create();return function(r,n,i,o,a,u){return s.slerp(t,n,a,u),s.slerp(e,i,o,u),s.slerp(r,t,e,2*u*(1-u)),r}}(),s.invert=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=r*r+n*n+i*i+o*o,s=a?1/a:0;return t[0]=-r*s,t[1]=-n*s,t[2]=-i*s,t[3]=o*s,t},s.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},s.length=a.length,s.len=s.length,s.squaredLength=a.squaredLength,s.sqrLen=s.squaredLength,s.normalize=a.normalize,s.fromMat3=function(t,e){var r,n=e[0]+e[4]+e[8];if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var o=(i+1)%3,a=(i+2)%3;r=Math.sqrt(e[3*i+i]-e[3*o+o]-e[3*a+a]+1),t[i]=.5*r,r=.5/r,t[3]=(e[3*o+a]-e[3*a+o])*r,t[o]=(e[3*o+i]+e[3*i+o])*r,t[a]=(e[3*a+i]+e[3*i+a])*r}return t},s.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},s.exactEquals=a.exactEquals,s.equals=a.equals,e.exports=s},{"./common.js":3,"./mat3.js":6,"./vec3.js":10,"./vec4.js":11}],9:[function(t,e,r){var n=t("./common.js"),i={};i.create=function(){var t=new n.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},i.clone=function(t){var e=new n.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},i.fromValues=function(t,e){var r=new n.ARRAY_TYPE(2);return r[0]=t,r[1]=e,r},i.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},i.set=function(t,e,r){return t[0]=e,t[1]=r,t},i.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t},i.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t},i.sub=i.subtract,i.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t},i.mul=i.multiply,i.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t},i.div=i.divide,i.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},i.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},i.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t},i.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t},i.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},i.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t},i.scaleAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t},i.distance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(r*r+n*n)},i.dist=i.distance,i.squaredDistance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n},i.sqrDist=i.squaredDistance,i.length=function(t){var e=t[0],r=t[1];return Math.sqrt(e*e+r*r)},i.len=i.length,i.squaredLength=function(t){var e=t[0],r=t[1];return e*e+r*r},i.sqrLen=i.squaredLength,i.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},i.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},i.normalize=function(t,e){var r=e[0],n=e[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i),t[0]=e[0]*i,t[1]=e[1]*i),t},i.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},i.cross=function(t,e,r){var n=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=n,t},i.lerp=function(t,e,r,n){var i=e[0],o=e[1];return t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t},i.random=function(t,e){e=e||1;var r=2*n.RANDOM()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t},i.transformMat2=function(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i,t[1]=r[1]*n+r[3]*i,t},i.transformMat2d=function(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i+r[4],t[1]=r[1]*n+r[3]*i+r[5],t},i.transformMat3=function(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[3]*i+r[6],t[1]=r[1]*n+r[4]*i+r[7],t},i.transformMat4=function(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[4]*i+r[12],t[1]=r[1]*n+r[5]*i+r[13],t},i.forEach=function(){var t=i.create();return function(e,r,n,i,o,a){var s,u;for(r||(r=2),n||(n=0),u=i?Math.min(i*r+n,e.length):e.length,s=n;u>s;s+=r)t[0]=e[s],t[1]=e[s+1],o(t,t,a),e[s]=t[0],e[s+1]=t[1];return e}}(),i.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},i.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},i.equals=function(t,e){var r=t[0],i=t[1],o=e[0],a=e[1];return Math.abs(r-o)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))},e.exports=i},{"./common.js":3}],10:[function(t,e,r){var n=t("./common.js"),i={};i.create=function(){var t=new n.ARRAY_TYPE(3);return t[0]=0,t[1]=0,t[2]=0,t},i.clone=function(t){var e=new n.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},i.fromValues=function(t,e,r){var i=new n.ARRAY_TYPE(3);return i[0]=t,i[1]=e,i[2]=r,i},i.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},i.set=function(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t},i.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},i.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t},i.sub=i.subtract,i.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t},i.mul=i.multiply,i.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t},i.div=i.divide,i.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},i.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},i.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t},i.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t},i.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},i.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},i.scaleAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t},i.distance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(r*r+n*n+i*i)},i.dist=i.distance,i.squaredDistance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return r*r+n*n+i*i},i.sqrDist=i.squaredDistance,i.length=function(t){var e=t[0],r=t[1],n=t[2];return Math.sqrt(e*e+r*r+n*n)},i.len=i.length,i.squaredLength=function(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n},i.sqrLen=i.squaredLength,i.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},i.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},i.normalize=function(t,e){var r=e[0],n=e[1],i=e[2],o=r*r+n*n+i*i;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t},i.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},i.cross=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=r[0],s=r[1],u=r[2];return t[0]=i*u-o*s,t[1]=o*a-n*u,t[2]=n*s-i*a,t},i.lerp=function(t,e,r,n){var i=e[0],o=e[1],a=e[2];return t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t[2]=a+n*(r[2]-a),t},i.hermite=function(t,e,r,n,i,o){var a=o*o,s=a*(2*o-3)+1,u=a*(o-2)+o,l=a*(o-1),h=a*(3-2*o);return t[0]=e[0]*s+r[0]*u+n[0]*l+i[0]*h,t[1]=e[1]*s+r[1]*u+n[1]*l+i[1]*h,t[2]=e[2]*s+r[2]*u+n[2]*l+i[2]*h,t},i.bezier=function(t,e,r,n,i,o){var a=1-o,s=a*a,u=o*o,l=s*a,h=3*o*s,c=3*u*a,f=u*o;return t[0]=e[0]*l+r[0]*h+n[0]*c+i[0]*f,t[1]=e[1]*l+r[1]*h+n[1]*c+i[1]*f,t[2]=e[2]*l+r[2]*h+n[2]*c+i[2]*f,t},i.random=function(t,e){e=e||1;var r=2*n.RANDOM()*Math.PI,i=2*n.RANDOM()-1,o=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(r)*o,t[1]=Math.sin(r)*o,t[2]=i*e,t},i.transformMat4=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=r[3]*n+r[7]*i+r[11]*o+r[15];return a=a||1,t[0]=(r[0]*n+r[4]*i+r[8]*o+r[12])/a,t[1]=(r[1]*n+r[5]*i+r[9]*o+r[13])/a,t[2]=(r[2]*n+r[6]*i+r[10]*o+r[14])/a,t},i.transformMat3=function(t,e,r){var n=e[0],i=e[1],o=e[2];return t[0]=n*r[0]+i*r[3]+o*r[6],t[1]=n*r[1]+i*r[4]+o*r[7],t[2]=n*r[2]+i*r[5]+o*r[8],t},i.transformQuat=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=r[0],s=r[1],u=r[2],l=r[3],h=l*n+s*o-u*i,c=l*i+u*n-a*o,f=l*o+a*i-s*n,d=-a*n-s*i-u*o;return t[0]=h*l+d*-a+c*-u-f*-s,t[1]=c*l+d*-s+f*-a-h*-u,t[2]=f*l+d*-u+h*-s-c*-a,t},i.rotateX=function(t,e,r,n){var i=[],o=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],o[0]=i[0],o[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),o[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t},i.rotateY=function(t,e,r,n){var i=[],o=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],o[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),o[1]=i[1],o[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t},i.rotateZ=function(t,e,r,n){var i=[],o=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],o[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),o[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),o[2]=i[2],t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2],t},i.forEach=function(){var t=i.create();return function(e,r,n,i,o,a){var s,u;for(r||(r=3),n||(n=0),u=i?Math.min(i*r+n,e.length):e.length,s=n;u>s;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],o(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}}(),i.angle=function(t,e){var r=i.fromValues(t[0],t[1],t[2]),n=i.fromValues(e[0],e[1],e[2]);i.normalize(r,r),i.normalize(n,n);var o=i.dot(r,n);return o>1?0:Math.acos(o)},i.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},i.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},i.equals=function(t,e){var r=t[0],i=t[1],o=t[2],a=e[0],s=e[1],u=e[2];return Math.abs(r-a)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(o-u)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(u))},e.exports=i},{"./common.js":3}],11:[function(t,e,r){var n=t("./common.js"),i={};i.create=function(){var t=new n.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},i.clone=function(t){var e=new n.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},i.fromValues=function(t,e,r,i){var o=new n.ARRAY_TYPE(4);return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o},i.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},i.set=function(t,e,r,n,i){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t},i.add=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},i.subtract=function(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t},i.sub=i.subtract,i.multiply=function(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t},i.mul=i.multiply,i.divide=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t},i.div=i.divide,i.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},i.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},i.min=function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t},i.max=function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t},i.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},i.scale=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},i.scaleAndAdd=function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t},i.distance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return Math.sqrt(r*r+n*n+i*i+o*o)},i.dist=i.distance,i.squaredDistance=function(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2],o=e[3]-t[3];return r*r+n*n+i*i+o*o},i.sqrDist=i.squaredDistance,i.length=function(t){var e=t[0],r=t[1],n=t[2],i=t[3];return Math.sqrt(e*e+r*r+n*n+i*i)},i.len=i.length,i.squaredLength=function(t){var e=t[0],r=t[1],n=t[2],i=t[3];return e*e+r*r+n*n+i*i},i.sqrLen=i.squaredLength,i.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},i.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},i.normalize=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=r*r+n*n+i*i+o*o;return a>0&&(a=1/Math.sqrt(a),t[0]=r*a,t[1]=n*a,t[2]=i*a,t[3]=o*a),t},i.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},i.lerp=function(t,e,r,n){var i=e[0],o=e[1],a=e[2],s=e[3];return t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t[2]=a+n*(r[2]-a),t[3]=s+n*(r[3]-s),t},i.random=function(t,e){return e=e||1,t[0]=n.RANDOM(),t[1]=n.RANDOM(),t[2]=n.RANDOM(),t[3]=n.RANDOM(),i.normalize(t,t),i.scale(t,t,e),t},i.transformMat4=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*a,t[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*a,t[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*a,t[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*a,t},i.transformQuat=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=r[0],s=r[1],u=r[2],l=r[3],h=l*n+s*o-u*i,c=l*i+u*n-a*o,f=l*o+a*i-s*n,d=-a*n-s*i-u*o;return t[0]=h*l+d*-a+c*-u-f*-s,t[1]=c*l+d*-s+f*-a-h*-u,t[2]=f*l+d*-u+h*-s-c*-a,t[3]=e[3],t},i.forEach=function(){var t=i.create();return function(e,r,n,i,o,a){var s,u;for(r||(r=4),n||(n=0),u=i?Math.min(i*r+n,e.length):e.length,s=n;u>s;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],o(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}(),i.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},i.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},i.equals=function(t,e){var r=t[0],i=t[1],o=t[2],a=t[3],s=e[0],u=e[1],l=e[2],h=e[3];return Math.abs(r-s)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-u)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(o-l)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(l))&&Math.abs(a-h)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(h))},e.exports=i},{"./common.js":3}],12:[function(t,e,r){(function(t){function e(t,e){for(var r=0,n=t.length-1;n>=0;n--){var i=t[n];"."===i?t.splice(n,1):".."===i?(t.splice(n,1),r++):r&&(t.splice(n,1),r--)}if(e)for(;r--;r)t.unshift("..");return t}function n(t,e){if(t.filter)return t.filter(e);for(var r=[],n=0;n<t.length;n++)e(t[n],n,t)&&r.push(t[n]);return r}var i=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,o=function(t){return i.exec(t).slice(1)};r.resolve=function(){for(var r="",i=!1,o=arguments.length-1;o>=-1&&!i;o--){var a=o>=0?arguments[o]:t.cwd();if("string"!=typeof a)throw new TypeError("Arguments to path.resolve must be strings");a&&(r=a+"/"+r,i="/"===a.charAt(0))}return r=e(n(r.split("/"),function(t){return!!t}),!i).join("/"),(i?"/":"")+r||"."},r.normalize=function(t){var i=r.isAbsolute(t),o="/"===a(t,-1);return t=e(n(t.split("/"),function(t){return!!t}),!i).join("/"),t||i||(t="."),t&&o&&(t+="/"),(i?"/":"")+t},r.isAbsolute=function(t){return"/"===t.charAt(0)},r.join=function(){var t=Array.prototype.slice.call(arguments,0);return r.normalize(n(t,function(t,e){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))},r.relative=function(t,e){function n(t){for(var e=0;e<t.length&&""===t[e];e++);for(var r=t.length-1;r>=0&&""===t[r];r--);return e>r?[]:t.slice(e,r-e+1)}t=r.resolve(t).substr(1),e=r.resolve(e).substr(1);for(var i=n(t.split("/")),o=n(e.split("/")),a=Math.min(i.length,o.length),s=a,u=0;a>u;u++)if(i[u]!==o[u]){s=u;break}for(var l=[],u=s;u<i.length;u++)l.push("..");return l=l.concat(o.slice(s)),l.join("/")},r.sep="/",r.delimiter=":",r.dirname=function(t){var e=o(t),r=e[0],n=e[1];return r||n?(n&&(n=n.substr(0,n.length-1)),r+n):"."},r.basename=function(t,e){var r=o(t)[2];return e&&r.substr(-1*e.length)===e&&(r=r.substr(0,r.length-e.length)),r},r.extname=function(t){return o(t)[3]};var a="b"==="ab".substr(-1)?function(t,e,r){return t.substr(e,r)}:function(t,e,r){return 0>e&&(e=t.length+e),t.substr(e,r)}}).call(this,t("_process"))},{_process:13}],13:[function(t,e,r){function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(t){if(c===setTimeout)return setTimeout(t,0);if((c===n||!c)&&setTimeout)return c=setTimeout,setTimeout(t,0);try{return c(t,0)}catch(e){try{return c.call(null,t,0)}catch(e){return c.call(this,t,0)}}}function a(t){if(f===clearTimeout)return clearTimeout(t);if((f===i||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(t);try{return f(t)}catch(e){try{return f.call(null,t)}catch(e){return f.call(this,t)}}}function s(){M&&p&&(M=!1,p.length?m=p.concat(m):g=-1,m.length&&u())}function u(){if(!M){var t=o(s);M=!0;for(var e=m.length;e;){for(p=m,m=[];++g<e;)p&&p[g].run();g=-1,e=m.length}p=null,M=!1,a(t)}}function l(t,e){this.fun=t,this.array=e}function h(){}var c,f,d=e.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:n}catch(t){c=n}try{f="function"==typeof clearTimeout?clearTimeout:i}catch(t){f=i}}();var p,m=[],M=!1,g=-1;d.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];m.push(new l(t,e)),1!==m.length||M||o(u)},l.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=h,d.addListener=h,d.once=h,d.off=h,d.removeListener=h,d.removeAllListeners=h,d.emit=h,d.prependListener=h,d.prependOnceListener=h,d.listeners=function(t){return[]},d.binding=function(t){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(t){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},{}],14:[function(t,e,r){(function(t){WebGLDebugUtils=function(){function e(t){if(null==p){p={},m={};for(var e in t)"number"==typeof t[e]&&(p[t[e]]=e,m[e]=t[e])}}function r(){if(null==p)throw"WebGLDebugUtils.init(ctx) not called"}function n(t){return r(),void 0!==p[t]}function i(t){r();var e=p[t];return void 0!==e?"gl."+e:"/*UNKNOWN WebGL ENUM*/ 0x"+t.toString(16)}function o(t,e,r,n){var o=d[t];if(void 0!==o){var o=o[e];if(void 0!==o&&o[r]){if("object"==typeof o[r]&&void 0!==o[r].enumBitwiseOr){for(var a=o[r].enumBitwiseOr,s=0,u=[],l=0;l<a.length;++l){var h=m[a[l]];0!==(n&h)&&(s|=h,u.push(i(h)))}return s===n?u.join(" | "):i(n)}return i(n)}}return null===n?"null":void 0===n?"undefined":n.toString()}function a(t,e){for(var r="",n=e.length,i=0;n>i;++i)r+=(0==i?"":", ")+o(t,n,i,e[i]);return r}function s(t,e,r){t.__defineGetter__(r,function(){return e[r]}),t.__defineSetter__(r,function(t){e[r]=t})}function u(t,r,n,a){function l(t,e){return function(){n&&n(e,arguments);var i=t[e].apply(t,arguments),o=a.getError();return 0!=o&&(h[o]=!0,r(o,e,arguments)),i}}a=a||t,e(t),r=r||function(t,e,r){for(var n="",a=r.length,s=0;a>s;++s)n+=(0==s?"":", ")+o(e,a,s,r[s]);f("WebGL error "+i(t)+" in "+e+"("+n+")")};var h={},c={};for(var d in t)if("function"==typeof t[d])if("getExtension"!=d)c[d]=l(t,d);else{var p=l(t,d);c[d]=function(){var e=p.apply(t,arguments);return u(e,r,n,a)}}else s(c,t,d);return c.getError=function(){for(var e in h)if(h.hasOwnProperty(e)&&h[e])return h[e]=!1,e;return t.NO_ERROR},c}function l(t){var e=t.getParameter(t.MAX_VERTEX_ATTRIBS),r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r);for(var n=0;e>n;++n)t.disableVertexAttribArray(n),t.vertexAttribPointer(n,4,t.FLOAT,!1,0,0),t.vertexAttrib1f(n,0);t.deleteBuffer(r);for(var i=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),n=0;i>n;++n)t.activeTexture(t.TEXTURE0+n),t.bindTexture(t.TEXTURE_CUBE_MAP,null),t.bindTexture(t.TEXTURE_2D,null);for(t.activeTexture(t.TEXTURE0),t.useProgram(null),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.DITHER),t.disable(t.SCISSOR_TEST),t.blendColor(0,0,0,0),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.clearColor(0,0,0,0),t.clearDepth(1),t.clearStencil(-1),t.colorMask(!0,!0,!0,!0),t.cullFace(t.BACK),t.depthFunc(t.LESS),t.depthMask(!0),t.depthRange(0,1),t.frontFace(t.CCW),t.hint(t.GENERATE_MIPMAP_HINT,t.DONT_CARE),t.lineWidth(1),t.pixelStorei(t.PACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.UNPACK_COLORSPACE_CONVERSION_WEBGL&&t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.BROWSER_DEFAULT_WEBGL),t.polygonOffset(0,0),t.sampleCoverage(1,!1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilMask(4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT);t.getError(););}function h(t){function e(t){return"function"==typeof t?t:function(e){t.handleEvent(e)}}function r(t){var e=t.addEventListener;t.addEventListener=function(r,n,i){switch(r){case"webglcontextlost":I(n);break;case"webglcontextrestored":D(n);break;default:e.apply(t,arguments)}}}function n(){for(var t=Object.keys(_),e=0;e<t.length;++e)delete _[t]}function i(){++v,M||x==v&&t.loseContext()}function o(t,e){var r=t[e];return function(){if(i(),!M){var e=r.apply(t,arguments);return e}}}function a(){for(var t=0;t<g.length;++t){var e=g[t];e instanceof WebGLBuffer?c.deleteBuffer(e):e instanceof WebGLFramebuffer?c.deleteFramebuffer(e):e instanceof WebGLProgram?c.deleteProgram(e):e instanceof WebGLRenderbuffer?c.deleteRenderbuffer(e):e instanceof WebGLShader?c.deleteShader(e):e instanceof WebGLTexture&&c.deleteTexture(e)}}function u(t){return{statusMessage:t,preventDefault:function(){b=!0}}}function h(t){for(var e in t)"function"==typeof t[e]?f[e]=o(t,e):s(f,t,e);f.getError=function(){if(i(),!M)for(var t;t=c.getError();)_[t]=!0;for(var t in _)if(_[t])return delete _[t],t;return f.NO_ERROR};for(var r=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],n=0;n<r.length;++n){var a=r[n];f[a]=function(e){return function(){if(i(),M)return null;var r=e.apply(t,arguments);return r.__webglDebugContextLostId__=m,g.push(r),r}}(t[a])}for(var u=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"],n=0;n<u.length;++n){var a=u[n];f[a]=function(e){return function(){return i(),M?null:e.apply(t,arguments)}}(f[a])}for(var l=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"],n=0;n<l.length;++n){var a=l[n];f[a]=function(e){return function(){return i(),M?!1:e.apply(t,arguments)}}(f[a])}return f.checkFramebufferStatus=function(e){return function(){return i(),M?f.FRAMEBUFFER_UNSUPPORTED:e.apply(t,arguments)}}(f.checkFramebufferStatus),f.getAttribLocation=function(e){return function(){return i(),M?-1:e.apply(t,arguments)}}(f.getAttribLocation),f.getVertexAttribOffset=function(e){return function(){return i(),M?0:e.apply(t,arguments)}}(f.getVertexAttribOffset),f.isContextLost=function(){return M},f}var c,f,d=[],p=[],f={},m=1,M=!1,g=[],x=0,v=0,b=!1,S=0,_={};t.getContext=function(e){return function(){var r=e.apply(t,arguments);if(r instanceof WebGLRenderingContext){if(r!=c){if(c)throw"got different context";c=r,f=h(c)}return f}return r}}(t.getContext);var I=function(t){d.push(e(t))},D=function(t){p.push(e(t))};return r(t),t.loseContext=function(){if(!M){for(M=!0,x=0,++m;c.getError(););n(),_[c.CONTEXT_LOST_WEBGL]=!0;var e=u("context lost"),r=d.slice();setTimeout(function(){for(var n=0;n<r.length;++n)r[n](e);S>=0&&setTimeout(function(){t.restoreContext()},S)},0)}},t.restoreContext=function(){M&&p.length&&setTimeout(function(){if(!b)throw"can not restore. webglcontestlost listener did not call event.preventDefault";a(),l(c),M=!1,v=0,b=!1;for(var t=p.slice(),e=u("context restored"),r=0;r<t.length;++r)t[r](e)},0)},t.loseContextInNCalls=function(t){if(M)throw"You can not ask a lost contet to be lost";x=v+t},t.getNumCalls=function(){return v;
},t.setRestoreTimeout=function(t){S=t},t}"undefined"==typeof window&&(window=t);var c=function(t){window.console&&window.console.log&&window.console.log(t)},f=function(t){window.console&&window.console.error?window.console.error(t):c(t)},d={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},p=null,m=null;return{init:e,mightBeEnum:n,glEnumToString:i,glFunctionArgToString:o,glFunctionArgsToString:a,makeDebugContext:u,makeLostContextSimulatingCanvas:h,resetToInitialState:l}}(),e.exports=WebGLDebugUtils}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],15:[function(t,e,r){"use strict";var n={};n.images={jolicraft:"./image/jolicraft.png",ldfaithful:"./image/ldfaithful.png",oryx:"./image/oryx.png"},n.sounds={},n.bgms={},e.exports=n},{}],16:[function(t,e,r){"use strict";var n=t("gl-matrix"),i=t("./hakurei").util,o=function(){this.matrix=n.mat4.create(),n.mat4.identity(this.matrix),this.theta=[1.7*Math.PI,0,.5*Math.PI],this.center=[0,0,0],this.up=[0,0,1],this.pos=[0,0,0],this.thetaLimits=[1.5*Math.PI,1.8*Math.PI],this.distanceLimits=[2,15],this.zoomWeight=.1,this.currentDistance=(this.distanceLimits[0]+this.distanceLimits[1])/2,this.desiredDistance=this.currentDistance,this.updateMatrix()};o.prototype.checkCollision=function(t){return!1},o.prototype.moveCenter=function(t,e){if(this.center=t.slice(0),e)for(var r=0;3>r;r++)this.center[r]+=e[r]},o.prototype.changeAngle=function(t){this.theta[0]-=t[0],this.theta[1]-=t[1],this.theta[2]-=t[2],this.theta[0]=i.clamp(this.theta[0],this.thetaLimits[0],this.thetaLimits[1])},o.prototype.setAngle=function(t){this.theta=t,this.theta[0]=i.clamp(this.theta[0],this.thetaLimits[0],this.thetaLimits[1])},o.prototype.changeDistance=function(t){this.desiredDistance+=t,this.desiredDistance=i.clamp(this.desiredDistance,this.distanceLimits[0],this.distanceLimits[1])},o.prototype.setDistance=function(t){this.desiredDistance=t,this.desiredDistance=i.clamp(this.desiredDistance,this.distanceLimits[0],this.distanceLimits[1])},o.prototype.sphericalToCartesian=function(t,e,r){return[t[0]+e*Math.sin(r[0])*Math.cos(r[2]),t[1]+e*Math.sin(r[0])*Math.sin(r[2]),t[2]+e*Math.cos(r[0])]},o.prototype.updateMatrix=function(t){for(var e=0;3>e;e++)this.theta[e]<0?this.theta[e]+=2*Math.PI:this.theta[e]>2*Math.PI&&(this.theta[e]-=2*Math.PI);t&&(this.currentDistance*=1-this.zoomWeight,this.currentDistance+=this.zoomWeight*this.desiredDistance),this.pos=this.sphericalToCartesian(this.center,this.currentDistance,this.theta),n.mat4.lookAt(this.matrix,this.pos,this.center,this.up)},e.exports=o},{"./hakurei":24,"gl-matrix":2}],17:[function(t,e,r){"use strict";var n=t("./debug_constant"),i={DEBUG:{}};n.ON&&(i.DEBUG=n),e.exports=i},{"./debug_constant":19}],18:[function(t,e,r){"use strict";function n(t,e){e.u.Light=[];for(var r=0;4>r;r++){var n=e.u.Light;n[r]={};for(var i in new o)n[r][i]=t.getUniformLocation(e.program,"uLight["+r+"]."+i)}}var i=t("./programs"),o=t("./point_light"),a=function(t){var e=i(t);return n(t,e.world),n(t,e.sprites),e.background=[0,0,0,1],e.rotateSpeed=.01,e.zoomFactor=.01,t.enable(t.DEPTH_TEST),t.useProgram(e.world.program),e};e.exports=a},{"./point_light":41,"./programs":42}],19:[function(t,e,r){"use strict";var n={ON:!0,SOUND_OFF:!0,START_STAGE_NO:1};e.exports=n},{}],20:[function(t,e,r){"use strict";var n=function(t,e){return null==e&&(e=t,t=0),Math.floor(Math.random()*(e-t))+t},i=function(){var t=function(t,e,r,i){this.id=t,this.connected=!1,this.unconnectedNeighbors=[],this.connectedTo=[];var o=[n(e[0],r[0]),n(e[1],r[1])],a=[r[0]-o[0],r[1]-o[1]],s=[i[0]+n(a[0])+1,i[1]+n(a[1])+1];this.rect=[s[0],s[1],o[0],o[1]]};return t.prototype.removeFromUnconnected=function(t){for(var e=0;e<this.unconnectedNeighbors.length;e++)if(this.unconnectedNeighbors[e].id==t)return void this.unconnectedNeighbors.splice(e,1)},t.prototype.connectTo=function(t){var e=this.unconnectedNeighbors[t];return this.connectedTo.push(e),this.unconnectedNeighbors.splice(t,1),e.removeFromUnconnected(this.id),this.connected=!0,e.connected=!0,e},t.prototype.connectRandom=function(){if(0==this.unconnectedNeighbors.length)return!1;var t=n(this.unconnectedNeighbors.length);return this.connectTo(t)},t.prototype.connectToConnected=function(){for(var t=[],e=0;e<this.unconnectedNeighbors.length;e++)t.push(e);for(;t.length>0;){var r=n(t.length);if(this.unconnectedNeighbors[t[r]].connected)return this.connectTo(t[r]);t.splice(r,1)}return!1},t}(),o=function(t,e,r){this.tileDim=t,this.roomDim=e,this.numRooms=e[0]*e[1],this.roomGrid=[Math.floor(t[0]/e[0]),Math.floor(t[1]/e[1])],this.rooms=[],this.firstRoom=0,this.lastRoom=0,this.tileVals={wall:"#",floor:" ",empty:".",up:"u",down:"d"};for(var o=[],a=0;a<t[0];a++){o[a]=[];for(var s=0;s<t[1];s++)o[a][s]=this.tileVals.wall}this.tiles=o;var u=[t[0]/e[0]-2,t[1]/e[1]-2];r||(r=[2,2]);for(var l=[],a=0;a<e[0];a++){l[a]=[];for(var s=0;s<e[1];s++)l[a][s]=new i(a*e[0]+s,r,u,[this.roomGrid[0]*a,this.roomGrid[1]*s])}for(var a=0;a<e[0];a++)for(var s=0;s<e[1];s++)a>0&&l[a][s].unconnectedNeighbors.push(l[a-1][s]),a<e[0]-1&&l[a][s].unconnectedNeighbors.push(l[a+1][s]),s>0&&l[a][s].unconnectedNeighbors.push(l[a][s-1]),s<e[1]-1&&l[a][s].unconnectedNeighbors.push(l[a][s+1]);this.rooms=l,this.getRoomFromCoords=function(t,e){return this.rooms[t*this.rooms.length][e]},this.getRoomFromId=function(t){return this.rooms[Math.floor(t/this.roomDim[0])][t%this.roomDim[1]]},this.generate=function(){for(var t=[],e=0;e<this.numRooms;e++)t[e]=e;for(var r=n(this.numRooms),i=this.getRoomFromId(r),o=r;i&&i.unconnectedNeighbors.length>0;){r=i.id;var a=t.indexOf(r);a>=0&&t.splice(a,1),i=i.connectRandom()}for(;t.length>0;){var s=n(t.length);i=this.getRoomFromId(t[s]),i.connectToConnected()&&t.splice(s,1)}for(var u=i.id,e=0;e<this.numRooms;e++){var l=this.getRoomFromId(e);this.fillRoom(l);for(var h=0;h<l.connectedTo.length;h++)this.connectRooms(l,l.connectedTo[h])}var l=this.getRoomFromId(o);this.upStairsPos=[l.rect[0]+n(l.rect[2]),l.rect[1]+n(l.rect[3])],this.plot(this.upStairsPos[0],this.upStairsPos[1],this.tileVals.up),l=this.getRoomFromId(u),this.downStairsPos=[l.rect[0]+n(l.rect[2]),l.rect[1]+n(l.rect[3])],this.plot(this.downStairsPos[0],this.downStairsPos[1],this.tileVals.down),this.cleanUpWalls()},this.plot=function(t,e,r){r||(r=this.tileVals.floor),this.tiles[Math.floor(t)][Math.floor(e)]=r},this.fillRoom=function(t){for(var e=t.rect[0];e<t.rect[0]+t.rect[2];e++)for(var r=t.rect[1];r<t.rect[1]+t.rect[3];r++)this.plot(e,r)},this.fillHallway=function(t,e,r,n){for(var i=Math.abs(r-t),o=Math.abs(n-e),a=r>t?1:-1,s=n>e?1:-1,u=i-o;this.plot(t,e),this.plot(t-1,e),this.plot(t+1,e),this.plot(t,e-1),this.plot(t,e+1),t!=r||e!=n;){var l=2*u;l>-o&&(u-=o,t+=a),i>l&&(u+=i,e+=s)}},this.connectRooms=function(t,e){this.fillHallway(Math.floor(t.rect[0]+t.rect[2]/2),Math.floor(t.rect[1]+t.rect[3]/2),Math.floor(e.rect[0]+e.rect[2]/2),Math.floor(e.rect[1]+e.rect[3]/2))},this.cleanUpWalls=function(){for(var t=0;t<this.tileDim[0];t++)for(var e=0;e<this.tileDim[1];e++)this.tiles[t][e]==this.tileVals.wall&&(t>0&&this.isWalkable(t-1,e)||t<this.tileDim[0]-1&&this.isWalkable(t+1,e)||e>0&&this.isWalkable(t,e-1)||e<this.tileDim[1]-1&&this.isWalkable(t,e+1)||(this.tiles[t][e]=this.tileVals.empty))},this.isWalkable=function(t,e){return this.tiles[t][e]!=this.tileVals.wall&&this.tiles[t][e]!=this.tileVals.empty},this.printDungeon=function(){for(var t="",e=0;e<this.tileDim[0];e++){t+="\n";for(var r=0;r<this.tileDim[1];r++)t+=this.tiles[e][r]}console.log(t)},this.generate()};e.exports=o},{}],21:[function(t,e,r){"use strict";var n=t("./dungeon"),i=function(t){function e(t){return t[Math.floor(Math.random()*t.length)]}function r(r){return 0==r?0:e(t.wallTiles)}function i(r){return r>0?0:e(t.floorTiles)}function o(t){return t>0?0:212}function a(t){return t>0?0:211}for(var s=[],u=[0,0,0],l=[0,0,0],h=t.tileDim,c=t.roomDim,f=t.roomMinSize,d=new n(h,c,f),p=0;2>p;p++){s[p]=[];for(var m=0;m<d.tileDim[1];m++){s[p][m]=[];for(var M=0;M<d.tileDim[0];M++)switch(d.tiles[M][m]){case d.tileVals.empty:s[p][m][M]=0;break;case d.tileVals.wall:s[p][m][M]=r(p);break;case d.tileVals.floor:s[p][m][M]=i(p);break;case d.tileVals.up:s[p][m][M]=o(p),u=[M,m,1.2];break;case d.tileVals.down:s[p][m][M]=a(p),l=[M,m,1.2]}}}return{cubes:s,upstairs:u,downstairs:l}};e.exports=i},{"./dungeon":20}],22:[function(t,e,r){"use strict";var n=t("./hakurei").core,i=t("./hakurei").util,o=t("./constant"),a=(t("./gl"),t("./scene/loading")),s=t("./scene/stage"),u=function(t){n.apply(this,arguments)};i.inherit(u,n),u.prototype.init=function(){n.prototype.init.apply(this,arguments),this.addScene("loading",new a(this)),this.addScene("stage",new s(this)),this.changeScene("loading")},u.prototype.playSound=function(){return o.DEBUG.SOUND_OFF?void 0:this.audio_loader.playSound.apply(this.audio_loader,arguments)},u.prototype.playBGM=function(){return o.DEBUG.SOUND_OFF?void 0:this.audio_loader.playBGM.apply(this.audio_loader,arguments)},u.prototype.stopBGM=function(){return o.DEBUG.SOUND_OFF?void 0:this.audio_loader.stopBGM.apply(this.audio_loader,arguments)},e.exports=u},{"./constant":17,"./gl":23,"./hakurei":24,"./scene/loading":43,"./scene/stage":44}],23:[function(t,e,r){"use strict";var n=t("webgl-debug"),i=function(t){var e;try{e=t.getContext("webgl")||t.getContext("experimental-webgl"),e=n.makeDebugContext(e)}catch(r){window.alert(r)}return e||window.alert("Could not initialize WebGL"),e};e.exports=i},{"webgl-debug":14}],24:[function(t,e,r){"use strict";e.exports=t("./hakureijs/index")},{"./hakureijs/index":30}],25:[function(t,e,r){"use strict";var n=function(){this.sounds={},this.bgms={},this.loading_audio_num=0,this.loaded_audio_num=0,this.id=0,this.soundflag=0,this.audio_context=new window.AudioContext,this.audio_context.createGain=this.audio_context.createGain||this.audio_context.createGainNode,this.audio_source=null};n.prototype.init=function(){this.sounds={},this.bgms={},this.loading_audio_num=0,this.loaded_audio_num=0,this.id=0,this.soundflag=0},n.prototype.loadSound=function(t,e,r){var n=this;n.loading_audio_num++,r||(r=1);var i=function(){n.loaded_audio_num++},o=new Audio(e);o.volume=r,o.addEventListener("canplay",i),o.load(),n.sounds[t]={id:1<<n.id++,audio:o}},n.prototype.loadBGM=function(t,e,r,n,i){var o=this;o.loading_audio_num++;var a=function(e){o.loaded_audio_num++,o.bgms[t]={audio:e,volume:r,loopStart:n,loopEnd:i}},s=function(t){throw t instanceof Error?new Error(t.message):t},u=new XMLHttpRequest;u.onload=function(){if(200===u.status){var t=u.response;o.audio_context.decodeAudioData(t,a,s)}},u.open("GET",e,!0),u.responseType="arraybuffer",u.send(null)},n.prototype.isAllLoaded=function(){return this.loaded_audio_num>0&&this.loaded_audio_num===this.loading_audio_num},n.prototype.playSound=function(t){this.soundflag|=this.sounds[t].id},n.prototype.executePlaySound=function(){for(var t in this.sounds)this.soundflag&this.sounds[t].id&&(this.sounds[t].audio.pause(),this.sounds[t].audio.currentTime=0,this.sounds[t].audio.play(),this.soundflag&=~this.sounds[t].id)},n.prototype.playBGM=function(t){var e=this;e.stopBGM(),e.audio_source=e._createSourceNode(t),e.audio_source.start(0)},n.prototype.stopBGM=function(){var t=this;t.isPlayingBGM()&&(t.audio_source.stop(0),t.audio_source=null)},n.prototype.isPlayingBGM=function(){return this.audio_source?!0:!1},n.prototype._createSourceNode=function(t){var e=this,r=e.bgms[t],n=e.audio_context.createBufferSource();n.buffer=r.audio,(r.loopStart||r.loopEnd)&&(n.loop=!0),r.loopStart&&(n.loopStart=r.loopStart),r.loopEnd&&(n.loopEnd=r.loopEnd);var i=this.audio_context.createGain();return i.gain.value=r.volume||1,n.connect(i),i.connect(e.audio_context.destination),n.start=n.start||n.noteOn,n.stop=n.stop||n.noteOff,n},n.prototype.progress=function(){return this.loaded_audio_num/this.loading_audio_num},e.exports=n},{}],26:[function(t,e,r){"use strict";var n=function(){this.is_done=!1};n.prototype.init=function(){this.is_done=!1},n.prototype.isAllLoaded=function(){return this.is_done},n.prototype.notifyLoadingDone=function(){this.is_done=!0},n.prototype.progress=function(){return this.is_done?1:0},e.exports=n},{}],27:[function(t,e,r){"use strict";var n=function(){this.images={},this.loading_image_num=0,this.loaded_image_num=0};n.prototype.init=function(){for(var t in this.images)this.images[t].src="";this.images={},this.loading_image_num=0,this.loaded_image_num=0},n.prototype.loadImage=function(t,e){var r=this;r.loading_image_num++;var n=function(){r.loaded_image_num++},i=new Image;i.src=e,i.onload=n,this.images[t]=i},n.prototype.isAllLoaded=function(){return this.loaded_image_num>0&&this.loaded_image_num===this.loading_image_num},n.prototype.getImage=function(t){return this.images[t]},n.prototype.progress=function(){return this.loaded_image_num/this.loading_image_num},e.exports=n},{}],28:[function(t,e,r){"use strict";var n={BUTTON_LEFT:1,BUTTON_UP:2,BUTTON_RIGHT:4,BUTTON_DOWN:8,BUTTON_Z:16,BUTTON_X:32,BUTTON_SHIFT:64,BUTTON_SPACE:128};e.exports=n},{}],29:[function(t,e,r){"use strict";var n=t("webgl-debug"),i=t("./constant"),o=t("./asset_loader/image"),a=t("./asset_loader/audio"),s=t("./asset_loader/font"),u=function(t,e){e||(e={}),this.canvas_dom=t,this.ctx=null,this.gl=null,e.webgl?this.gl=this.createWebGLContext(this.canvas_dom):this.ctx=this.canvas_dom.getContext("2d"),this.width=Number(t.getAttribute("width")),this.height=Number(t.getAttribute("height")),this.current_scene=null,this._reserved_next_scene=null,this.scenes={},this.frame_count=0,this.request_id=null,this.current_keyflag=0,this.before_keyflag=0,this.is_connect_gamepad=!1,this.image_loader=new o,this.audio_loader=new a,this.font_loader=new s};u.prototype.init=function(){this.current_scene=null,this._reserved_next_scene=null,this.frame_count=0,this.request_id=null,this.current_keyflag=0,this.before_keyflag=0,this.image_loader.init()},u.prototype.enableGamePad=function(){this.is_connect_gamepad=!0},u.prototype.isRunning=function(){return this.request_id?!0:!1},u.prototype.startRun=function(){this.isRunning()||this.run()},u.prototype.run=function(){this.handleGamePad(),this.changeNextSceneIfReserved(),this.audio_loader.executePlaySound();var t=this.currentScene();t&&(t.beforeDraw(),this.clearCanvas(),t.draw(),t.afterDraw()),this.before_keyflag=this.current_keyflag,this.frame_count++,this.request_id=requestAnimationFrame(this.run.bind(this))},u.prototype.currentScene=function(){return null!==this.current_scene?this.scenes[this.current_scene]:void 0},u.prototype.addScene=function(t,e){this.scenes[t]=e},u.prototype.changeScene=function(){var t=Array.prototype.slice.call(arguments);this._reserved_next_scene=t},u.prototype.changeNextSceneIfReserved=function(){if(this._reserved_next_scene){this.current_scene=this._reserved_next_scene.shift();var t=this.currentScene();t.init.apply(t,this._reserved_next_scene),this._reserved_next_scene=null}},u.prototype.clearCanvas=function(){this.is2D()?this.ctx.clearRect(0,0,this.width,this.height):this.is3D()},u.prototype.is2D=function(){return this.ctx?!0:!1},u.prototype.is3D=function(){return this.gl?!0:!1},u.prototype.handleKeyDown=function(t){this.current_keyflag|=this._keyCodeToBitCode(t.keyCode),t.preventDefault()},u.prototype.handleKeyUp=function(t){this.current_keyflag&=~this._keyCodeToBitCode(t.keyCode),t.preventDefault()},u.prototype.isKeyDown=function(t){return this.current_keyflag&t?!0:!1},u.prototype.isKeyPush=function(t){return!(this.before_keyflag&t)&&this.current_keyflag&t},u.prototype._keyCodeToBitCode=function(t){var e;switch(t){case 16:e=i.BUTTON_SHIFT;break;case 32:e=i.BUTTON_SPACE;break;case 37:e=i.BUTTON_LEFT;break;case 38:e=i.BUTTON_UP;break;case 39:e=i.BUTTON_RIGHT;break;case 40:e=i.BUTTON_DOWN;break;case 88:e=i.BUTTON_X;break;case 90:e=i.BUTTON_Z}return e},u.prototype.handleGamePad=function(){if(this.is_connect_gamepad){var t=navigator.getGamepads(),e=t[0];e&&(this.current_keyflag=0,this.current_keyflag|=e.buttons[1].pressed?i.BUTTON_Z:0,this.current_keyflag|=e.buttons[0].pressed?i.BUTTON_X:0,this.current_keyflag|=e.buttons[2].pressed?i.BUTTON_SELECT:0,this.current_keyflag|=e.buttons[3].pressed?i.BUTTON_START:0,this.current_keyflag|=e.buttons[4].pressed?i.BUTTON_SHIFT:0,this.current_keyflag|=e.buttons[5].pressed?i.BUTTON_SHIFT:0,this.current_keyflag|=e.buttons[6].pressed?i.BUTTON_SPACE:0,this.current_keyflag|=e.axes[1]<-.5?i.BUTTON_UP:0,this.current_keyflag|=e.axes[1]>.5?i.BUTTON_DOWN:0,this.current_keyflag|=e.axes[0]<-.5?i.BUTTON_LEFT:0,this.current_keyflag|=e.axes[0]>.5?i.BUTTON_RIGHT:0)}},u.prototype.fullscreen=function(){var t=this.canvas_dom;t.requestFullscreen?t.requestFullscreen():t.msRequestuestFullscreen?t.msRequestuestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()},u.prototype.fontLoadingDone=function(){this.font_loader.notifyLoadingDone()},u.prototype.setupEvents=function(){if(window){var t=this;window.AudioContext=function(){return window.AudioContext||window.webkitAudioContext}(),window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}(),window.document&&window.document.fonts?window.document.fonts.addEventListener("loadingdone",function(){t.fontLoadingDone()}):t.fontLoadingDone(),window.onkeydown=function(e){t.handleKeyDown(e)},window.onkeyup=function(e){t.handleKeyUp(e)},window.Gamepad&&window.navigator&&window.navigator.getGamepads&&t.enableGamePad()}},u.prototype.createWebGLContext=function(t){var e;try{e=t.getContext("webgl")||t.getContext("experimental-webgl"),e=n.makeDebugContext(e)}catch(r){throw r}if(!e)throw new Error("Could not initialize WebGL");return e},e.exports=u},{"./asset_loader/audio":25,"./asset_loader/font":26,"./asset_loader/image":27,"./constant":28,"webgl-debug":14}],30:[function(t,e,r){"use strict";e.exports={util:t("./util"),core:t("./core"),constant:t("./constant"),serif_manager:t("./serif_manager"),scene:{base:t("./scene/base")},object:{base:t("./object/base"),sprite:t("./object/sprite"),pool_manager:t("./object/pool_manager")},asset_loader:{image:t("./asset_loader/image"),audio:t("./asset_loader/audio"),font:t("./asset_loader/font")},storage:{base:t("./storage/base"),save:t("./storage/save")}}},{"./asset_loader/audio":25,"./asset_loader/font":26,"./asset_loader/image":27,"./constant":28,"./core":29,"./object/base":31,"./object/pool_manager":32,"./object/sprite":33,"./scene/base":34,"./serif_manager":35,"./storage/base":36,"./storage/save":37,"./util":38}],31:[function(t,e,r){"use strict";var n=t("../util"),i=0,o=!1,a=function(t,e){this.scene=t,this.core=t.core,this.parent=e,this.id=++i,this.frame_count=0,this._x=0,this._y=0,this.auto_disable_times_map={},this.velocity={magnitude:0,theta:0},this.objects=[]};a.prototype.init=function(){this.frame_count=0,this._x=0,this._y=0,this.auto_disable_times_map={};for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].init()},a.prototype.beforeDraw=function(){this.frame_count++,this.checkAutoDisableFlags();for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].beforeDraw();this.move()},a.prototype.draw=function(){var t=this.core.ctx;o&&(t.save(),t.fillStyle="rgb( 255, 255, 255 )",t.globalAlpha=.4,t.fillRect(this.getCollisionLeftX(),this.getCollisionUpY(),this.collisionWidth(),this.collisionHeight()),t.restore());for(var e=0,r=this.objects.length;r>e;e++)this.objects[e].draw()},a.prototype.afterDraw=function(){for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].afterDraw()},a.prototype.addSubObject=function(t){this.objects.push(t)},a.prototype.removeSubObject=function(t){for(var e=0,r=this.objects.length;r>e;e++)if(this.objects[e].id===t.id){this.objects.splice(e,1);break}},a.prototype.move=function(){var t=n.calcMoveXByVelocity(this.velocity),e=n.calcMoveYByVelocity(this.velocity);this._x+=t,this._y+=e},a.prototype.onCollision=function(){},a.prototype.width=function(){return 0},a.prototype.height=function(){return 0},a.prototype.globalCenterX=function(){return this.scene.x()+this.x()},a.prototype.globalCenterY=function(){return this.scene.y()+this.y()},a.prototype.globalLeftX=function(){return this.scene.x()+this.x()-this.width()/2},a.prototype.globalRightX=function(){return this.scene.x()+this.x()+this.width()/2},a.prototype.globalUpY=function(){return this.scene.x()+this.y()-this.height()/2},a.prototype.globalDownY=function(){return this.scene.x()+this.y()+this.height()/2},a.prototype.collisionWidth=function(){return 0},a.prototype.collisionHeight=function(){return 0},a.prototype.checkCollisionWithObject=function(t){var e=this;t.checkCollision(e)&&(t.onCollision(e),e.onCollision(t))},a.prototype.checkCollisionWithObjects=function(t){for(var e=this,r=0;r<t.length;r++){var n=t[r];e.checkCollision(n)&&(e.onCollision(n),n.onCollision(e))}},a.prototype.checkCollision=function(t){return Math.abs(this.x()-t.x())<this.collisionWidth()/2+t.collisionWidth()/2&&Math.abs(this.y()-t.y())<this.collisionHeight()/2+t.collisionHeight()/2?!0:!1},a.prototype.getCollisionLeftX=function(){return this.x()-this.collisionWidth()/2},a.prototype.getCollisionRightX=function(){return this.x()+this.collisionWidth()/2},a.prototype.getCollisionUpY=function(){return this.y()-this.collisionHeight()/2},a.prototype.getCollisionDownY=function(){return this.y()+this.collisionHeight()/2},a.prototype.setAutoDisableFlag=function(t,e){var r=this;r[t]=!0,r.auto_disable_times_map[t]=r.frame_count+e},a.prototype.checkAutoDisableFlags=function(){var t=this;for(var e in t.auto_disable_times_map)this.auto_disable_times_map[e]<t.frame_count&&(t[e]=!1,delete t.auto_disable_times_map[e])},a.prototype.x=function(t){return"undefined"!=typeof t&&(this._x=t),this._x},a.prototype.y=function(t){return"undefined"!=typeof t&&(this._y=t),this._y},a.prototype.setVelocity=function(t){this.velocity=t},e.exports=a},{"../util":38}],32:[function(t,e,r){"use strict";var n=t("./base"),i=t("../util"),o=function(t,e){n.apply(this,arguments),this.Class=e,this.objects={}};i.inherit(o,n),o.prototype.init=function(){n.prototype.init.apply(this,arguments),this.objects={}},o.prototype.beforeDraw=function(){n.prototype.beforeDraw.apply(this,arguments);for(var t in this.objects)this.objects[t].beforeDraw()},o.prototype.draw=function(){n.prototype.draw.apply(this,arguments);for(var t in this.objects)this.objects[t].draw()},o.prototype.afterDraw=function(){n.prototype.afterDraw.apply(this,arguments);for(var t in this.objects)this.objects[t].afterDraw()},o.prototype.create=function(){var t=new this.Class(this.scene);return t.init.apply(t,arguments),this.objects[t.id]=t,t},o.prototype.remove=function(t){delete this.objects[t]},o.prototype.checkCollisionWithObject=function(t){for(var e in this.objects){var r=this.objects[e];t.checkCollision(r)&&(t.onCollision(r),r.onCollision(t))}},o.prototype.checkCollisionWithManager=function(t){for(var e in this.objects)for(var r in t.objects)if(this.objects[e].checkCollision(t.objects[r])){var n=this.objects[e],i=t.objects[r];if(n.onCollision(i),i.onCollision(n),!this.objects[e])break}},e.exports=o},{"../util":38,"./base":31}],33:[function(t,e,r){"use strict";var n=t("./base"),i=t("../util"),o=function(t){n.apply(this,arguments),this.current_sprite_index=0};i.inherit(o,n),o.prototype.init=function(){n.prototype.init.apply(this,arguments),this.current_sprite_index=0},o.prototype.beforeDraw=function(){n.prototype.beforeDraw.apply(this,arguments),this.frame_count%this.spriteAnimationSpan()===0&&(this.current_sprite_index++,this.current_sprite_index>=this.spriteIndices().length&&(this.current_sprite_index=0))},o.prototype.draw=function(){if(this.isShow()){var t=this.core.image_loader.getImage(this.spriteName());this.scale()&&console.error("scale method is deprecated. you should use scaleWidth and scaleHeight.");var e=this.core.ctx;e.save(),e.translate(this.globalCenterX(),this.globalCenterY());var r=i.thetaToRadian(this.velocity.theta+this.rotateAdjust());e.rotate(r);var o=this.spriteWidth(),a=this.spriteHeight();o||(o=t.width),a||(a=t.height);var s=this.width(),u=this.height();this.isReflect()&&e.transform(-1,0,0,1,0,0),e.drawImage(t,o*this.spriteIndexX(),a*this.spriteIndexY(),o,a,-s/2,-u/2,s,u),e.restore()}n.prototype.draw.apply(this,arguments)},o.prototype.spriteName=function(){throw new Error("spriteName method must be overridden.")},o.prototype.spriteIndexX=function(){return this.spriteIndices()[this.current_sprite_index].x},o.prototype.spriteIndexY=function(){return this.spriteIndices()[this.current_sprite_index].y},o.prototype.width=function(){return this.spriteWidth()*this.scaleWidth()},o.prototype.height=function(){return this.spriteHeight()*this.scaleHeight()},o.prototype.isShow=function(){return!0},o.prototype.spriteAnimationSpan=function(){return 0},o.prototype.spriteIndices=function(){return[{x:0,y:0}]},o.prototype.spriteWidth=function(){return 0},o.prototype.spriteHeight=function(){return 0},o.prototype.rotateAdjust=function(){return 0},o.prototype.scale=function(){return 0},o.prototype.scaleWidth=function(){return 1},o.prototype.scaleHeight=function(){return 1},o.prototype.isReflect=function(){return!1},e.exports=o},{"../util":38,"./base":31}],34:[function(t,e,r){"use strict";var n=function(t,e){this.core=t,this.parent=e,this.width=this.core.width,this.height=this.core.height,this._x=0,this._y=0,this.frame_count=0,this.objects=[],this.current_scene=null,this._reserved_next_scene=null,this.scenes={}};n.prototype.init=function(){this.current_scene=null,this._reserved_next_scene=null,this._x=0,this._y=0,this.frame_count=0;for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].init()},n.prototype.beforeDraw=function(){this.frame_count++,this.changeNextSubSceneIfReserved();for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].beforeDraw();this.currentSubScene()&&this.currentSubScene().beforeDraw()},n.prototype.draw=function(){for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].draw();this.currentSubScene()&&this.currentSubScene().draw()},n.prototype.afterDraw=function(){for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].afterDraw();this.currentSubScene()&&this.currentSubScene().afterDraw()},n.prototype.addObject=function(t){this.objects.push(t)},n.prototype.currentSubScene=function(){return null!==this.current_scene?this.scenes[this.current_scene]:void 0},n.prototype.addSubScene=function(t,e){this.scenes[t]=e},n.prototype.changeSubScene=function(){var t=Array.prototype.slice.call(arguments);this._reserved_next_scene=t},n.prototype.changeNextSubSceneIfReserved=function(){if(this._reserved_next_scene){this.current_scene=this._reserved_next_scene.shift();var t=this.currentSubScene();t.init.apply(t,this._reserved_next_scene),this._reserved_next_scene=null}},n.prototype.x=function(t){return"undefined"!=typeof t&&(this._x=t),this._x},n.prototype.y=function(t){return"undefined"!=typeof t&&(this._y=t),this._y},e.exports=n},{}],35:[function(t,e,r){"use strict";var n=function(){this.timeoutID=null,this.script=null,this.progress=null,this.left_chara_id=null,this.left_exp=null,this.right_chara_id=null,this.right_exp=null,this.pos=null,this.line_num=0,this.printing_lines=[]};n.prototype.init=function(t){t||console.error("set script arguments to use serif_manager class"),this.script=t,this.progress=-1,this.timeoutID=null,this.left_chara_id=null,this.left_exp=null,this.right_chara_id=null,this.right_exp=null,this.pos=null,this.line_num=0,this.printing_lines=[],this.is_end()||this.next()},n.prototype.is_end=function(){return this.progress+1===this.script.length},n.prototype.next=function(){this.progress++;var t=this.script[this.progress];this._showChara(t),t.serif?this._printMessage(t.serif):this.next()},n.prototype._showChara=function(t){t.pos&&(this.pos=t.pos,"left"===t.pos?(this.left_chara_id=t.chara,this.left_exp=t.exp):"right"===t.pos&&(this.right_chara_id=t.chara,this.right_exp=t.exp))},n.prototype._printMessage=function(t){var e=this;null!==e.timeoutID&&(clearTimeout(e.timeoutID),e.timeoutID=null);var r=t.split(""),n=r.length,i=0;e.line_num=0,e.printing_lines=[];var o=function(){if(!(i>=n)){var t=10,a=r[i];i++,"\n"===a?e.line_num++:(e.printing_lines[e.line_num]||(e.printing_lines[e.line_num]=""),e.printing_lines[e.line_num]=e.printing_lines[e.line_num]+a),e.timeoutID=setTimeout(o,t)}};o()},n.prototype.right_image=function(){return this.right_chara_id?this.right_chara_id+"_"+this.right_exp:null},n.prototype.left_image=function(){return this.left_chara_id?this.left_chara_id+"_"+this.left_exp:null},n.prototype.right_name=function(){return this.right_chara_id?"name_"+this.right_chara_id:null},n.prototype.left_name=function(){return this.left_chara_id?"name_"+this.left_chara_id:null},n.prototype.is_left_talking=function(){return"left"===this.pos?!0:!1},n.prototype.is_right_talking=function(){return"right"===this.pos?!0:!1},n.prototype.lines=function(){return this.printing_lines},e.exports=n},{}],36:[function(t,e,r){(function(r){"use strict";var n="hakurei_engine_game:default",i=function(t){t||(t={}),this._data=t};i.KEY=function(){return n},i.isLocalMode=function(){return"function"==typeof t&&"object"==typeof r&&"browser"!==r.title},i.prototype.save=function(){var t=this.constructor;t.isLocalMode()?this._saveToLocalFile():this._saveToWebStorage()},i.prototype._saveToLocalFile=function(){var e=this.constructor,r=t("fs"),n=JSON.stringify(this._data),i=e._localFileDirectoryPath(),o=i+e._localFileName(e.KEY());r.existsSync(i)||r.mkdirSync(i),r.writeFileSync(o,n)},i._localFileDirectoryPath=function(){var e=t("path"),n=e.dirname(r.mainModule.filename);return e.join(n,"save/")},i._localFileName=function(t){return t+".json"},i._localFilePath=function(t){return this._localFileDirectoryPath()+this._localFileName(t)},i.prototype._saveToWebStorage=function(){var t=this.constructor,e=t.KEY(),r=JSON.stringify(this._data);try{window.localStorage.setItem(e,r)}catch(n){}},i.load=function(){return this.isLocalMode()?this._loadFromLocalFile():this._loadFromWebStorage()},i._loadFromLocalFile=function(){var e=t("fs"),r=this.localFilePath(this.KEY());if(!e.existsSync())return null;var n=e.readFileSync(r,{encoding:"utf8"}),i=this;return n?new i(JSON.parse(n)):null},i._loadFromWebStorage=function(){var t,e=this.KEY();try{t=window.localStorage.getItem(e)}catch(r){}var n=this;
return t?new n(JSON.parse(t)):null},i.prototype.del=function(){var t=this.constructor;t.isLocalMode()?this._removeLocalFile():this._removeWebStorage()},i.prototype._removeLocalFile=function(){var e=this.constructor,r=t("fs"),n=this.localFilePath(e.KEY());r.existsSync(n)&&r.unlinkSync(n)},i.prototype._removeWebStorage=function(){var t=this.constructor,e=t.KEY();try{window.localStorage.removeItem(e)}catch(r){}},e.exports=i}).call(this,t("_process"))},{_process:13,fs:1,path:12}],37:[function(t,e,r){"use strict";var n=t("./base"),i=t("../util"),o=function(t){n.apply(this,arguments)};i.inherit(o,n),o.KEY=function(){var t="hakurei_engine_game:save";return window&&window.location?t+":"+window.location.pathname:t},e.exports=o},{"../util":38,"./base":36}],38:[function(t,e,r){"use strict";var n={inherit:function(t,e){var r=function(t){if(Object.create)return Object.create(t);var e=function(){};return e.prototype=t,new e};t.prototype=r(e.prototype),t.prototype.constructor=t;for(var n in e)t[n]=e[n]},radianToTheta:function(t){return 180*t/Math.PI|0},thetaToRadian:function(t){return t*Math.PI/180},calcMoveXByVelocity:function(t){return t.magnitude*Math.cos(n.thetaToRadian(t.theta))},calcMoveYByVelocity:function(t){return t.magnitude*Math.sin(n.thetaToRadian(t.theta))},hexToRGBString:function(t){var e="#"===t.charAt(0)?t.substring(1,7):t,r=parseInt(e.substring(0,2),16),n=parseInt(e.substring(2,4),16),i=parseInt(e.substring(4,6),16);return"rgb("+r+", "+n+", "+i+")"},clamp:function(t,e,r){return e>t?e:t>r?r:t}};e.exports=n},{}],39:[function(t,e,r){"use strict";var n=function(t,e,r,n,i,o){this.tileDim=n,this.roomDim=i,this.roomMinSize=o,this.floorTiles=e,this.wallTiles=r,this.ambient=t},i=[new n([.1,.1,0],[2,3,3,3,3,3],[2,3],[40,40],[4,4],[5,5]),new n([.1,0,0],[1,2,3],[4],[40,40],[4,4],[4,4]),new n([0,0,.1],[1],[1,2,17,32,33,34,50,51],[45,45],[5,5],[3,3]),new n([0,.1,0],[16,17,19],[4],[50,50],[5,5],[3,3]),new n([.05,0,0],[7],[5],[55,55],[6,6],[3,3]),new n([0,0,0],[176],[192],[55,55],[6,6],[3,3]),new n([0,0,0],[103],[104],[55,55],[6,6],[2,2]),new n([0,0,0],[167],[167],[55,55],[6,6],[1,1])];n.getLevel=function(t){return i[Math.min(Math.floor(t/2),i.length-1)]},e.exports=n},{}],40:[function(t,e,r){"use strict";var n,i=t("./game");window.onload=function(){var t=document.getElementById("mainCanvas");n=new i(t,{webgl:!0}),n.setupEvents(),n.init(),n.startRun()},window.onerror=function(t,e,r,n,i){},window.changeFullScreen=function(){n.fullscreen()}},{"./game":22}],41:[function(t,e,r){"use strict";var n=function(t,e,r,n){this.color=t?t:[1,1,1],this.position=e?e:[0,0,0],this.attenuation=r?r:[.5,.1,0],this.enabled=n?n:!0,this.frame=0};n.prototype.update=function(){for(var t=0;3>t;t++)this.color[t]+=.002*Math.sin(5e-4*this.frame*180/Math.PI);this.frame++},e.exports=n},{}],42:[function(t,e,r){"use strict";var n=t("gl-matrix"),i=t("./shader/world.vs"),o=t("./shader/world.fs"),a=t("./shader/billboard.vs"),s=t("./shader/depth.vs"),u=t("./shader/depth.fs"),l=function(t,e,r){var n=t.createShader(e);if(t.shaderSource(n,r),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw(e==t.VERTEX_SHADER?"Vertex":"Fragment")+" failed to compile:\n\n"+t.getShaderInfoLog(n);return n},h=function(t,e,r){var n=t.createProgram();if(t.attachShader(n,l(t,t.VERTEX_SHADER,e)),t.attachShader(n,l(t,t.FRAGMENT_SHADER,r)),t.linkProgram(n),!t.getProgramParameter(n,t.LINK_STATUS))throw new Error("Could not initialize shaders");return n},c=function(t,e,r,i,o,a){for(var s=h(t,e,r),u={program:s,a:{},u:{},m:{}},l=0;l<i.length;l++)u.a[i[l]]=t.getAttribLocation(s,"a"+i[l]);for(var l=0;l<o.length;l++)u.u[o[l]]=t.getUniformLocation(s,"u"+o[l]);for(var c in a){var f,d=a[c];switch(d){case 2:f=n.mat2;break;case 3:f=n.mat3;break;case 4:f=n.mat4;break;default:console.log("Invalid matrix size")}u.m[c]=f.create(),f.identity(u.m[c])}return u},f=function(t){return{world:c(t,i,o,["Position","Texture","Normal"],["PMatrix","MMatrix","VMatrix","Sampler","LightVMatrix","LightPMatrix","AmbientColor","DepthMap","Light"],{pMatrix:4,mMatrix:4,vMatrix:4}),sprites:c(t,a,o,["Position","Offset","Texture","Moving","Flipped"],["Counter","CamPos","PMatrix","MMatrix","VMatrix","Sampler","AmbientColor","DepthMap","Light"],{}),depth:c(t,s,u,["Position"],["PMatrix","NMatrix","MMatrix"],{pMatrix:4,mMatrix:4,vMatrix:4})}};e.exports=f},{"./shader/billboard.vs":45,"./shader/depth.fs":46,"./shader/depth.vs":47,"./shader/world.fs":48,"./shader/world.vs":49,"gl-matrix":2}],43:[function(t,e,r){"use strict";var n=t("../hakurei").scene.base,i=t("../hakurei").util,o=t("../assets_config"),a=function(t){n.apply(this,arguments)};i.inherit(a,n),a.prototype.init=function(){n.prototype.init.apply(this,arguments);for(var t in o.images)this.core.image_loader.loadImage(t,o.images[t]);for(var e in o.sounds){var r=o.sounds[e];this.core.audio_loader.loadSound(e,r.path,r.volume)}for(var i in o.bgms){var a=o.bgms[i];this.core.audio_loader.loadBGM(i,a.path,1,a.loopStart,a.loopEnd)}},a.prototype.beforeDraw=function(){n.prototype.beforeDraw.apply(this,arguments),this.core.image_loader.isAllLoaded()&&this.core.changeScene("stage")},a.prototype.draw=function(){n.prototype.draw.apply(this,arguments);var t=this.core.ctx;if(t){t.save(),t.fillStyle="white",t.fillRect(0,0,this.core.width,this.core.height),t.restore();var e=this.frame_count%60,r=15,i="";i=r>e&&e>=0?"":2*r>e&&e>=1*r?".":3*r>e&&e>=2*r?"..":"...",t.save(),t.fillStyle="rgb( 0, 0, 0 )",t.textAlign="left",t.font="30px 'Migu'",t.fillText("Now Loading"+i,this.core.width-250,this.core.height-50),t.restore(),t.save(),t.fillStyle="rgb(119, 66, 244)",t.fillRect(0,this.core.height-20,this.core.width*this.progress(),50),t.restore()}},a.prototype.progress=function(){var t=(this.core.audio_loader.progress()+this.core.image_loader.progress()+this.core.font_loader.progress())/3;return t},e.exports=a},{"../assets_config":15,"../hakurei":24}],44:[function(t,e,r){"use strict";function n(t){return[t[0]+.5,t[1]+.5,t[2]]}var i=t("../hakurei").scene.base,o=t("../hakurei").constant,a=t("../hakurei").util,s=(t("../assets_config"),t("../gl"),t("../texture")),u=t("../terrain"),l=t("../camera"),h=t("../level"),c=t("../point_light"),f=t("../sprites"),d=t("../dungeon_convert"),p=t("../data"),m=t("gl-matrix"),M=function(t){i.apply(this,arguments)};a.inherit(M,i),M.prototype.init=function(){i.prototype.init.apply(this,arguments),this.data=p(this.core.gl);var t=new s(this.core.gl,this.core.image_loader.getImage("ldfaithful"),8),e=new s(this.core.gl,this.core.image_loader.getImage("oryx"),8);this.terrain=new u(this.core.gl,t),this.camera=new l,this.levelNum=0,this.level=h.getLevel(this.levelNum),this.lights=[],this.lights[0]=new c([1,.5,0],[0,0,1],[.3,.1,.05]),this.sprites=new f(this.core.gl,e),this.sprites.addSprite(Math.floor(256*Math.random()),[0,0,0]),this.player=this.sprites.sprites[0],this.sprites.addSprite(Math.floor(256*Math.random()),[0,0,1]),this.sprites.sprites[1].maxSpeed*=.8,this.goToLevel(this.levelNum)},M.prototype.goToLevel=function(t){this.level=h.getLevel(t),this.dungeonObj=new d(this.level),this.lights[1]=new c([1,.5,0],n(this.dungeonObj.upstairs),[.2,.1,.05]),this.terrain.generate(this.dungeonObj.cubes),this.player.pos=n(this.dungeonObj.upstairs),this.sprites.sprites[1].pos=n(this.dungeonObj.upstairs),this.sprites.update()},M.prototype.beforeDraw=function(){i.prototype.beforeDraw.apply(this,arguments)},M.prototype.draw=function(){this.core.gl.clearColor.apply(this,this.data.background),this.core.gl.clear(this.core.gl.COLOR_BUFFER_BIT|this.core.gl.DEPTH_BUFFER_BIT),this.core.gl.viewport(0,0,this.core.width,this.core.height),m.mat4.perspective(this.data.world.m.pMatrix,45,this.core.width/this.core.height,.1,100),this.handleInputs(),this.lights[0].position=this.player.pos.slice(0),this.lights[0].position[2]+=2,this.sprites.sprites[1].moveToward(this.terrain,this.player.pos),this.camera.moveCenter(this.player.pos,[0,0,.5]),this.camera.updateMatrix(this.terrain.cubes),this.checkStairs(),this.renderWorld(),this.renderSprites()},M.prototype.renderWorld=function(){this.core.gl.enable(this.core.gl.CULL_FACE),this.core.gl.cullFace(this.core.gl.BACK),this.core.gl.useProgram(this.data.world.program),this.data.world.m.vMatrix=this.camera.matrix,this.core.gl.uniformMatrix4fv(this.data.world.u.MMatrix,!1,this.data.world.m.mMatrix),this.core.gl.uniformMatrix4fv(this.data.world.u.VMatrix,!1,this.data.world.m.vMatrix),this.core.gl.uniformMatrix4fv(this.data.world.u.PMatrix,!1,this.data.world.m.pMatrix),this.core.gl.uniform3fv(this.data.world.u.AmbientColor,this.level.ambient),this.updateLights(this.data.world),this.attribSetup(this.data.world.a.Position,this.terrain.vertexObject,3),this.attribSetup(this.data.world.a.Texture,this.terrain.texCoordObject,2),this.attribSetup(this.data.world.a.Normal,this.terrain.normalObject,3),this.core.gl.activeTexture(this.core.gl.TEXTURE0),this.core.gl.bindTexture(this.core.gl.TEXTURE_2D,this.terrain.textureAtlas.texture),this.core.gl.uniform1i(this.data.world.u.Sampler,0),this.core.gl.bindBuffer(this.core.gl.ELEMENT_ARRAY_BUFFER,this.terrain.indexObject),this.core.gl.drawElements(this.core.gl.TRIANGLES,this.terrain.numVertices(),this.core.gl.UNSIGNED_SHORT,0)},M.prototype.updateLights=function(t){for(var e=0;e<this.lights.length;e++)this.lights[e].update(),this.core.gl.uniform1f(t.u.Light[e].enabled,this.lights[e].enabled),this.core.gl.uniform3fv(t.u.Light[e].attenuation,this.lights[e].attenuation),this.core.gl.uniform3fv(t.u.Light[e].color,this.lights[e].color),this.core.gl.uniform3fv(t.u.Light[e].position,this.lights[e].position)},M.prototype.attribSetup=function(t,e,r,n){n||(n=this.core.gl.FLOAT),this.core.gl.enableVertexAttribArray(t),this.core.gl.bindBuffer(this.core.gl.ARRAY_BUFFER,e),this.core.gl.vertexAttribPointer(t,r,n,!1,0,0)},M.prototype.renderSprites=function(){this.core.gl.disable(this.core.gl.CULL_FACE),this.core.gl.useProgram(this.data.sprites.program),this.data.world.m.vMatrix=this.camera.matrix,this.sprites.sprites[0].theta=this.camera.theta[2],this.sprites.update(),this.core.gl.uniformMatrix4fv(this.data.sprites.u.MMatrix,!1,this.data.world.m.mMatrix),this.core.gl.uniformMatrix4fv(this.data.sprites.u.VMatrix,!1,this.data.world.m.vMatrix),this.core.gl.uniformMatrix4fv(this.data.sprites.u.PMatrix,!1,this.data.world.m.pMatrix),this.core.gl.uniform1f(this.data.sprites.u.Counter,this.frame_count),this.core.gl.uniform3fv(this.data.sprites.u.AmbientColor,this.level.ambient),this.core.gl.uniform3fv(this.data.sprites.u.CamPos,this.camera.pos),this.updateLights(this.data.sprites),this.attribSetup(this.data.sprites.a.Position,this.sprites.vertexObject,3),this.attribSetup(this.data.sprites.a.Texture,this.sprites.texCoordObject,2),this.attribSetup(this.data.sprites.a.Offset,this.sprites.offsetObject,3),this.attribSetup(this.data.sprites.a.Moving,this.sprites.movingObject,1),this.attribSetup(this.data.sprites.a.Flipped,this.sprites.flippedObject,1),this.core.gl.activeTexture(this.core.gl.TEXTURE0),this.core.gl.bindTexture(this.core.gl.TEXTURE_2D,this.sprites.textureAtlas.texture),this.core.gl.uniform1i(this.data.sprites.u.Sampler,0),this.core.gl.bindBuffer(this.core.gl.ELEMENT_ARRAY_BUFFER,this.sprites.indexObject),this.core.gl.drawElements(this.core.gl.TRIANGLES,this.sprites.numVertices(),this.core.gl.UNSIGNED_SHORT,0)},M.prototype.checkStairs=function(){for(var t=[0,0,0],e=0;3>e;e++)t[e]=Math.floor(this.sprites.sprites[1].pos[e]);t[0]==this.dungeonObj.downstairs[0]&&t[1]==this.dungeonObj.downstairs[1]&&this.goToLevel(++this.levelNum)},M.prototype.handleInputs=function(){this.core.isKeyDown(o.BUTTON_UP)&&this.core.isKeyDown(o.BUTTON_LEFT)?(this.player.flipped=1,this.player.turnAndMove(this.terrain,Math.PI/4)):this.core.isKeyDown(o.BUTTON_DOWN)&&this.core.isKeyDown(o.BUTTON_LEFT)?(this.player.flipped=1,this.player.turnAndMove(this.terrain,.75*Math.PI)):this.core.isKeyDown(o.BUTTON_UP)&&this.core.isKeyDown(o.BUTTON_RIGHT)?(this.player.flipped=0,this.player.turnAndMove(this.terrain,-Math.PI/4)):this.core.isKeyDown(o.BUTTON_DOWN)&&this.core.isKeyDown(o.BUTTON_RIGHT)?(this.player.flipped=0,this.player.turnAndMove(this.terrain,5/4*Math.PI)):this.core.isKeyDown(o.BUTTON_UP)?this.player.turnAndMove(this.terrain,0):this.core.isKeyDown(o.BUTTON_LEFT)?(this.player.flipped=1,this.player.turnAndMove(this.terrain,Math.PI/2)):this.core.isKeyDown(o.BUTTON_DOWN)?this.player.turnAndMove(this.terrain,Math.PI):this.core.isKeyDown(o.BUTTON_RIGHT)&&(this.player.flipped=0,this.player.turnAndMove(this.terrain,-Math.PI/2))},e.exports=M},{"../assets_config":15,"../camera":16,"../data":18,"../dungeon_convert":21,"../gl":23,"../hakurei":24,"../level":39,"../point_light":41,"../sprites":51,"../terrain":52,"../texture":53,"gl-matrix":2}],45:[function(t,e,r){e.exports="#define M_PI 3.1415926535897932384626433832795\n\nattribute vec3 aPosition;\nattribute vec3 aOffset;\nattribute vec2 aTexture;\nattribute float aMoving;\nattribute float aFlipped;\n\nuniform vec3 uCamPos;\nuniform mat4 uMMatrix;\nuniform mat4 uVMatrix;\nuniform mat4 uPMatrix;\nuniform float uCounter;\n\nvarying vec4 vWorldVertex;\nvarying vec3 vWorldNormal;\nvarying vec4 vPosition;\nvarying vec2 vTexture;\n\nconst vec3 camUp = vec3(0.0, 0.0, 1.0);\n\nvoid main(void) {\n	// Billboarding\n	vec3 look = normalize(uCamPos - aPosition);\n	vec3 right = normalize(cross(camUp, look));\n	vec3 up = normalize(cross(look, right));\n\n	vec3 offset = aOffset;\n	if (aMoving > 0.5 && offset.z < 0.5) {\n		// Walking wobble animation\n		float t = mod(1.5*uCounter/M_PI,2.0*M_PI);\n		t = (abs(t-M_PI)-0.5*M_PI)*0.25;\n		float x = offset.x;\n		float z = offset.z;\n		float c = cos(t);\n		float s = sin(t);\n		offset.x = x*c - z*s;\n		offset.z = x*s + z*c;\n		if (x < 0.0)\n			offset.z *= 0.70;\n	}\n	else {\n		// Idle wobble animation\n		float t = mod(uCounter/M_PI,2.0*M_PI);\n\n		vec3 mult = vec3(0.05, 0.0, 0.13);\n		if (offset.x < 0.0)\n			mult.x *= -1.0;\n		if (offset.z > 0.5)\n			mult.z *= -1.0;\n		else\n			mult.z = 0.0;\n\n		offset.x += sin(t)*mult.x;\n		offset.z += cos(t)*mult.z;\n	}\n	if (aFlipped > 0.5)\n		offset.x *= -1.0;\n\n	// Thanks to http://www.gamedev.net/topic/385785-billboard-shader/#entry3550648\n	vec3 vR = offset.x*right;\n	vec3 vU = offset.z*up;\n	vec4 d = vec4(vR+vU+look*0.5, 0.0);\n	vPosition = vWorldVertex =  uMMatrix * (vec4(aPosition, 1.0) + d);\n\n	vWorldNormal = look;\n	vTexture = aTexture;\n\n	gl_Position = uPMatrix * uVMatrix * vWorldVertex;\n}\n\n"},{}],46:[function(t,e,r){e.exports="precision mediump float;\n\nconst float Near = 1.0;\nconst float Far = 30.0;\nconst float LinearDepthConstant = 1.0 / (Far - Near);\n\nvarying vec4 vPosition;\n\n// Via http://devmaster.net/posts/3002/shader-effects-shadow-mapping\nvec4 pack(float depth) {\n	const vec4 bias = vec4(1.0/255.0, 1.0/255.0, 1.0/255.0, 0.0);\n\n	float r = depth;\n	float g = fract(r*255.0);\n	float b = fract(g*255.0);\n	float a = fract(b*255.0);\n	vec4 color = vec4(r, g, b, a);\n\n	return color - (color.yzww * bias);\n}\n\nvoid main(void) {\n	float linearDepth = length(vPosition) * LinearDepthConstant;\n	/*gl_FragColor = pack(linearDepth);*/\n	gl_FragColor = vec4(1.0,0.0,1.0,1.0);\n}\n\n"},{}],47:[function(t,e,r){e.exports="attribute vec3 aPosition;\n\nuniform mat4 uVMatrix;\nuniform mat4 uMMatrix;\nuniform mat4 uPMatrix;\n\nvarying vec4 vPosition;\n\nvoid main(void) {\n	vPosition = uVMatrix * uMMatrix * vec4(aPosition + vec3(-8,-8,-8), 1.0);\n	vPosition += vec4(0,0,-16,0);\n	vPosition = vec4(aPosition, 1.0);\n	gl_Position = uPMatrix * vPosition;\n}\n\n"},{}],48:[function(t,e,r){e.exports="precision mediump float;\n\nconst float Near = 1.0;\nconst float Far = 30.0;\nconst float LinearDepthConstant = 1.0 / (Far - Near);\n\nstruct PointLight\n{\n	float enabled;\n	vec3 color;\n	vec3 position;\n	vec3 attenuation;\n};\n\nvarying vec4 vWorldVertex;\nvarying vec3 vWorldNormal;\nvarying vec4 vPosition;\nvarying vec2 vTexture;\n\nuniform PointLight uLight[4];\nuniform sampler2D uDepthMap;\n\nuniform sampler2D uSampler; // texture coords\nuniform vec3 uAmbientColor;\n\nfloat unpack(vec4 color)\n{\n	const vec4 bitShifts = vec4(1.0, 1.0/255.0, 1.0/(255.0*255.0), 1.0/(255.0*255.0*255.0));\n	return dot(color, bitShifts);\n}\n\nvoid main(void) {\n	vec3 normal = normalize(vWorldNormal);\n	vec4 texColor = texture2D(uSampler, vec2(vTexture.s, vTexture.t));\n	if (texColor.a < 0.1) // Transparent textures\n		discard;\n\n	vec3 color = uAmbientColor;\n\n	for (int i=0; i<4; i++) {\n		if (uLight[i].enabled < 0.5)\n			continue;\n		vec3 lightVec = normalize(uLight[i].position - vWorldVertex.xyz);\n		float l = dot(normal, lightVec);\n\n		if (l <= 0.0)\n			continue;\n\n		float d = distance(vWorldVertex.xyz, uLight[i].position);\n		float a = 1.0/(\n			uLight[i].attenuation.x +\n			uLight[i].attenuation.y*d + \n			uLight[i].attenuation.z*d*d\n		);\n		color += l*a*uLight[i].color;\n	}\n\n	//vec3 depth = vPosition.xyz / vPosition.w;\n	//depth.z = length(vWorldVertex.xyz - uLight[0].position) * LinearDepthConstant;\n	float shadow = 1.0;\n\n	//depth.z *= 0.96; // Offset depth \n	//if (depth.z > unpack(texture2D(uDepthMap, depth.xy)))\n		//shadow *= 0.5;\n\n	gl_FragColor = clamp(vec4(texColor.rgb*color*shadow, texColor.a), 0.0, 1.0);\n}\n\n"},{}],49:[function(t,e,r){e.exports="attribute vec3 aPosition;\nattribute vec3 aNormal;\nattribute vec2 aTexture;\n\nuniform mat4 uMMatrix;\nuniform mat4 uVMatrix;\nuniform mat4 uPMatrix;\n\nuniform mat4 uLightVMatrix;\nuniform mat4 uLightPMatrix;\n\nvarying vec4 vWorldVertex;\nvarying vec3 vWorldNormal;\nvarying vec4 vPosition;\nvarying vec2 vTexture;\n\nvoid main(void) {\n	vWorldVertex = uMMatrix * vec4(aPosition, 1.0);\n	vec4 viewVertex = uVMatrix * vWorldVertex;\n	gl_Position = uPMatrix * viewVertex;\n\n	vTexture = aTexture;\n	vWorldNormal = normalize(mat3(uMMatrix) * aNormal);\n\n	vPosition = uLightPMatrix * uLightVMatrix * vWorldVertex;\n}\n\n"},{}],50:[function(t,e,r){"use strict";var n=function(t){this.pos=t?t:[0,0,0],this.theta=0,this.vel=[0,0,0],this.maxSpeed=.1,this.moving=0,this.flipped=0};n.prototype.moveTo=function(t){this.pos=t,this.moving=0},n.prototype.moveToward=function(t,e){var r=e[0]-this.pos[0],n=e[1]-this.pos[1];Math.abs(r)<.1&&Math.abs(n)<.1||(this.theta=Math.atan2(n,r),this.limitTheta(),this.flipped=this.theta<.5*Math.PI||this.theta>1.5*Math.PI?0:1,this.moveForward(t))},n.prototype.limitTheta=function(){this.theta<0?this.theta+=2*Math.PI:this.theta>2*Math.PI&&(this.theta-=2*Math.PI)},n.prototype.turnAndMove=function(t,e){this.theta+=e,this.moveForward(t),this.theta-=e,this.limitTheta()},n.prototype.moveForward=function(t){this.vel[0]=this.maxSpeed*Math.cos(this.theta),this.vel[1]=this.maxSpeed*Math.sin(this.theta),this.checkCollision(t);for(var e=0;3>e;e++)this.pos[e]+=this.vel[e];this.moving=1},n.prototype.checkCollision=function(t){for(var e=0;3>e;e++)if(0!=this.vel[e]){var r=this.vel[e]>0?.5:-.5,n=this.pos.slice(0);n[e]+=this.vel[e]+r,t.collision(n)&&(this.vel[e]=0)}},e.exports=n},{}],51:[function(t,e,r){"use strict";var n=t("./sprite"),i=function(t,e){this.gl=t,this.textureAtlas=e,this.sprites=[],this.vertices=[],this.offsets=[],this.texCoords=[],this.indices=[],this.moving=[],this.flipped=[],this.baseIndex=0,this.vertexObject=t.createBuffer(),this.texCoordObject=t.createBuffer(),this.offsetObject=t.createBuffer(),this.indexObject=t.createBuffer(),this.movingObject=t.createBuffer(),this.flippedObject=t.createBuffer()};i.prototype.numVertices=function(){return this.indices.length},i.prototype.update=function(){var t;for(t=0;t<this.sprites.length;t++)this.moveSprite(t,this.sprites[t].pos),this.flipSprite(t,this.sprites[t].flipped);for(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexObject),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.vertices),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.texCoordObject),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.texCoords),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.offsetObject),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.offsets),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.movingObject),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.moving),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.flippedObject),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.flipped),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.indexObject),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),t=0;t<this.sprites.length;t++)this.sprites[t].moving=0},i.prototype.addSprite=function(t,e){var r=[[.5,0,1],[-.5,0,1],[-.5,0,0],[.5,0,0]];this.sprites.push(new n(e));for(var i=0;4>i;i++)this.vertices=this.vertices.concat(e),this.offsets=this.offsets.concat(r[i]),this.moving.push(0),this.flipped.push(0);var o=this.textureAtlas.getST(t);this.texCoords=this.texCoords.concat(o[2],o[1],o[0],o[1],o[0],o[3],o[2],o[3]),this.indices.push(this.baseIndex,this.baseIndex+1,this.baseIndex+2,this.baseIndex,this.baseIndex+2,this.baseIndex+3),this.baseIndex+=4},i.prototype.flipSprite=function(t,e){for(var r=0;4>r;r++)this.flipped[4*t+r]=this.sprites[t].flipped},i.prototype.moveSprite=function(t,e){for(var r=0;4>r;r++){this.moving[4*t+r]=this.sprites[t].moving;for(var n=0;3>n;n++)this.vertices[12*t+3*r+n]=e[n]}},i.prototype.offsetSprite=function(t,e){for(var r=0;4>r;r++)for(var n=0;3>n;n++)this.vertices[4*t+3*r+n]+=e[n]},e.exports=i},{"./sprite":50}],52:[function(t,e,r){"use strict";var n=function(t,e){this.gl=t,this.textureAtlas=e,this.cubes=[],this.vertices=[],this.normals=[],this.texCoords=[],this.indices=[],this.baseIndex=0,this.vertexObject=null,this.normalObject=null,this.texCoordObject=null,this.indexObject=null};n.prototype.numVertices=function(){return this.indices.length},n.prototype.collision=function(t,e,r){return t instanceof Array&&(r=t[2],e=t[1],t=t[0]),t=Math.floor(t),e=Math.floor(e),r=Math.floor(r),0>r||r>=this.cubes.length||0>e||e>=this.cubes[r].length||0>t||t>=this.cubes[r][e].length?!0:this.cubes[r][e][t]},n.prototype.generate=function(t){this.cubes=t,this.vertices=[],this.normals=[],this.texCoords=[],this.indices=[],this.baseIndex=0;for(var e=0;e<t.length;e++)for(var r=0;r<t[e].length;r++)for(var n=0;n<t[e][r].length;n++)if(0!=t[e][r][n])if(0!=e){var i=[!0,!0,!0,!0,!0,!0];n>0&&(i[0]=!t[e][r][n-1]),n<t[e][r].length-1&&(i[1]=!t[e][r][n+1]),r>0&&(i[2]=!t[e][r-1][n]),r<t[e].length-1&&(i[3]=!t[e][r+1][n]),e>0&&(i[4]=!t[e-1][r][n]),e<t.length-1&&(i[5]=!t[e+1][r][n]),this.addBlock(t[e][r][n],[n,r,e],i)}else this.addBlock(t[e][r][n],[n,r,e],[!1,!1,!1,!1,!1,!0]);this.gl.deleteBuffer(this.vertexObject),this.gl.deleteBuffer(this.normalObject),this.gl.deleteBuffer(this.texCoordObject),this.gl.deleteBuffer(this.indexObject),this.vertexObject=this.gl.createBuffer(),this.normalObject=this.gl.createBuffer(),this.texCoordObject=this.gl.createBuffer(),this.indexObject=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexObject),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.vertices),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.normalObject),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.normals),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.texCoordObject),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.texCoords),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.indexObject),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)},n.prototype.addBlock=function(t,e,r){for(var n=[[1,1,1],[0,1,1],[0,0,1],[1,0,1],[1,0,0],[1,1,0],[0,1,0],[0,0,0]],i=0;i<n.length;i++)n[i][0]+=e[0],n[i][1]+=e[1],n[i][2]+=e[2];for(var o=[[-1,0,0],[1,0,0],[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],a=[[2,1,6,7],[0,3,4,5],[3,2,7,4],[1,0,5,6],[6,5,4,7],[0,1,2,3]],s=0;6>s;s++)r[s]&&(this.addFaceVertices(n,a[s]),this.addFaceNormals(o[s]),this.addFaceTexCoords(t,s))},n.prototype.addFaceVertices=function(t,e){for(var r=0;r<e.length;r++)this.vertices=this.vertices.concat(t[e[r]]);this.indices.push(this.baseIndex,this.baseIndex+1,this.baseIndex+2,this.baseIndex,this.baseIndex+2,this.baseIndex+3),this.baseIndex+=4},n.prototype.addFaceNormals=function(t){for(var e=0;4>e;e++)this.normals=this.normals.concat(t)},n.prototype.addFaceTexCoords=function(t,e){if(this.specialTiles.hasOwnProperty(t)){var r=this.specialTiles[t];switch(Array.isArray(r)||(r=this.specialTiles[this.specialTiles[t]]),e){case 2:t=r[0];break;case 4:t=r[3];break;case 5:t=r[2];break;default:t=r[1]}}var n=this.textureAtlas.getST(t);this.texCoords=this.texCoords.concat(n[2],n[1],n[0],n[1],n[0],n[3],n[2],n[3])},n.prototype.specialTiles={3:[3,3,0,2],5:[5,5,6,6],6:5,8:[8,8,9,10],9:8,10:8,20:[20,20,21,21],21:20,43:[59,60,43,43],59:43,60:43,44:[44,45,62,62],45:44,62:44,46:[46,45,62,62],69:[70,70,69,71],70:69,71:69,74:[74,74,75,75],75:74,77:[77,77,78,2],78:77,102:[119,118,102,102],120:[120,118,102,102],118:102,119:102,108:[110,108,109,109],109:108,110:108,116:[20,20,116,116],117:[20,20,117,117],121:[122,122,121,124],122:121,124:121,123:121,136:[136,136,137,137],137:136,138:[154,154,138,155],154:138,155:138,158:[159,159,158,175],159:158,166:[182,182,166,183],182:166,183:166,176:[192,192,176,208],192:176,208:176},e.exports=n},{}],53:[function(t,e,r){"use strict";var n=function(t,e,r){this.gl=t,this.tileSizePx=r,this.imageSizePx=0,this.tileSizeNormalized=0,this.tilesPerRow=0,this.paddingNormalized=0,this.texture=null;var n=this.gl.createTexture();this.handleTexture(e,n)};n.prototype.handleTexture=function(t,e){this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,t),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.texture=e,this.imageSizePx=t.width,this.tileSizeNormalized=this.tileSizePx/this.imageSizePx,this.paddingNormalized=.5/this.imageSizePx,this.tilesPerRow=Math.floor(this.imageSizePx/this.tileSizePx)},n.prototype.getST=function(t){var e=[this.tileSizeNormalized*(t%this.tilesPerRow)+this.paddingNormalized,this.tileSizeNormalized*Math.floor(t/this.tilesPerRow)+this.paddingNormalized];return e[2]=e[0]+this.tileSizeNormalized-1.5*this.paddingNormalized,e[3]=e[1]+this.tileSizeNormalized-1.5*this.paddingNormalized,e},e.exports=n},{}]},{},[40]);