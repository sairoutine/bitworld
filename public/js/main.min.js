!function t(e,n,i){function r(o,s){if(!n[o]){if(!e[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(a)return a(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var h=n[o]={exports:{}};e[o][0].call(h.exports,function(t){var n=e[o][1][t];return r(n?n:t)},h,h.exports,t,e,n,i)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(t,e,n){n.glMatrix=t("./gl-matrix/common.js"),n.mat2=t("./gl-matrix/mat2.js"),n.mat2d=t("./gl-matrix/mat2d.js"),n.mat3=t("./gl-matrix/mat3.js"),n.mat4=t("./gl-matrix/mat4.js"),n.quat=t("./gl-matrix/quat.js"),n.vec2=t("./gl-matrix/vec2.js"),n.vec3=t("./gl-matrix/vec3.js"),n.vec4=t("./gl-matrix/vec4.js")},{"./gl-matrix/common.js":2,"./gl-matrix/mat2.js":3,"./gl-matrix/mat2d.js":4,"./gl-matrix/mat3.js":5,"./gl-matrix/mat4.js":6,"./gl-matrix/quat.js":7,"./gl-matrix/vec2.js":8,"./gl-matrix/vec3.js":9,"./gl-matrix/vec4.js":10}],2:[function(t,e,n){var i={};i.EPSILON=1e-6,i.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,i.RANDOM=Math.random,i.ENABLE_SIMD=!1,i.SIMD_AVAILABLE=i.ARRAY_TYPE===Float32Array&&"SIMD"in this,i.USE_SIMD=i.ENABLE_SIMD&&i.SIMD_AVAILABLE,i.setMatrixArrayType=function(t){i.ARRAY_TYPE=t};var r=Math.PI/180;i.toRadian=function(t){return t*r},i.equals=function(t,e){return Math.abs(t-e)<=i.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))},e.exports=i},{}],3:[function(t,e,n){var i=t("./common.js"),r={};r.create=function(){var t=new i.ARRAY_TYPE(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},r.clone=function(t){var e=new i.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},r.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},r.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},r.fromValues=function(t,e,n,r){var a=new i.ARRAY_TYPE(4);return a[0]=t,a[1]=e,a[2]=n,a[3]=r,a},r.set=function(t,e,n,i,r){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t},r.transpose=function(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},r.invert=function(t,e){var n=e[0],i=e[1],r=e[2],a=e[3],o=n*a-r*i;return o?(o=1/o,t[0]=a*o,t[1]=-i*o,t[2]=-r*o,t[3]=n*o,t):null},r.adjoint=function(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t},r.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},r.multiply=function(t,e,n){var i=e[0],r=e[1],a=e[2],o=e[3],s=n[0],l=n[1],u=n[2],h=n[3];return t[0]=i*s+a*l,t[1]=r*s+o*l,t[2]=i*u+a*h,t[3]=r*u+o*h,t},r.mul=r.multiply,r.rotate=function(t,e,n){var i=e[0],r=e[1],a=e[2],o=e[3],s=Math.sin(n),l=Math.cos(n);return t[0]=i*l+a*s,t[1]=r*l+o*s,t[2]=i*-s+a*l,t[3]=r*-s+o*l,t},r.scale=function(t,e,n){var i=e[0],r=e[1],a=e[2],o=e[3],s=n[0],l=n[1];return t[0]=i*s,t[1]=r*s,t[2]=a*l,t[3]=o*l,t},r.fromRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=-n,t[3]=i,t},r.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},r.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},r.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))},r.LDU=function(t,e,n,i){return t[2]=i[2]/i[0],n[0]=i[0],n[1]=i[1],n[3]=i[3]-t[2]*n[1],[t,e,n]},r.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},r.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t},r.sub=r.subtract,r.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},r.equals=function(t,e){var n=t[0],r=t[1],a=t[2],o=t[3],s=e[0],l=e[1],u=e[2],h=e[3];return Math.abs(n-s)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-l)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(a-u)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(u))&&Math.abs(o-h)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))},r.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},r.multiplyScalarAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t},e.exports=r},{"./common.js":2}],4:[function(t,e,n){var i=t("./common.js"),r={};r.create=function(){var t=new i.ARRAY_TYPE(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},r.clone=function(t){var e=new i.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},r.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},r.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},r.fromValues=function(t,e,n,r,a,o){var s=new i.ARRAY_TYPE(6);return s[0]=t,s[1]=e,s[2]=n,s[3]=r,s[4]=a,s[5]=o,s},r.set=function(t,e,n,i,r,a,o){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t[4]=a,t[5]=o,t},r.invert=function(t,e){var n=e[0],i=e[1],r=e[2],a=e[3],o=e[4],s=e[5],l=n*a-i*r;return l?(l=1/l,t[0]=a*l,t[1]=-i*l,t[2]=-r*l,t[3]=n*l,t[4]=(r*s-a*o)*l,t[5]=(i*o-n*s)*l,t):null},r.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},r.multiply=function(t,e,n){var i=e[0],r=e[1],a=e[2],o=e[3],s=e[4],l=e[5],u=n[0],h=n[1],c=n[2],f=n[3],d=n[4],p=n[5];return t[0]=i*u+a*h,t[1]=r*u+o*h,t[2]=i*c+a*f,t[3]=r*c+o*f,t[4]=i*d+a*p+s,t[5]=r*d+o*p+l,t},r.mul=r.multiply,r.rotate=function(t,e,n){var i=e[0],r=e[1],a=e[2],o=e[3],s=e[4],l=e[5],u=Math.sin(n),h=Math.cos(n);return t[0]=i*h+a*u,t[1]=r*h+o*u,t[2]=i*-u+a*h,t[3]=r*-u+o*h,t[4]=s,t[5]=l,t},r.scale=function(t,e,n){var i=e[0],r=e[1],a=e[2],o=e[3],s=e[4],l=e[5],u=n[0],h=n[1];return t[0]=i*u,t[1]=r*u,t[2]=a*h,t[3]=o*h,t[4]=s,t[5]=l,t},r.translate=function(t,e,n){var i=e[0],r=e[1],a=e[2],o=e[3],s=e[4],l=e[5],u=n[0],h=n[1];return t[0]=i,t[1]=r,t[2]=a,t[3]=o,t[4]=i*u+a*h+s,t[5]=r*u+o*h+l,t},r.fromRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=-n,t[3]=i,t[4]=0,t[5]=0,t},r.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},r.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},r.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},r.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)},r.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t},r.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t},r.sub=r.subtract,r.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t},r.multiplyScalarAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t[4]=e[4]+n[4]*i,t[5]=e[5]+n[5]*i,t},r.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},r.equals=function(t,e){var n=t[0],r=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=e[0],h=e[1],c=e[2],f=e[3],d=e[4],p=e[5];return Math.abs(n-u)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(r-h)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(a-c)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(c))&&Math.abs(o-f)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(s-d)<=i.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(l-p)<=i.EPSILON*Math.max(1,Math.abs(l),Math.abs(p))},e.exports=r},{"./common.js":2}],5:[function(t,e,n){var i=t("./common.js"),r={};r.create=function(){var t=new i.ARRAY_TYPE(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},r.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},r.clone=function(t){var e=new i.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},r.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},r.fromValues=function(t,e,n,r,a,o,s,l,u){var h=new i.ARRAY_TYPE(9);return h[0]=t,h[1]=e,h[2]=n,h[3]=r,h[4]=a,h[5]=o,h[6]=s,h[7]=l,h[8]=u,h},r.set=function(t,e,n,i,r,a,o,s,l,u){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t[4]=a,t[5]=o,t[6]=s,t[7]=l,t[8]=u,t},r.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},r.transpose=function(t,e){if(t===e){var n=e[1],i=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=i,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},r.invert=function(t,e){var n=e[0],i=e[1],r=e[2],a=e[3],o=e[4],s=e[5],l=e[6],u=e[7],h=e[8],c=h*o-s*u,f=-h*a+s*l,d=u*a-o*l,p=n*c+i*f+r*d;return p?(p=1/p,t[0]=c*p,t[1]=(-h*i+r*u)*p,t[2]=(s*i-r*o)*p,t[3]=f*p,t[4]=(h*n-r*l)*p,t[5]=(-s*n+r*a)*p,t[6]=d*p,t[7]=(-u*n+i*l)*p,t[8]=(o*n-i*a)*p,t):null},r.adjoint=function(t,e){var n=e[0],i=e[1],r=e[2],a=e[3],o=e[4],s=e[5],l=e[6],u=e[7],h=e[8];return t[0]=o*h-s*u,t[1]=r*u-i*h,t[2]=i*s-r*o,t[3]=s*l-a*h,t[4]=n*h-r*l,t[5]=r*a-n*s,t[6]=a*u-o*l,t[7]=i*l-n*u,t[8]=n*o-i*a,t},r.determinant=function(t){var e=t[0],n=t[1],i=t[2],r=t[3],a=t[4],o=t[5],s=t[6],l=t[7],u=t[8];return e*(u*a-o*l)+n*(-u*r+o*s)+i*(l*r-a*s)},r.multiply=function(t,e,n){var i=e[0],r=e[1],a=e[2],o=e[3],s=e[4],l=e[5],u=e[6],h=e[7],c=e[8],f=n[0],d=n[1],p=n[2],m=n[3],M=n[4],g=n[5],x=n[6],v=n[7],b=n[8];return t[0]=f*i+d*o+p*u,t[1]=f*r+d*s+p*h,t[2]=f*a+d*l+p*c,t[3]=m*i+M*o+g*u,t[4]=m*r+M*s+g*h,t[5]=m*a+M*l+g*c,t[6]=x*i+v*o+b*u,t[7]=x*r+v*s+b*h,t[8]=x*a+v*l+b*c,t},r.mul=r.multiply,r.translate=function(t,e,n){var i=e[0],r=e[1],a=e[2],o=e[3],s=e[4],l=e[5],u=e[6],h=e[7],c=e[8],f=n[0],d=n[1];return t[0]=i,t[1]=r,t[2]=a,t[3]=o,t[4]=s,t[5]=l,t[6]=f*i+d*o+u,t[7]=f*r+d*s+h,t[8]=f*a+d*l+c,t},r.rotate=function(t,e,n){var i=e[0],r=e[1],a=e[2],o=e[3],s=e[4],l=e[5],u=e[6],h=e[7],c=e[8],f=Math.sin(n),d=Math.cos(n);return t[0]=d*i+f*o,t[1]=d*r+f*s,t[2]=d*a+f*l,t[3]=d*o-f*i,t[4]=d*s-f*r,t[5]=d*l-f*a,t[6]=u,t[7]=h,t[8]=c,t},r.scale=function(t,e,n){var i=n[0],r=n[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=r*e[3],t[4]=r*e[4],t[5]=r*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},r.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},r.fromRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=0,t[3]=-n,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},r.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},r.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},r.fromQuat=function(t,e){var n=e[0],i=e[1],r=e[2],a=e[3],o=n+n,s=i+i,l=r+r,u=n*o,h=i*o,c=i*s,f=r*o,d=r*s,p=r*l,m=a*o,M=a*s,g=a*l;return t[0]=1-c-p,t[3]=h-g,t[6]=f+M,t[1]=h+g,t[4]=1-u-p,t[7]=d-m,t[2]=f-M,t[5]=d+m,t[8]=1-u-c,t},r.normalFromMat4=function(t,e){var n=e[0],i=e[1],r=e[2],a=e[3],o=e[4],s=e[5],l=e[6],u=e[7],h=e[8],c=e[9],f=e[10],d=e[11],p=e[12],m=e[13],M=e[14],g=e[15],x=n*s-i*o,v=n*l-r*o,b=n*u-a*o,S=i*l-r*s,_=i*u-a*s,I=r*u-a*l,D=h*m-c*p,F=h*M-f*p,y=h*g-d*p,w=c*M-f*m,T=c*g-d*m,E=f*g-d*M,A=x*E-v*T+b*w+S*y-_*F+I*D;return A?(A=1/A,t[0]=(s*E-l*T+u*w)*A,t[1]=(l*y-o*E-u*F)*A,t[2]=(o*T-s*y+u*D)*A,t[3]=(r*T-i*E-a*w)*A,t[4]=(n*E-r*y+a*F)*A,t[5]=(i*y-n*T-a*D)*A,t[6]=(m*I-M*_+g*S)*A,t[7]=(M*b-p*I-g*v)*A,t[8]=(p*_-m*b+g*x)*A,t):null},r.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},r.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},r.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},r.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t},r.sub=r.subtract,r.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},r.multiplyScalarAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t[4]=e[4]+n[4]*i,t[5]=e[5]+n[5]*i,t[6]=e[6]+n[6]*i,t[7]=e[7]+n[7]*i,t[8]=e[8]+n[8]*i,t},r.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},r.equals=function(t,e){var n=t[0],r=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],h=t[7],c=t[8],f=e[0],d=e[1],p=e[2],m=e[3],M=e[4],g=e[5],x=t[6],v=e[7],b=e[8];return Math.abs(n-f)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(r-d)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(a-p)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(o-m)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(s-M)<=i.EPSILON*Math.max(1,Math.abs(s),Math.abs(M))&&Math.abs(l-g)<=i.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(u-x)<=i.EPSILON*Math.max(1,Math.abs(u),Math.abs(x))&&Math.abs(h-v)<=i.EPSILON*Math.max(1,Math.abs(h),Math.abs(v))&&Math.abs(c-b)<=i.EPSILON*Math.max(1,Math.abs(c),Math.abs(b))},e.exports=r},{"./common.js":2}],6:[function(t,e,n){var i=t("./common.js"),r={scalar:{},SIMD:{}};r.create=function(){var t=new i.ARRAY_TYPE(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},r.clone=function(t){var e=new i.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},r.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},r.fromValues=function(t,e,n,r,a,o,s,l,u,h,c,f,d,p,m,M){var g=new i.ARRAY_TYPE(16);return g[0]=t,g[1]=e,g[2]=n,g[3]=r,g[4]=a,g[5]=o,g[6]=s,g[7]=l,g[8]=u,g[9]=h,g[10]=c,g[11]=f,g[12]=d,g[13]=p,g[14]=m,g[15]=M,g},r.set=function(t,e,n,i,r,a,o,s,l,u,h,c,f,d,p,m,M){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t[4]=a,t[5]=o,t[6]=s,t[7]=l,t[8]=u,t[9]=h,t[10]=c,t[11]=f,t[12]=d,t[13]=p,t[14]=m,t[15]=M,t},r.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},r.scalar.transpose=function(t,e){if(t===e){var n=e[1],i=e[2],r=e[3],a=e[6],o=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=a,t[11]=e[14],t[12]=r,t[13]=o,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},r.SIMD.transpose=function(t,e){var n,i,r,a,o,s,l,u,h,c;return n=SIMD.Float32x4.load(e,0),i=SIMD.Float32x4.load(e,4),r=SIMD.Float32x4.load(e,8),a=SIMD.Float32x4.load(e,12),o=SIMD.Float32x4.shuffle(n,i,0,1,4,5),s=SIMD.Float32x4.shuffle(r,a,0,1,4,5),l=SIMD.Float32x4.shuffle(o,s,0,2,4,6),u=SIMD.Float32x4.shuffle(o,s,1,3,5,7),SIMD.Float32x4.store(t,0,l),SIMD.Float32x4.store(t,4,u),o=SIMD.Float32x4.shuffle(n,i,2,3,6,7),s=SIMD.Float32x4.shuffle(r,a,2,3,6,7),h=SIMD.Float32x4.shuffle(o,s,0,2,4,6),c=SIMD.Float32x4.shuffle(o,s,1,3,5,7),SIMD.Float32x4.store(t,8,h),SIMD.Float32x4.store(t,12,c),t},r.transpose=i.USE_SIMD?r.SIMD.transpose:r.scalar.transpose,r.scalar.invert=function(t,e){var n=e[0],i=e[1],r=e[2],a=e[3],o=e[4],s=e[5],l=e[6],u=e[7],h=e[8],c=e[9],f=e[10],d=e[11],p=e[12],m=e[13],M=e[14],g=e[15],x=n*s-i*o,v=n*l-r*o,b=n*u-a*o,S=i*l-r*s,_=i*u-a*s,I=r*u-a*l,D=h*m-c*p,F=h*M-f*p,y=h*g-d*p,w=c*M-f*m,T=c*g-d*m,E=f*g-d*M,A=x*E-v*T+b*w+S*y-_*F+I*D;return A?(A=1/A,t[0]=(s*E-l*T+u*w)*A,t[1]=(r*T-i*E-a*w)*A,t[2]=(m*I-M*_+g*S)*A,t[3]=(f*_-c*I-d*S)*A,t[4]=(l*y-o*E-u*F)*A,t[5]=(n*E-r*y+a*F)*A,t[6]=(M*b-p*I-g*v)*A,t[7]=(h*I-f*b+d*v)*A,t[8]=(o*T-s*y+u*D)*A,t[9]=(i*y-n*T-a*D)*A,t[10]=(p*_-m*b+g*x)*A,t[11]=(c*b-h*_-d*x)*A,t[12]=(s*F-o*w-l*D)*A,t[13]=(n*w-i*F+r*D)*A,t[14]=(m*v-p*S-M*x)*A,t[15]=(h*S-c*v+f*x)*A,t):null},r.SIMD.invert=function(t,e){var n,i,r,a,o,s,l,u,h,c,f=SIMD.Float32x4.load(e,0),d=SIMD.Float32x4.load(e,4),p=SIMD.Float32x4.load(e,8),m=SIMD.Float32x4.load(e,12);return o=SIMD.Float32x4.shuffle(f,d,0,1,4,5),i=SIMD.Float32x4.shuffle(p,m,0,1,4,5),n=SIMD.Float32x4.shuffle(o,i,0,2,4,6),i=SIMD.Float32x4.shuffle(i,o,1,3,5,7),o=SIMD.Float32x4.shuffle(f,d,2,3,6,7),a=SIMD.Float32x4.shuffle(p,m,2,3,6,7),r=SIMD.Float32x4.shuffle(o,a,0,2,4,6),a=SIMD.Float32x4.shuffle(a,o,1,3,5,7),o=SIMD.Float32x4.mul(r,a),o=SIMD.Float32x4.swizzle(o,1,0,3,2),s=SIMD.Float32x4.mul(i,o),l=SIMD.Float32x4.mul(n,o),o=SIMD.Float32x4.swizzle(o,2,3,0,1),s=SIMD.Float32x4.sub(SIMD.Float32x4.mul(i,o),s),l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,o),l),l=SIMD.Float32x4.swizzle(l,2,3,0,1),o=SIMD.Float32x4.mul(i,r),o=SIMD.Float32x4.swizzle(o,1,0,3,2),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,o),s),h=SIMD.Float32x4.mul(n,o),o=SIMD.Float32x4.swizzle(o,2,3,0,1),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(a,o)),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,o),h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),o=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(i,2,3,0,1),a),o=SIMD.Float32x4.swizzle(o,1,0,3,2),r=SIMD.Float32x4.swizzle(r,2,3,0,1),s=SIMD.Float32x4.add(SIMD.Float32x4.mul(r,o),s),u=SIMD.Float32x4.mul(n,o),o=SIMD.Float32x4.swizzle(o,2,3,0,1),s=SIMD.Float32x4.sub(s,SIMD.Float32x4.mul(r,o)),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(n,o),u),u=SIMD.Float32x4.swizzle(u,2,3,0,1),o=SIMD.Float32x4.mul(n,i),o=SIMD.Float32x4.swizzle(o,1,0,3,2),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,o),u),h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(r,o),h),o=SIMD.Float32x4.swizzle(o,2,3,0,1),u=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,o),u),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(r,o)),o=SIMD.Float32x4.mul(n,a),o=SIMD.Float32x4.swizzle(o,1,0,3,2),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(r,o)),u=SIMD.Float32x4.add(SIMD.Float32x4.mul(i,o),u),o=SIMD.Float32x4.swizzle(o,2,3,0,1),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(r,o),l),u=SIMD.Float32x4.sub(u,SIMD.Float32x4.mul(i,o)),o=SIMD.Float32x4.mul(n,r),o=SIMD.Float32x4.swizzle(o,1,0,3,2),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(a,o),l),h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(i,o)),o=SIMD.Float32x4.swizzle(o,2,3,0,1),l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(a,o)),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(i,o),h),c=SIMD.Float32x4.mul(n,s),c=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(c,2,3,0,1),c),c=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(c,1,0,3,2),c),o=SIMD.Float32x4.reciprocalApproximation(c),c=SIMD.Float32x4.sub(SIMD.Float32x4.add(o,o),SIMD.Float32x4.mul(c,SIMD.Float32x4.mul(o,o))),(c=SIMD.Float32x4.swizzle(c,0,0,0,0))?(SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(c,s)),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(c,l)),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(c,u)),SIMD.Float32x4.store(t,12,SIMD.Float32x4.mul(c,h)),t):null},r.invert=i.USE_SIMD?r.SIMD.invert:r.scalar.invert,r.scalar.adjoint=function(t,e){var n=e[0],i=e[1],r=e[2],a=e[3],o=e[4],s=e[5],l=e[6],u=e[7],h=e[8],c=e[9],f=e[10],d=e[11],p=e[12],m=e[13],M=e[14],g=e[15];return t[0]=s*(f*g-d*M)-c*(l*g-u*M)+m*(l*d-u*f),t[1]=-(i*(f*g-d*M)-c*(r*g-a*M)+m*(r*d-a*f)),t[2]=i*(l*g-u*M)-s*(r*g-a*M)+m*(r*u-a*l),t[3]=-(i*(l*d-u*f)-s*(r*d-a*f)+c*(r*u-a*l)),t[4]=-(o*(f*g-d*M)-h*(l*g-u*M)+p*(l*d-u*f)),t[5]=n*(f*g-d*M)-h*(r*g-a*M)+p*(r*d-a*f),t[6]=-(n*(l*g-u*M)-o*(r*g-a*M)+p*(r*u-a*l)),t[7]=n*(l*d-u*f)-o*(r*d-a*f)+h*(r*u-a*l),t[8]=o*(c*g-d*m)-h*(s*g-u*m)+p*(s*d-u*c),t[9]=-(n*(c*g-d*m)-h*(i*g-a*m)+p*(i*d-a*c)),t[10]=n*(s*g-u*m)-o*(i*g-a*m)+p*(i*u-a*s),t[11]=-(n*(s*d-u*c)-o*(i*d-a*c)+h*(i*u-a*s)),t[12]=-(o*(c*M-f*m)-h*(s*M-l*m)+p*(s*f-l*c)),t[13]=n*(c*M-f*m)-h*(i*M-r*m)+p*(i*f-r*c),t[14]=-(n*(s*M-l*m)-o*(i*M-r*m)+p*(i*l-r*s)),t[15]=n*(s*f-l*c)-o*(i*f-r*c)+h*(i*l-r*s),t},r.SIMD.adjoint=function(t,e){var n,i,r,a,o,s,l,u,h,c,f,d,p,n=SIMD.Float32x4.load(e,0),i=SIMD.Float32x4.load(e,4),r=SIMD.Float32x4.load(e,8),a=SIMD.Float32x4.load(e,12);return h=SIMD.Float32x4.shuffle(n,i,0,1,4,5),s=SIMD.Float32x4.shuffle(r,a,0,1,4,5),o=SIMD.Float32x4.shuffle(h,s,0,2,4,6),s=SIMD.Float32x4.shuffle(s,h,1,3,5,7),h=SIMD.Float32x4.shuffle(n,i,2,3,6,7),u=SIMD.Float32x4.shuffle(r,a,2,3,6,7),l=SIMD.Float32x4.shuffle(h,u,0,2,4,6),u=SIMD.Float32x4.shuffle(u,h,1,3,5,7),h=SIMD.Float32x4.mul(l,u),h=SIMD.Float32x4.swizzle(h,1,0,3,2),c=SIMD.Float32x4.mul(s,h),f=SIMD.Float32x4.mul(o,h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),c=SIMD.Float32x4.sub(SIMD.Float32x4.mul(s,h),c),f=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,h),f),f=SIMD.Float32x4.swizzle(f,2,3,0,1),h=SIMD.Float32x4.mul(s,l),h=SIMD.Float32x4.swizzle(h,1,0,3,2),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,h),c),p=SIMD.Float32x4.mul(o,h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(u,h)),p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,h),p),p=SIMD.Float32x4.swizzle(p,2,3,0,1),h=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,2,3,0,1),u),h=SIMD.Float32x4.swizzle(h,1,0,3,2),l=SIMD.Float32x4.swizzle(l,2,3,0,1),c=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,h),c),d=SIMD.Float32x4.mul(o,h),h=SIMD.Float32x4.swizzle(h,2,3,0,1),c=SIMD.Float32x4.sub(c,SIMD.Float32x4.mul(l,h)),d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,h),d),d=SIMD.Float32x4.swizzle(d,2,3,0,1),h=SIMD.Float32x4.mul(o,s),h=SIMD.Float32x4.swizzle(h,1,0,3,2),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,h),d),p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(l,h),p),h=SIMD.Float32x4.swizzle(h,2,3,0,1),d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(u,h),d),p=SIMD.Float32x4.sub(p,SIMD.Float32x4.mul(l,h)),h=SIMD.Float32x4.mul(o,u),h=SIMD.Float32x4.swizzle(h,1,0,3,2),f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(l,h)),d=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,h),d),h=SIMD.Float32x4.swizzle(h,2,3,0,1),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,h),f),d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(s,h)),h=SIMD.Float32x4.mul(o,l),h=SIMD.Float32x4.swizzle(h,1,0,3,2),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(u,h),f),p=SIMD.Float32x4.sub(p,SIMD.Float32x4.mul(s,h)),h=SIMD.Float32x4.swizzle(h,2,3,0,1),f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(u,h)),p=SIMD.Float32x4.add(SIMD.Float32x4.mul(s,h),p),SIMD.Float32x4.store(t,0,c),SIMD.Float32x4.store(t,4,f),SIMD.Float32x4.store(t,8,d),SIMD.Float32x4.store(t,12,p),t},r.adjoint=i.USE_SIMD?r.SIMD.adjoint:r.scalar.adjoint,r.determinant=function(t){var e=t[0],n=t[1],i=t[2],r=t[3],a=t[4],o=t[5],s=t[6],l=t[7],u=t[8],h=t[9],c=t[10],f=t[11],d=t[12],p=t[13],m=t[14],M=t[15],g=e*o-n*a,x=e*s-i*a,v=e*l-r*a,b=n*s-i*o,S=n*l-r*o,_=i*l-r*s,I=u*p-h*d,D=u*m-c*d,F=u*M-f*d,y=h*m-c*p,w=h*M-f*p,T=c*M-f*m;return g*T-x*w+v*y+b*F-S*D+_*I},r.SIMD.multiply=function(t,e,n){var i=SIMD.Float32x4.load(e,0),r=SIMD.Float32x4.load(e,4),a=SIMD.Float32x4.load(e,8),o=SIMD.Float32x4.load(e,12),s=SIMD.Float32x4.load(n,0),l=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,0,0,0,0),i),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,1,1,1,1),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,2,2,2,2),a),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(s,3,3,3,3),o))));SIMD.Float32x4.store(t,0,l);var u=SIMD.Float32x4.load(n,4),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,0,0,0,0),i),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,1,1,1,1),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,2,2,2,2),a),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(u,3,3,3,3),o))));SIMD.Float32x4.store(t,4,h);var c=SIMD.Float32x4.load(n,8),f=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,0,0,0,0),i),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,1,1,1,1),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,2,2,2,2),a),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,3,3,3,3),o))));SIMD.Float32x4.store(t,8,f);var d=SIMD.Float32x4.load(n,12),p=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,0,0,0,0),i),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,1,1,1,1),r),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,2,2,2,2),a),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,3,3,3,3),o))));return SIMD.Float32x4.store(t,12,p),t},r.scalar.multiply=function(t,e,n){var i=e[0],r=e[1],a=e[2],o=e[3],s=e[4],l=e[5],u=e[6],h=e[7],c=e[8],f=e[9],d=e[10],p=e[11],m=e[12],M=e[13],g=e[14],x=e[15],v=n[0],b=n[1],S=n[2],_=n[3];return t[0]=v*i+b*s+S*c+_*m,t[1]=v*r+b*l+S*f+_*M,t[2]=v*a+b*u+S*d+_*g,t[3]=v*o+b*h+S*p+_*x,v=n[4],b=n[5],S=n[6],_=n[7],t[4]=v*i+b*s+S*c+_*m,t[5]=v*r+b*l+S*f+_*M,t[6]=v*a+b*u+S*d+_*g,t[7]=v*o+b*h+S*p+_*x,v=n[8],b=n[9],S=n[10],_=n[11],t[8]=v*i+b*s+S*c+_*m,t[9]=v*r+b*l+S*f+_*M,t[10]=v*a+b*u+S*d+_*g,t[11]=v*o+b*h+S*p+_*x,v=n[12],b=n[13],S=n[14],_=n[15],t[12]=v*i+b*s+S*c+_*m,t[13]=v*r+b*l+S*f+_*M,t[14]=v*a+b*u+S*d+_*g,t[15]=v*o+b*h+S*p+_*x,t},r.multiply=i.USE_SIMD?r.SIMD.multiply:r.scalar.multiply,r.mul=r.multiply,r.scalar.translate=function(t,e,n){var i,r,a,o,s,l,u,h,c,f,d,p,m=n[0],M=n[1],g=n[2];return e===t?(t[12]=e[0]*m+e[4]*M+e[8]*g+e[12],t[13]=e[1]*m+e[5]*M+e[9]*g+e[13],t[14]=e[2]*m+e[6]*M+e[10]*g+e[14],t[15]=e[3]*m+e[7]*M+e[11]*g+e[15]):(i=e[0],r=e[1],a=e[2],o=e[3],s=e[4],l=e[5],u=e[6],h=e[7],c=e[8],f=e[9],d=e[10],p=e[11],t[0]=i,t[1]=r,t[2]=a,t[3]=o,t[4]=s,t[5]=l,t[6]=u,t[7]=h,t[8]=c,t[9]=f,t[10]=d,t[11]=p,t[12]=i*m+s*M+c*g+e[12],t[13]=r*m+l*M+f*g+e[13],t[14]=a*m+u*M+d*g+e[14],t[15]=o*m+h*M+p*g+e[15]),t},r.SIMD.translate=function(t,e,n){var i=SIMD.Float32x4.load(e,0),r=SIMD.Float32x4.load(e,4),a=SIMD.Float32x4.load(e,8),o=SIMD.Float32x4.load(e,12),s=SIMD.Float32x4(n[0],n[1],n[2],0);e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11]),i=SIMD.Float32x4.mul(i,SIMD.Float32x4.swizzle(s,0,0,0,0)),r=SIMD.Float32x4.mul(r,SIMD.Float32x4.swizzle(s,1,1,1,1)),a=SIMD.Float32x4.mul(a,SIMD.Float32x4.swizzle(s,2,2,2,2));var l=SIMD.Float32x4.add(i,SIMD.Float32x4.add(r,SIMD.Float32x4.add(a,o)));return SIMD.Float32x4.store(t,12,l),t},r.translate=i.USE_SIMD?r.SIMD.translate:r.scalar.translate,r.scalar.scale=function(t,e,n){var i=n[0],r=n[1],a=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},r.SIMD.scale=function(t,e,n){var i,r,a,o=SIMD.Float32x4(n[0],n[1],n[2],0);return i=SIMD.Float32x4.load(e,0),SIMD.Float32x4.store(t,0,SIMD.Float32x4.mul(i,SIMD.Float32x4.swizzle(o,0,0,0,0))),r=SIMD.Float32x4.load(e,4),SIMD.Float32x4.store(t,4,SIMD.Float32x4.mul(r,SIMD.Float32x4.swizzle(o,1,1,1,1))),a=SIMD.Float32x4.load(e,8),SIMD.Float32x4.store(t,8,SIMD.Float32x4.mul(a,SIMD.Float32x4.swizzle(o,2,2,2,2))),t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},r.scale=i.USE_SIMD?r.SIMD.scale:r.scalar.scale,r.rotate=function(t,e,n,r){var a,o,s,l,u,h,c,f,d,p,m,M,g,x,v,b,S,_,I,D,F,y,w,T,E=r[0],A=r[1],R=r[2],P=Math.sqrt(E*E+A*A+R*R);return Math.abs(P)<i.EPSILON?null:(P=1/P,E*=P,A*=P,R*=P,a=Math.sin(n),o=Math.cos(n),s=1-o,l=e[0],u=e[1],h=e[2],c=e[3],f=e[4],d=e[5],p=e[6],m=e[7],M=e[8],g=e[9],x=e[10],v=e[11],b=E*E*s+o,S=A*E*s+R*a,_=R*E*s-A*a,I=E*A*s-R*a,D=A*A*s+o,F=R*A*s+E*a,y=E*R*s+A*a,w=A*R*s-E*a,T=R*R*s+o,t[0]=l*b+f*S+M*_,t[1]=u*b+d*S+g*_,t[2]=h*b+p*S+x*_,t[3]=c*b+m*S+v*_,t[4]=l*I+f*D+M*F,t[5]=u*I+d*D+g*F,t[6]=h*I+p*D+x*F,t[7]=c*I+m*D+v*F,t[8]=l*y+f*w+M*T,t[9]=u*y+d*w+g*T,t[10]=h*y+p*w+x*T,t[11]=c*y+m*w+v*T,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},r.scalar.rotateX=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e[4],o=e[5],s=e[6],l=e[7],u=e[8],h=e[9],c=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*r+u*i,t[5]=o*r+h*i,t[6]=s*r+c*i,t[7]=l*r+f*i,t[8]=u*r-a*i,t[9]=h*r-o*i,t[10]=c*r-s*i,t[11]=f*r-l*i,t},r.SIMD.rotateX=function(t,e,n){var i=SIMD.Float32x4.splat(Math.sin(n)),r=SIMD.Float32x4.splat(Math.cos(n));e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var a=SIMD.Float32x4.load(e,4),o=SIMD.Float32x4.load(e,8);return SIMD.Float32x4.store(t,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(a,r),SIMD.Float32x4.mul(o,i))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,r),SIMD.Float32x4.mul(a,i))),t},r.rotateX=i.USE_SIMD?r.SIMD.rotateX:r.scalar.rotateX,r.scalar.rotateY=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e[0],o=e[1],s=e[2],l=e[3],u=e[8],h=e[9],c=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*r-u*i,t[1]=o*r-h*i,t[2]=s*r-c*i,t[3]=l*r-f*i,t[8]=a*i+u*r,t[9]=o*i+h*r,t[10]=s*i+c*r,t[11]=l*i+f*r,t},r.SIMD.rotateY=function(t,e,n){var i=SIMD.Float32x4.splat(Math.sin(n)),r=SIMD.Float32x4.splat(Math.cos(n));e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var a=SIMD.Float32x4.load(e,0),o=SIMD.Float32x4.load(e,8);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,r),SIMD.Float32x4.mul(o,i))),SIMD.Float32x4.store(t,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(a,i),SIMD.Float32x4.mul(o,r))),t},r.rotateY=i.USE_SIMD?r.SIMD.rotateY:r.scalar.rotateY,r.scalar.rotateZ=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e[0],o=e[1],s=e[2],l=e[3],u=e[4],h=e[5],c=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*r+u*i,t[1]=o*r+h*i,t[2]=s*r+c*i,t[3]=l*r+f*i,t[4]=u*r-a*i,t[5]=h*r-o*i,t[6]=c*r-s*i,t[7]=f*r-l*i,t},r.SIMD.rotateZ=function(t,e,n){var i=SIMD.Float32x4.splat(Math.sin(n)),r=SIMD.Float32x4.splat(Math.cos(n));e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]);var a=SIMD.Float32x4.load(e,0),o=SIMD.Float32x4.load(e,4);return SIMD.Float32x4.store(t,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(a,r),SIMD.Float32x4.mul(o,i))),SIMD.Float32x4.store(t,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(o,r),SIMD.Float32x4.mul(a,i))),t},r.rotateZ=i.USE_SIMD?r.SIMD.rotateZ:r.scalar.rotateZ,r.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},r.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},r.fromRotation=function(t,e,n){var r,a,o,s=n[0],l=n[1],u=n[2],h=Math.sqrt(s*s+l*l+u*u);return Math.abs(h)<i.EPSILON?null:(h=1/h,s*=h,l*=h,u*=h,r=Math.sin(e),a=Math.cos(e),o=1-a,t[0]=s*s*o+a,t[1]=l*s*o+u*r,t[2]=u*s*o-l*r,t[3]=0,t[4]=s*l*o-u*r,t[5]=l*l*o+a,t[6]=u*l*o+s*r,t[7]=0,t[8]=s*u*o+l*r,t[9]=l*u*o-s*r,t[10]=u*u*o+a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},r.fromXRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},r.fromYRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},r.fromZRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},r.fromRotationTranslation=function(t,e,n){var i=e[0],r=e[1],a=e[2],o=e[3],s=i+i,l=r+r,u=a+a,h=i*s,c=i*l,f=i*u,d=r*l,p=r*u,m=a*u,M=o*s,g=o*l,x=o*u;return t[0]=1-(d+m),t[1]=c+x,t[2]=f-g,t[3]=0,t[4]=c-x,t[5]=1-(h+m),t[6]=p+M,t[7]=0,t[8]=f+g,t[9]=p-M,t[10]=1-(h+d),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},r.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},r.getRotation=function(t,e){var n=e[0]+e[5]+e[10],i=0;return n>0?(i=2*Math.sqrt(n+1),t[3]=.25*i,t[0]=(e[6]-e[9])/i,t[1]=(e[8]-e[2])/i,t[2]=(e[1]-e[4])/i):e[0]>e[5]&e[0]>e[10]?(i=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/i,t[0]=.25*i,t[1]=(e[1]+e[4])/i,t[2]=(e[8]+e[2])/i):e[5]>e[10]?(i=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/i,t[0]=(e[1]+e[4])/i,t[1]=.25*i,t[2]=(e[6]+e[9])/i):(i=2*Math.sqrt(1+e[10]-e[0]-e[5]),
t[3]=(e[1]-e[4])/i,t[0]=(e[8]+e[2])/i,t[1]=(e[6]+e[9])/i,t[2]=.25*i),t},r.fromRotationTranslationScale=function(t,e,n,i){var r=e[0],a=e[1],o=e[2],s=e[3],l=r+r,u=a+a,h=o+o,c=r*l,f=r*u,d=r*h,p=a*u,m=a*h,M=o*h,g=s*l,x=s*u,v=s*h,b=i[0],S=i[1],_=i[2];return t[0]=(1-(p+M))*b,t[1]=(f+v)*b,t[2]=(d-x)*b,t[3]=0,t[4]=(f-v)*S,t[5]=(1-(c+M))*S,t[6]=(m+g)*S,t[7]=0,t[8]=(d+x)*_,t[9]=(m-g)*_,t[10]=(1-(c+p))*_,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},r.fromRotationTranslationScaleOrigin=function(t,e,n,i,r){var a=e[0],o=e[1],s=e[2],l=e[3],u=a+a,h=o+o,c=s+s,f=a*u,d=a*h,p=a*c,m=o*h,M=o*c,g=s*c,x=l*u,v=l*h,b=l*c,S=i[0],_=i[1],I=i[2],D=r[0],F=r[1],y=r[2];return t[0]=(1-(m+g))*S,t[1]=(d+b)*S,t[2]=(p-v)*S,t[3]=0,t[4]=(d-b)*_,t[5]=(1-(f+g))*_,t[6]=(M+x)*_,t[7]=0,t[8]=(p+v)*I,t[9]=(M-x)*I,t[10]=(1-(f+m))*I,t[11]=0,t[12]=n[0]+D-(t[0]*D+t[4]*F+t[8]*y),t[13]=n[1]+F-(t[1]*D+t[5]*F+t[9]*y),t[14]=n[2]+y-(t[2]*D+t[6]*F+t[10]*y),t[15]=1,t},r.fromQuat=function(t,e){var n=e[0],i=e[1],r=e[2],a=e[3],o=n+n,s=i+i,l=r+r,u=n*o,h=i*o,c=i*s,f=r*o,d=r*s,p=r*l,m=a*o,M=a*s,g=a*l;return t[0]=1-c-p,t[1]=h+g,t[2]=f-M,t[3]=0,t[4]=h-g,t[5]=1-u-p,t[6]=d+m,t[7]=0,t[8]=f+M,t[9]=d-m,t[10]=1-u-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},r.frustum=function(t,e,n,i,r,a,o){var s=1/(n-e),l=1/(r-i),u=1/(a-o);return t[0]=2*a*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*a*l,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(r+i)*l,t[10]=(o+a)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*a*2*u,t[15]=0,t},r.perspective=function(t,e,n,i,r){var a=1/Math.tan(e/2),o=1/(i-r);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(r+i)*o,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*r*i*o,t[15]=0,t},r.perspectiveFromFieldOfView=function(t,e,n,i){var r=Math.tan(e.upDegrees*Math.PI/180),a=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+s),u=2/(r+a);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=u,t[6]=0,t[7]=0,t[8]=-((o-s)*l*.5),t[9]=(r-a)*u*.5,t[10]=i/(n-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*n/(n-i),t[15]=0,t},r.ortho=function(t,e,n,i,r,a,o){var s=1/(e-n),l=1/(i-r),u=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+n)*s,t[13]=(r+i)*l,t[14]=(o+a)*u,t[15]=1,t},r.lookAt=function(t,e,n,a){var o,s,l,u,h,c,f,d,p,m,M=e[0],g=e[1],x=e[2],v=a[0],b=a[1],S=a[2],_=n[0],I=n[1],D=n[2];return Math.abs(M-_)<i.EPSILON&&Math.abs(g-I)<i.EPSILON&&Math.abs(x-D)<i.EPSILON?r.identity(t):(f=M-_,d=g-I,p=x-D,m=1/Math.sqrt(f*f+d*d+p*p),f*=m,d*=m,p*=m,o=b*p-S*d,s=S*f-v*p,l=v*d-b*f,m=Math.sqrt(o*o+s*s+l*l),m?(m=1/m,o*=m,s*=m,l*=m):(o=0,s=0,l=0),u=d*l-p*s,h=p*o-f*l,c=f*s-d*o,m=Math.sqrt(u*u+h*h+c*c),m?(m=1/m,u*=m,h*=m,c*=m):(u=0,h=0,c=0),t[0]=o,t[1]=u,t[2]=f,t[3]=0,t[4]=s,t[5]=h,t[6]=d,t[7]=0,t[8]=l,t[9]=c,t[10]=p,t[11]=0,t[12]=-(o*M+s*g+l*x),t[13]=-(u*M+h*g+c*x),t[14]=-(f*M+d*g+p*x),t[15]=1,t)},r.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},r.frob=function(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},r.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t},r.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t},r.sub=r.subtract,r.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t},r.multiplyScalarAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t[4]=e[4]+n[4]*i,t[5]=e[5]+n[5]*i,t[6]=e[6]+n[6]*i,t[7]=e[7]+n[7]*i,t[8]=e[8]+n[8]*i,t[9]=e[9]+n[9]*i,t[10]=e[10]+n[10]*i,t[11]=e[11]+n[11]*i,t[12]=e[12]+n[12]*i,t[13]=e[13]+n[13]*i,t[14]=e[14]+n[14]*i,t[15]=e[15]+n[15]*i,t},r.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},r.equals=function(t,e){var n=t[0],r=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],h=t[7],c=t[8],f=t[9],d=t[10],p=t[11],m=t[12],M=t[13],g=t[14],x=t[15],v=e[0],b=e[1],S=e[2],_=e[3],I=e[4],D=e[5],F=e[6],y=e[7],w=e[8],T=e[9],E=e[10],A=e[11],R=e[12],P=e[13],N=e[14],O=e[15];return Math.abs(n-v)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(r-b)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(a-S)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(o-_)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(s-I)<=i.EPSILON*Math.max(1,Math.abs(s),Math.abs(I))&&Math.abs(l-D)<=i.EPSILON*Math.max(1,Math.abs(l),Math.abs(D))&&Math.abs(u-F)<=i.EPSILON*Math.max(1,Math.abs(u),Math.abs(F))&&Math.abs(h-y)<=i.EPSILON*Math.max(1,Math.abs(h),Math.abs(y))&&Math.abs(c-w)<=i.EPSILON*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(f-T)<=i.EPSILON*Math.max(1,Math.abs(f),Math.abs(T))&&Math.abs(d-E)<=i.EPSILON*Math.max(1,Math.abs(d),Math.abs(E))&&Math.abs(p-A)<=i.EPSILON*Math.max(1,Math.abs(p),Math.abs(A))&&Math.abs(m-R)<=i.EPSILON*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(M-P)<=i.EPSILON*Math.max(1,Math.abs(M),Math.abs(P))&&Math.abs(g-N)<=i.EPSILON*Math.max(1,Math.abs(g),Math.abs(N))&&Math.abs(x-O)<=i.EPSILON*Math.max(1,Math.abs(x),Math.abs(O))},e.exports=r},{"./common.js":2}],7:[function(t,e,n){var i=t("./common.js"),r=t("./mat3.js"),a=t("./vec3.js"),o=t("./vec4.js"),s={};s.create=function(){var t=new i.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},s.rotationTo=function(){var t=a.create(),e=a.fromValues(1,0,0),n=a.fromValues(0,1,0);return function(i,r,o){var l=a.dot(r,o);return-.999999>l?(a.cross(t,e,r),a.length(t)<1e-6&&a.cross(t,n,r),a.normalize(t,t),s.setAxisAngle(i,t,Math.PI),i):l>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(a.cross(t,r,o),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=1+l,s.normalize(i,i))}}(),s.setAxes=function(){var t=r.create();return function(e,n,i,r){return t[0]=i[0],t[3]=i[1],t[6]=i[2],t[1]=r[0],t[4]=r[1],t[7]=r[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],s.normalize(e,s.fromMat3(e,t))}}(),s.clone=o.clone,s.fromValues=o.fromValues,s.copy=o.copy,s.set=o.set,s.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},s.setAxisAngle=function(t,e,n){n=.5*n;var i=Math.sin(n);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(n),t},s.getAxisAngle=function(t,e){var n=2*Math.acos(e[3]),i=Math.sin(n/2);return 0!=i?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),n},s.add=o.add,s.multiply=function(t,e,n){var i=e[0],r=e[1],a=e[2],o=e[3],s=n[0],l=n[1],u=n[2],h=n[3];return t[0]=i*h+o*s+r*u-a*l,t[1]=r*h+o*l+a*s-i*u,t[2]=a*h+o*u+i*l-r*s,t[3]=o*h-i*s-r*l-a*u,t},s.mul=s.multiply,s.scale=o.scale,s.rotateX=function(t,e,n){n*=.5;var i=e[0],r=e[1],a=e[2],o=e[3],s=Math.sin(n),l=Math.cos(n);return t[0]=i*l+o*s,t[1]=r*l+a*s,t[2]=a*l-r*s,t[3]=o*l-i*s,t},s.rotateY=function(t,e,n){n*=.5;var i=e[0],r=e[1],a=e[2],o=e[3],s=Math.sin(n),l=Math.cos(n);return t[0]=i*l-a*s,t[1]=r*l+o*s,t[2]=a*l+i*s,t[3]=o*l-r*s,t},s.rotateZ=function(t,e,n){n*=.5;var i=e[0],r=e[1],a=e[2],o=e[3],s=Math.sin(n),l=Math.cos(n);return t[0]=i*l+r*s,t[1]=r*l-i*s,t[2]=a*l+o*s,t[3]=o*l-a*s,t},s.calculateW=function(t,e){var n=e[0],i=e[1],r=e[2];return t[0]=n,t[1]=i,t[2]=r,t[3]=Math.sqrt(Math.abs(1-n*n-i*i-r*r)),t},s.dot=o.dot,s.lerp=o.lerp,s.slerp=function(t,e,n,i){var r,a,o,s,l,u=e[0],h=e[1],c=e[2],f=e[3],d=n[0],p=n[1],m=n[2],M=n[3];return a=u*d+h*p+c*m+f*M,0>a&&(a=-a,d=-d,p=-p,m=-m,M=-M),1-a>1e-6?(r=Math.acos(a),o=Math.sin(r),s=Math.sin((1-i)*r)/o,l=Math.sin(i*r)/o):(s=1-i,l=i),t[0]=s*u+l*d,t[1]=s*h+l*p,t[2]=s*c+l*m,t[3]=s*f+l*M,t},s.sqlerp=function(){var t=s.create(),e=s.create();return function(n,i,r,a,o,l){return s.slerp(t,i,o,l),s.slerp(e,r,a,l),s.slerp(n,t,e,2*l*(1-l)),n}}(),s.invert=function(t,e){var n=e[0],i=e[1],r=e[2],a=e[3],o=n*n+i*i+r*r+a*a,s=o?1/o:0;return t[0]=-n*s,t[1]=-i*s,t[2]=-r*s,t[3]=a*s,t},s.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},s.length=o.length,s.len=s.length,s.squaredLength=o.squaredLength,s.sqrLen=s.squaredLength,s.normalize=o.normalize,s.fromMat3=function(t,e){var n,i=e[0]+e[4]+e[8];if(i>0)n=Math.sqrt(i+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);var a=(r+1)%3,o=(r+2)%3;n=Math.sqrt(e[3*r+r]-e[3*a+a]-e[3*o+o]+1),t[r]=.5*n,n=.5/n,t[3]=(e[3*a+o]-e[3*o+a])*n,t[a]=(e[3*a+r]+e[3*r+a])*n,t[o]=(e[3*o+r]+e[3*r+o])*n}return t},s.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},s.exactEquals=o.exactEquals,s.equals=o.equals,e.exports=s},{"./common.js":2,"./mat3.js":5,"./vec3.js":9,"./vec4.js":10}],8:[function(t,e,n){var i=t("./common.js"),r={};r.create=function(){var t=new i.ARRAY_TYPE(2);return t[0]=0,t[1]=0,t},r.clone=function(t){var e=new i.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},r.fromValues=function(t,e){var n=new i.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n},r.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},r.set=function(t,e,n){return t[0]=e,t[1]=n,t},r.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},r.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t},r.sub=r.subtract,r.multiply=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t},r.mul=r.multiply,r.divide=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t},r.div=r.divide,r.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},r.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},r.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},r.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},r.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},r.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},r.scaleAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t},r.distance=function(t,e){var n=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(n*n+i*i)},r.dist=r.distance,r.squaredDistance=function(t,e){var n=e[0]-t[0],i=e[1]-t[1];return n*n+i*i},r.sqrDist=r.squaredDistance,r.length=function(t){var e=t[0],n=t[1];return Math.sqrt(e*e+n*n)},r.len=r.length,r.squaredLength=function(t){var e=t[0],n=t[1];return e*e+n*n},r.sqrLen=r.squaredLength,r.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},r.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},r.normalize=function(t,e){var n=e[0],i=e[1],r=n*n+i*i;return r>0&&(r=1/Math.sqrt(r),t[0]=e[0]*r,t[1]=e[1]*r),t},r.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},r.cross=function(t,e,n){var i=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=i,t},r.lerp=function(t,e,n,i){var r=e[0],a=e[1];return t[0]=r+i*(n[0]-r),t[1]=a+i*(n[1]-a),t},r.random=function(t,e){e=e||1;var n=2*i.RANDOM()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},r.transformMat2=function(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t},r.transformMat2d=function(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r+n[4],t[1]=n[1]*i+n[3]*r+n[5],t},r.transformMat3=function(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[3]*r+n[6],t[1]=n[1]*i+n[4]*r+n[7],t},r.transformMat4=function(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13],t},r.forEach=function(){var t=r.create();return function(e,n,i,r,a,o){var s,l;for(n||(n=2),i||(i=0),l=r?Math.min(r*n+i,e.length):e.length,s=i;l>s;s+=n)t[0]=e[s],t[1]=e[s+1],a(t,t,o),e[s]=t[0],e[s+1]=t[1];return e}}(),r.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},r.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},r.equals=function(t,e){var n=t[0],r=t[1],a=e[0],o=e[1];return Math.abs(n-a)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-o)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))},e.exports=r},{"./common.js":2}],9:[function(t,e,n){var i=t("./common.js"),r={};r.create=function(){var t=new i.ARRAY_TYPE(3);return t[0]=0,t[1]=0,t[2]=0,t},r.clone=function(t){var e=new i.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},r.fromValues=function(t,e,n){var r=new i.ARRAY_TYPE(3);return r[0]=t,r[1]=e,r[2]=n,r},r.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},r.set=function(t,e,n,i){return t[0]=e,t[1]=n,t[2]=i,t},r.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},r.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t},r.sub=r.subtract,r.multiply=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t},r.mul=r.multiply,r.divide=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t},r.div=r.divide,r.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},r.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},r.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},r.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},r.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},r.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},r.scaleAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t},r.distance=function(t,e){var n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2];return Math.sqrt(n*n+i*i+r*r)},r.dist=r.distance,r.squaredDistance=function(t,e){var n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2];return n*n+i*i+r*r},r.sqrDist=r.squaredDistance,r.length=function(t){var e=t[0],n=t[1],i=t[2];return Math.sqrt(e*e+n*n+i*i)},r.len=r.length,r.squaredLength=function(t){var e=t[0],n=t[1],i=t[2];return e*e+n*n+i*i},r.sqrLen=r.squaredLength,r.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},r.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},r.normalize=function(t,e){var n=e[0],i=e[1],r=e[2],a=n*n+i*i+r*r;return a>0&&(a=1/Math.sqrt(a),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a),t},r.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},r.cross=function(t,e,n){var i=e[0],r=e[1],a=e[2],o=n[0],s=n[1],l=n[2];return t[0]=r*l-a*s,t[1]=a*o-i*l,t[2]=i*s-r*o,t},r.lerp=function(t,e,n,i){var r=e[0],a=e[1],o=e[2];return t[0]=r+i*(n[0]-r),t[1]=a+i*(n[1]-a),t[2]=o+i*(n[2]-o),t},r.hermite=function(t,e,n,i,r,a){var o=a*a,s=o*(2*a-3)+1,l=o*(a-2)+a,u=o*(a-1),h=o*(3-2*a);return t[0]=e[0]*s+n[0]*l+i[0]*u+r[0]*h,t[1]=e[1]*s+n[1]*l+i[1]*u+r[1]*h,t[2]=e[2]*s+n[2]*l+i[2]*u+r[2]*h,t},r.bezier=function(t,e,n,i,r,a){var o=1-a,s=o*o,l=a*a,u=s*o,h=3*a*s,c=3*l*o,f=l*a;return t[0]=e[0]*u+n[0]*h+i[0]*c+r[0]*f,t[1]=e[1]*u+n[1]*h+i[1]*c+r[1]*f,t[2]=e[2]*u+n[2]*h+i[2]*c+r[2]*f,t},r.random=function(t,e){e=e||1;var n=2*i.RANDOM()*Math.PI,r=2*i.RANDOM()-1,a=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*a,t[1]=Math.sin(n)*a,t[2]=r*e,t},r.transformMat4=function(t,e,n){var i=e[0],r=e[1],a=e[2],o=n[3]*i+n[7]*r+n[11]*a+n[15];return o=o||1,t[0]=(n[0]*i+n[4]*r+n[8]*a+n[12])/o,t[1]=(n[1]*i+n[5]*r+n[9]*a+n[13])/o,t[2]=(n[2]*i+n[6]*r+n[10]*a+n[14])/o,t},r.transformMat3=function(t,e,n){var i=e[0],r=e[1],a=e[2];return t[0]=i*n[0]+r*n[3]+a*n[6],t[1]=i*n[1]+r*n[4]+a*n[7],t[2]=i*n[2]+r*n[5]+a*n[8],t},r.transformQuat=function(t,e,n){var i=e[0],r=e[1],a=e[2],o=n[0],s=n[1],l=n[2],u=n[3],h=u*i+s*a-l*r,c=u*r+l*i-o*a,f=u*a+o*r-s*i,d=-o*i-s*r-l*a;return t[0]=h*u+d*-o+c*-l-f*-s,t[1]=c*u+d*-s+f*-o-h*-l,t[2]=f*u+d*-l+h*-s-c*-o,t},r.rotateX=function(t,e,n,i){var r=[],a=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],a[0]=r[0],a[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),a[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t},r.rotateY=function(t,e,n,i){var r=[],a=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],a[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),a[1]=r[1],a[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t},r.rotateZ=function(t,e,n,i){var r=[],a=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],a[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),a[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),a[2]=r[2],t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t},r.forEach=function(){var t=r.create();return function(e,n,i,r,a,o){var s,l;for(n||(n=3),i||(i=0),l=r?Math.min(r*n+i,e.length):e.length,s=i;l>s;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],a(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}}(),r.angle=function(t,e){var n=r.fromValues(t[0],t[1],t[2]),i=r.fromValues(e[0],e[1],e[2]);r.normalize(n,n),r.normalize(i,i);var a=r.dot(n,i);return a>1?0:Math.acos(a)},r.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},r.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},r.equals=function(t,e){var n=t[0],r=t[1],a=t[2],o=e[0],s=e[1],l=e[2];return Math.abs(n-o)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-s)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(a-l)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(l))},e.exports=r},{"./common.js":2}],10:[function(t,e,n){var i=t("./common.js"),r={};r.create=function(){var t=new i.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},r.clone=function(t){var e=new i.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},r.fromValues=function(t,e,n,r){var a=new i.ARRAY_TYPE(4);return a[0]=t,a[1]=e,a[2]=n,a[3]=r,a},r.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},r.set=function(t,e,n,i,r){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t},r.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},r.subtract=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t},r.sub=r.subtract,r.multiply=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t},r.mul=r.multiply,r.divide=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t},r.div=r.divide,r.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},r.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},r.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},r.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},r.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},r.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},r.scaleAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t},r.distance=function(t,e){var n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2],a=e[3]-t[3];return Math.sqrt(n*n+i*i+r*r+a*a)},r.dist=r.distance,r.squaredDistance=function(t,e){var n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2],a=e[3]-t[3];return n*n+i*i+r*r+a*a},r.sqrDist=r.squaredDistance,r.length=function(t){var e=t[0],n=t[1],i=t[2],r=t[3];return Math.sqrt(e*e+n*n+i*i+r*r)},r.len=r.length,r.squaredLength=function(t){var e=t[0],n=t[1],i=t[2],r=t[3];return e*e+n*n+i*i+r*r},r.sqrLen=r.squaredLength,r.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},r.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},r.normalize=function(t,e){var n=e[0],i=e[1],r=e[2],a=e[3],o=n*n+i*i+r*r+a*a;return o>0&&(o=1/Math.sqrt(o),t[0]=n*o,t[1]=i*o,t[2]=r*o,t[3]=a*o),t},r.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},r.lerp=function(t,e,n,i){var r=e[0],a=e[1],o=e[2],s=e[3];return t[0]=r+i*(n[0]-r),t[1]=a+i*(n[1]-a),t[2]=o+i*(n[2]-o),t[3]=s+i*(n[3]-s),t},r.random=function(t,e){return e=e||1,t[0]=i.RANDOM(),t[1]=i.RANDOM(),t[2]=i.RANDOM(),t[3]=i.RANDOM(),r.normalize(t,t),r.scale(t,t,e),t},r.transformMat4=function(t,e,n){var i=e[0],r=e[1],a=e[2],o=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*a+n[12]*o,t[1]=n[1]*i+n[5]*r+n[9]*a+n[13]*o,t[2]=n[2]*i+n[6]*r+n[10]*a+n[14]*o,t[3]=n[3]*i+n[7]*r+n[11]*a+n[15]*o,t},r.transformQuat=function(t,e,n){var i=e[0],r=e[1],a=e[2],o=n[0],s=n[1],l=n[2],u=n[3],h=u*i+s*a-l*r,c=u*r+l*i-o*a,f=u*a+o*r-s*i,d=-o*i-s*r-l*a;return t[0]=h*u+d*-o+c*-l-f*-s,t[1]=c*u+d*-s+f*-o-h*-l,t[2]=f*u+d*-l+h*-s-c*-o,t[3]=e[3],t},r.forEach=function(){var t=r.create();return function(e,n,i,r,a,o){var s,l;for(n||(n=4),i||(i=0),l=r?Math.min(r*n+i,e.length):e.length,s=i;l>s;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],a(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}(),r.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},r.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},r.equals=function(t,e){var n=t[0],r=t[1],a=t[2],o=t[3],s=e[0],l=e[1],u=e[2],h=e[3];return Math.abs(n-s)<=i.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-l)<=i.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(a-u)<=i.EPSILON*Math.max(1,Math.abs(a),Math.abs(u))&&Math.abs(o-h)<=i.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))},e.exports=r},{"./common.js":2}],11:[function(t,e,n){(function(t){WebGLDebugUtils=function(){function e(t){if(null==p){p={},m={};for(var e in t)"number"==typeof t[e]&&(p[t[e]]=e,m[e]=t[e])}}function n(){if(null==p)throw"WebGLDebugUtils.init(ctx) not called"}function i(t){return n(),void 0!==p[t]}function r(t){n();var e=p[t];return void 0!==e?"gl."+e:"/*UNKNOWN WebGL ENUM*/ 0x"+t.toString(16)}function a(t,e,n,i){var a=d[t];if(void 0!==a){var a=a[e];if(void 0!==a&&a[n]){if("object"==typeof a[n]&&void 0!==a[n].enumBitwiseOr){for(var o=a[n].enumBitwiseOr,s=0,l=[],u=0;u<o.length;++u){var h=m[o[u]];0!==(i&h)&&(s|=h,l.push(r(h)))}return s===i?l.join(" | "):r(i)}return r(i)}}return null===i?"null":void 0===i?"undefined":i.toString()}function o(t,e){for(var n="",i=e.length,r=0;i>r;++r)n+=(0==r?"":", ")+a(t,i,r,e[r]);return n}function s(t,e,n){t.__defineGetter__(n,function(){return e[n]}),t.__defineSetter__(n,function(t){e[n]=t})}function l(t,n,i,o){function u(t,e){return function(){i&&i(e,arguments);var r=t[e].apply(t,arguments),a=o.getError();return 0!=a&&(h[a]=!0,n(a,e,arguments)),r}}o=o||t,e(t),n=n||function(t,e,n){for(var i="",o=n.length,s=0;o>s;++s)i+=(0==s?"":", ")+a(e,o,s,n[s]);f("WebGL error "+r(t)+" in "+e+"("+i+")")};var h={},c={};for(var d in t)if("function"==typeof t[d])if("getExtension"!=d)c[d]=u(t,d);else{var p=u(t,d);c[d]=function(){var e=p.apply(t,arguments);return l(e,n,i,o)}}else s(c,t,d);return c.getError=function(){for(var e in h)if(h.hasOwnProperty(e)&&h[e])return h[e]=!1,e;return t.NO_ERROR},c}function u(t){var e=t.getParameter(t.MAX_VERTEX_ATTRIBS),n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n);for(var i=0;e>i;++i)t.disableVertexAttribArray(i),t.vertexAttribPointer(i,4,t.FLOAT,!1,0,0),t.vertexAttrib1f(i,0);t.deleteBuffer(n);for(var r=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),i=0;r>i;++i)t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_CUBE_MAP,null),t.bindTexture(t.TEXTURE_2D,null);for(t.activeTexture(t.TEXTURE0),t.useProgram(null),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.DITHER),t.disable(t.SCISSOR_TEST),t.blendColor(0,0,0,0),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.clearColor(0,0,0,0),t.clearDepth(1),t.clearStencil(-1),t.colorMask(!0,!0,!0,!0),t.cullFace(t.BACK),t.depthFunc(t.LESS),t.depthMask(!0),t.depthRange(0,1),t.frontFace(t.CCW),t.hint(t.GENERATE_MIPMAP_HINT,t.DONT_CARE),t.lineWidth(1),t.pixelStorei(t.PACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.UNPACK_COLORSPACE_CONVERSION_WEBGL&&t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.BROWSER_DEFAULT_WEBGL),t.polygonOffset(0,0),t.sampleCoverage(1,!1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilMask(4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT);t.getError(););}function h(t){function e(t){return"function"==typeof t?t:function(e){t.handleEvent(e)}}function n(t){var e=t.addEventListener;t.addEventListener=function(n,i,r){switch(n){case"webglcontextlost":I(i);break;case"webglcontextrestored":D(i);break;default:e.apply(t,arguments)}}}function i(){for(var t=Object.keys(_),e=0;e<t.length;++e)delete _[t]}function r(){++v,M||x==v&&t.loseContext()}function a(t,e){var n=t[e];return function(){if(r(),!M){var e=n.apply(t,arguments);return e}}}function o(){for(var t=0;t<g.length;++t){var e=g[t];e instanceof WebGLBuffer?c.deleteBuffer(e):e instanceof WebGLFramebuffer?c.deleteFramebuffer(e):e instanceof WebGLProgram?c.deleteProgram(e):e instanceof WebGLRenderbuffer?c.deleteRenderbuffer(e):e instanceof WebGLShader?c.deleteShader(e):e instanceof WebGLTexture&&c.deleteTexture(e)}}function l(t){return{statusMessage:t,preventDefault:function(){b=!0}}}function h(t){for(var e in t)"function"==typeof t[e]?f[e]=a(t,e):s(f,t,e);f.getError=function(){if(r(),!M)for(var t;t=c.getError();)_[t]=!0;for(var t in _)if(_[t])return delete _[t],t;return f.NO_ERROR};for(var n=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],i=0;i<n.length;++i){var o=n[i];f[o]=function(e){return function(){if(r(),M)return null;var n=e.apply(t,arguments);return n.__webglDebugContextLostId__=m,g.push(n),n}}(t[o])}for(var l=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"],i=0;i<l.length;++i){var o=l[i];f[o]=function(e){return function(){return r(),M?null:e.apply(t,arguments)}}(f[o])}for(var u=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"],i=0;i<u.length;++i){var o=u[i];f[o]=function(e){return function(){return r(),M?!1:e.apply(t,arguments)}}(f[o])}return f.checkFramebufferStatus=function(e){return function(){return r(),M?f.FRAMEBUFFER_UNSUPPORTED:e.apply(t,arguments)}}(f.checkFramebufferStatus),f.getAttribLocation=function(e){return function(){return r(),M?-1:e.apply(t,arguments)}}(f.getAttribLocation),f.getVertexAttribOffset=function(e){return function(){return r(),M?0:e.apply(t,arguments)}}(f.getVertexAttribOffset),f.isContextLost=function(){return M},f}var c,f,d=[],p=[],f={},m=1,M=!1,g=[],x=0,v=0,b=!1,S=0,_={};t.getContext=function(e){return function(){var n=e.apply(t,arguments);if(n instanceof WebGLRenderingContext){if(n!=c){if(c)throw"got different context";c=n,f=h(c)}return f}return n}}(t.getContext);var I=function(t){d.push(e(t))},D=function(t){p.push(e(t))};return n(t),t.loseContext=function(){if(!M){for(M=!0,x=0,++m;c.getError(););i(),_[c.CONTEXT_LOST_WEBGL]=!0;var e=l("context lost"),n=d.slice();setTimeout(function(){for(var i=0;i<n.length;++i)n[i](e);S>=0&&setTimeout(function(){t.restoreContext()},S)},0)}},t.restoreContext=function(){M&&p.length&&setTimeout(function(){if(!b)throw"can not restore. webglcontestlost listener did not call event.preventDefault";o(),u(c),M=!1,v=0,b=!1;for(var t=p.slice(),e=l("context restored"),n=0;n<t.length;++n)t[n](e)},0)},t.loseContextInNCalls=function(t){if(M)throw"You can not ask a lost contet to be lost";x=v+t},t.getNumCalls=function(){return v},t.setRestoreTimeout=function(t){S=t},t}"undefined"==typeof window&&(window=t);var c=function(t){window.console&&window.console.log&&window.console.log(t)},f=function(t){window.console&&window.console.error?window.console.error(t):c(t)},d={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},p=null,m=null;return{init:e,mightBeEnum:i,glEnumToString:r,glFunctionArgToString:a,glFunctionArgsToString:o,makeDebugContext:l,makeLostContextSimulatingCanvas:h,resetToInitialState:u}}(),e.exports=WebGLDebugUtils}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],12:[function(t,e,n){"use strict";var i={};i.images={jolicraft:"./image/jolicraft.png",ldfaithful:"./image/ldfaithful.png",oryx:"./image/oryx.png"},i.sounds={},i.bgms={},e.exports=i},{}],13:[function(t,e,n){"use strict";var i=t("gl-matrix"),r=function(){this.matrix=i.mat4.create(),i.mat4.identity(this.matrix),this.theta=[1.7*Math.PI,0,.5*Math.PI],this.center=[0,0,0],this.up=[0,0,1],this.pos=[0,0,0],this.thetaLimits=[1.5*Math.PI,1.8*Math.PI],this.distanceLimits=[2,15],this.zoomWeight=.1,this.currentDistance=(this.distanceLimits[0]+this.distanceLimits[1])/2,this.desiredDistance=this.currentDistance,this.updateMatrix()};r.prototype.checkCollision=function(t){return!1},r.prototype.moveCenter=function(t,e){if(this.center=t.slice(0),e)for(var n=0;3>n;n++)this.center[n]+=e[n]},r.prototype.changeAngle=function(t){this.theta[0]-=t[0],this.theta[1]-=t[1],this.theta[2]-=t[2],this.theta[0]=this.theta[0].clamp(this.thetaLimits[0],this.thetaLimits[1])},r.prototype.setAngle=function(t){this.theta=t,this.theta[0]=this.theta[0].clamp(this.thetaLimits[0],this.thetaLimits[1])},r.prototype.changeDistance=function(t){this.desiredDistance+=t,this.desiredDistance=this.desiredDistance.clamp(this.distanceLimits[0],this.distanceLimits[1])},r.prototype.setDistance=function(t){this.desiredDistance=t,this.desiredDistance=this.desiredDistance.clamp(this.distanceLimits[0],this.distanceLimits[1])},r.prototype.sphericalToCartesian=function(t,e,n){return[t[0]+e*Math.sin(n[0])*Math.cos(n[2]),t[1]+e*Math.sin(n[0])*Math.sin(n[2]),t[2]+e*Math.cos(n[0])];
},r.prototype.updateMatrix=function(t){for(var e=0;3>e;e++)this.theta[e]<0?this.theta[e]+=2*Math.PI:this.theta[e]>2*Math.PI&&(this.theta[e]-=2*Math.PI);t&&(this.currentDistance*=1-this.zoomWeight,this.currentDistance+=this.zoomWeight*this.desiredDistance),this.pos=this.sphericalToCartesian(this.center,this.currentDistance,this.theta),i.mat4.lookAt(this.matrix,this.pos,this.center,this.up)},e.exports=r},{"gl-matrix":1}],14:[function(t,e,n){"use strict";var i=t("./debug_constant"),r={DEBUG:{}};i.ON&&(r.DEBUG=i),e.exports=r},{"./debug_constant":16}],15:[function(t,e,n){"use strict";function i(t,e){e.u.Light=[];for(var n=0;4>n;n++){var i=e.u.Light;i[n]={};for(var r in new a)i[n][r]=t.getUniformLocation(e.program,"uLight["+n+"]."+r)}}var r=t("./programs"),a=t("./point_light"),o=function(t){var e=r(t);return i(t,e.world),i(t,e.sprites),e.background=[0,0,0,1],e.rotateSpeed=.01,e.zoomFactor=.01,t.enable(t.DEPTH_TEST),t.useProgram(e.world.program),e};e.exports=o},{"./point_light":36,"./programs":37}],16:[function(t,e,n){"use strict";var i={ON:!0,SOUND_OFF:!0,START_STAGE_NO:1};e.exports=i},{}],17:[function(t,e,n){"use strict";var i=function(t,e){return null==e&&(e=t,t=0),Math.floor(Math.random()*(e-t))+t},r=function(){var t=function(t,e,n,r){this.id=t,this.connected=!1,this.unconnectedNeighbors=[],this.connectedTo=[];var a=[i(e[0],n[0]),i(e[1],n[1])],o=[n[0]-a[0],n[1]-a[1]],s=[r[0]+i(o[0])+1,r[1]+i(o[1])+1];this.rect=[s[0],s[1],a[0],a[1]]};return t.prototype.removeFromUnconnected=function(t){for(var e=0;e<this.unconnectedNeighbors.length;e++)if(this.unconnectedNeighbors[e].id==t)return void this.unconnectedNeighbors.splice(e,1)},t.prototype.connectTo=function(t){var e=this.unconnectedNeighbors[t];return this.connectedTo.push(e),this.unconnectedNeighbors.splice(t,1),e.removeFromUnconnected(this.id),this.connected=!0,e.connected=!0,e},t.prototype.connectRandom=function(){if(0==this.unconnectedNeighbors.length)return!1;var t=i(this.unconnectedNeighbors.length);return this.connectTo(t)},t.prototype.connectToConnected=function(){for(var t=[],e=0;e<this.unconnectedNeighbors.length;e++)t.push(e);for(;t.length>0;){var n=i(t.length);if(this.unconnectedNeighbors[t[n]].connected)return this.connectTo(t[n]);t.splice(n,1)}return!1},t}(),a=function(t,e,n){this.tileDim=t,this.roomDim=e,this.numRooms=e[0]*e[1],this.roomGrid=[Math.floor(t[0]/e[0]),Math.floor(t[1]/e[1])],this.rooms=[],this.firstRoom=0,this.lastRoom=0,this.tileVals={wall:"#",floor:" ",empty:".",up:"u",down:"d"};for(var a=[],o=0;o<t[0];o++){a[o]=[];for(var s=0;s<t[1];s++)a[o][s]=this.tileVals.wall}this.tiles=a;var l=[t[0]/e[0]-2,t[1]/e[1]-2];n||(n=[2,2]);for(var u=[],o=0;o<e[0];o++){u[o]=[];for(var s=0;s<e[1];s++)u[o][s]=new r(o*e[0]+s,n,l,[this.roomGrid[0]*o,this.roomGrid[1]*s])}for(var o=0;o<e[0];o++)for(var s=0;s<e[1];s++)o>0&&u[o][s].unconnectedNeighbors.push(u[o-1][s]),o<e[0]-1&&u[o][s].unconnectedNeighbors.push(u[o+1][s]),s>0&&u[o][s].unconnectedNeighbors.push(u[o][s-1]),s<e[1]-1&&u[o][s].unconnectedNeighbors.push(u[o][s+1]);this.rooms=u,this.getRoomFromCoords=function(t,e){return this.rooms[t*this.rooms.length][e]},this.getRoomFromId=function(t){return this.rooms[Math.floor(t/this.roomDim[0])][t%this.roomDim[1]]},this.generate=function(){for(var t=[],e=0;e<this.numRooms;e++)t[e]=e;for(var n=i(this.numRooms),r=this.getRoomFromId(n),a=n;r&&r.unconnectedNeighbors.length>0;){n=r.id;var o=t.indexOf(n);o>=0&&t.splice(o,1),r=r.connectRandom()}for(;t.length>0;){var s=i(t.length);r=this.getRoomFromId(t[s]),r.connectToConnected()&&t.splice(s,1)}for(var l=r.id,e=0;e<this.numRooms;e++){var u=this.getRoomFromId(e);this.fillRoom(u);for(var h=0;h<u.connectedTo.length;h++)this.connectRooms(u,u.connectedTo[h])}var u=this.getRoomFromId(a);this.upStairsPos=[u.rect[0]+i(u.rect[2]),u.rect[1]+i(u.rect[3])],this.plot(this.upStairsPos[0],this.upStairsPos[1],this.tileVals.up),u=this.getRoomFromId(l),this.downStairsPos=[u.rect[0]+i(u.rect[2]),u.rect[1]+i(u.rect[3])],this.plot(this.downStairsPos[0],this.downStairsPos[1],this.tileVals.down),this.cleanUpWalls()},this.plot=function(t,e,n){n||(n=this.tileVals.floor),this.tiles[Math.floor(t)][Math.floor(e)]=n},this.fillRoom=function(t){for(var e=t.rect[0];e<t.rect[0]+t.rect[2];e++)for(var n=t.rect[1];n<t.rect[1]+t.rect[3];n++)this.plot(e,n)},this.fillHallway=function(t,e,n,i){for(var r=Math.abs(n-t),a=Math.abs(i-e),o=n>t?1:-1,s=i>e?1:-1,l=r-a;this.plot(t,e),this.plot(t-1,e),this.plot(t+1,e),this.plot(t,e-1),this.plot(t,e+1),t!=n||e!=i;){var u=2*l;u>-a&&(l-=a,t+=o),r>u&&(l+=r,e+=s)}},this.connectRooms=function(t,e){this.fillHallway(Math.floor(t.rect[0]+t.rect[2]/2),Math.floor(t.rect[1]+t.rect[3]/2),Math.floor(e.rect[0]+e.rect[2]/2),Math.floor(e.rect[1]+e.rect[3]/2))},this.cleanUpWalls=function(){for(var t=0;t<this.tileDim[0];t++)for(var e=0;e<this.tileDim[1];e++)this.tiles[t][e]==this.tileVals.wall&&(t>0&&this.isWalkable(t-1,e)||t<this.tileDim[0]-1&&this.isWalkable(t+1,e)||e>0&&this.isWalkable(t,e-1)||e<this.tileDim[1]-1&&this.isWalkable(t,e+1)||(this.tiles[t][e]=this.tileVals.empty))},this.isWalkable=function(t,e){return this.tiles[t][e]!=this.tileVals.wall&&this.tiles[t][e]!=this.tileVals.empty},this.printDungeon=function(){for(var t="",e=0;e<this.tileDim[0];e++){t+="\n";for(var n=0;n<this.tileDim[1];n++)t+=this.tiles[e][n]}console.log(t)},this.generate()};e.exports=a},{}],18:[function(t,e,n){"use strict";var i=t("./dungeon"),r=function(t){function e(t){return t[Math.floor(Math.random()*t.length)]}function n(n){return 0==n?0:e(t.wallTiles)}function r(n){return n>0?0:e(t.floorTiles)}function a(t){return t>0?0:212}function o(t){return t>0?0:211}for(var s=[],l=[0,0,0],u=[0,0,0],h=t.tileDim,c=t.roomDim,f=t.roomMinSize,d=new i(h,c,f),p=0;2>p;p++){s[p]=[];for(var m=0;m<d.tileDim[1];m++){s[p][m]=[];for(var M=0;M<d.tileDim[0];M++)switch(d.tiles[M][m]){case d.tileVals.empty:s[p][m][M]=0;break;case d.tileVals.wall:s[p][m][M]=n(p);break;case d.tileVals.floor:s[p][m][M]=r(p);break;case d.tileVals.up:s[p][m][M]=a(p),l=[M,m,1.2];break;case d.tileVals.down:s[p][m][M]=o(p),u=[M,m,1.2]}}}return{cubes:s,upstairs:l,downstairs:u}};e.exports=r},{"./dungeon":17}],19:[function(t,e,n){"use strict";var i=t("./hakurei").core,r=t("./hakurei").util,a=t("./constant"),o=(t("./gl"),t("./scene/loading")),s=t("./scene/stage"),l=function(t){i.apply(this,arguments)};r.inherit(l,i),l.prototype.init=function(){i.prototype.init.apply(this,arguments),this.addScene("loading",new o(this)),this.addScene("stage",new s(this)),this.changeScene("loading")},l.prototype.playSound=function(){return a.DEBUG.SOUND_OFF?void 0:this.audio_loader.playSound.apply(this.audio_loader,arguments)},l.prototype.playBGM=function(){return a.DEBUG.SOUND_OFF?void 0:this.audio_loader.playBGM.apply(this.audio_loader,arguments)},l.prototype.stopBGM=function(){return a.DEBUG.SOUND_OFF?void 0:this.audio_loader.stopBGM.apply(this.audio_loader,arguments)},e.exports=l},{"./constant":14,"./gl":20,"./hakurei":21,"./scene/loading":38,"./scene/stage":39}],20:[function(t,e,n){"use strict";var i=t("webgl-debug"),r=function(t){var e;try{e=t.getContext("webgl")||t.getContext("experimental-webgl"),e=i.makeDebugContext(e)}catch(n){window.alert(n)}return e||window.alert("Could not initialize WebGL"),e};e.exports=r},{"webgl-debug":11}],21:[function(t,e,n){"use strict";e.exports=t("./hakureijs/index")},{"./hakureijs/index":27}],22:[function(t,e,n){"use strict";var i=function(){this.sounds={},this.bgms={},this.loading_audio_num=0,this.loaded_audio_num=0,this.id=0,this.soundflag=0,this.audio_context=new window.AudioContext,this.audio_context.createGain=this.audio_context.createGain||this.audio_context.createGainNode,this.audio_source=null};i.prototype.init=function(){this.sounds={},this.bgms={},this.loading_audio_num=0,this.loaded_audio_num=0,this.id=0,this.soundflag=0},i.prototype.loadSound=function(t,e,n){var i=this;i.loading_audio_num++,n||(n=1);var r=function(){i.loaded_audio_num++},a=new Audio(e);a.volume=n,a.addEventListener("canplay",r),a.load(),i.sounds[t]={id:1<<i.id++,audio:a}},i.prototype.loadBGM=function(t,e,n,i,r){var a=this;a.loading_audio_num++;var o=function(e){a.loaded_audio_num++,a.bgms[t]={audio:e,volume:n,loopStart:i,loopEnd:r}},s=function(t){throw t instanceof Error?new Error(t.message):t},l=new XMLHttpRequest;l.onload=function(){if(200===l.status){var t=l.response;a.audio_context.decodeAudioData(t,o,s)}},l.open("GET",e,!0),l.responseType="arraybuffer",l.send(null)},i.prototype.isAllLoaded=function(){return this.loaded_audio_num>0&&this.loaded_audio_num===this.loading_audio_num},i.prototype.playSound=function(t){this.soundflag|=this.sounds[t].id},i.prototype.executePlaySound=function(){for(var t in this.sounds)this.soundflag&this.sounds[t].id&&(this.sounds[t].audio.pause(),this.sounds[t].audio.currentTime=0,this.sounds[t].audio.play(),this.soundflag&=~this.sounds[t].id)},i.prototype.playBGM=function(t){var e=this;e.stopBGM(),e.audio_source=e._createSourceNode(t),e.audio_source.start(0)},i.prototype.stopBGM=function(){var t=this;t.isPlayingBGM()&&(t.audio_source.stop(0),t.audio_source=null)},i.prototype.isPlayingBGM=function(){return this.audio_source?!0:!1},i.prototype._createSourceNode=function(t){var e=this,n=e.bgms[t],i=e.audio_context.createBufferSource();i.buffer=n.audio,(n.loopStart||n.loopEnd)&&(i.loop=!0),n.loopStart&&(i.loopStart=n.loopStart),n.loopEnd&&(i.loopEnd=n.loopEnd);var r=this.audio_context.createGain();return r.gain.value=n.volume||1,i.connect(r),r.connect(e.audio_context.destination),i.start=i.start||i.noteOn,i.stop=i.stop||i.noteOff,i},i.prototype.progress=function(){return this.loaded_audio_num/this.loading_audio_num},e.exports=i},{}],23:[function(t,e,n){"use strict";var i=function(){this.is_done=!1};i.prototype.init=function(){this.is_done=!1},i.prototype.isAllLoaded=function(){return this.is_done},i.prototype.notifyLoadingDone=function(){this.is_done=!0},i.prototype.progress=function(){return this.is_done?1:0},e.exports=i},{}],24:[function(t,e,n){"use strict";var i=function(){this.images={},this.loading_image_num=0,this.loaded_image_num=0};i.prototype.init=function(){for(var t in this.images)this.images[t].src="";this.images={},this.loading_image_num=0,this.loaded_image_num=0},i.prototype.loadImage=function(t,e){var n=this;n.loading_image_num++;var i=function(){n.loaded_image_num++},r=new Image;r.src=e,r.onload=i,this.images[t]=r},i.prototype.isAllLoaded=function(){return this.loaded_image_num>0&&this.loaded_image_num===this.loading_image_num},i.prototype.getImage=function(t){return this.images[t]},i.prototype.progress=function(){return this.loaded_image_num/this.loading_image_num},e.exports=i},{}],25:[function(t,e,n){"use strict";var i={BUTTON_LEFT:1,BUTTON_UP:2,BUTTON_RIGHT:4,BUTTON_DOWN:8,BUTTON_Z:16,BUTTON_X:32,BUTTON_SHIFT:64,BUTTON_SPACE:128};e.exports=i},{}],26:[function(t,e,n){"use strict";var i=t("./constant"),r=t("./asset_loader/image"),a=t("./asset_loader/audio"),o=t("./asset_loader/font"),s=function(t){this.canvas_dom=t,this.ctx=this.canvas_dom.getContext("2d"),this.width=Number(t.getAttribute("width")),this.height=Number(t.getAttribute("height")),this.current_scene=null,this._reserved_next_scene=null,this.scenes={},this.frame_count=0,this.request_id=null,this.current_keyflag=0,this.before_keyflag=0,this.is_connect_gamepad=!1,this.image_loader=new r,this.audio_loader=new a,this.font_loader=new o};s.prototype.init=function(){this.current_scene=null,this._reserved_next_scene=null,this.frame_count=0,this.request_id=null,this.current_keyflag=0,this.before_keyflag=0,this.is_connect_gamepad=!1,this.image_loader.init()},s.prototype.enableGamePad=function(){this.is_connect_gamepad=!0},s.prototype.isRunning=function(){return this.request_id?!0:!1},s.prototype.startRun=function(){this.isRunning()||this.run()},s.prototype.run=function(){this.handleGamePad(),this.changeNextSceneIfReserved(),this.audio_loader.executePlaySound();var t=this.currentScene();t&&(t.beforeDraw(),this.clearCanvas(),t.draw(),t.afterDraw()),this.before_keyflag=this.current_keyflag,this.frame_count++,this.request_id=requestAnimationFrame(this.run.bind(this))},s.prototype.currentScene=function(){return null!==this.current_scene?this.scenes[this.current_scene]:void 0},s.prototype.addScene=function(t,e){this.scenes[t]=e},s.prototype.changeScene=function(){var t=Array.prototype.slice.call(arguments);this._reserved_next_scene=t},s.prototype.changeNextSceneIfReserved=function(){if(this._reserved_next_scene){this.current_scene=this._reserved_next_scene.shift();var t=this.currentScene();t.init.apply(t,this._reserved_next_scene),this._reserved_next_scene=null}},s.prototype.clearCanvas=function(){this.ctx.clearRect(0,0,this.width,this.height)},s.prototype.handleKeyDown=function(t){this.current_keyflag|=this._keyCodeToBitCode(t.keyCode),t.preventDefault()},s.prototype.handleKeyUp=function(t){this.current_keyflag&=~this._keyCodeToBitCode(t.keyCode),t.preventDefault()},s.prototype.isKeyDown=function(t){return this.current_keyflag&t?!0:!1},s.prototype.isKeyPush=function(t){return!(this.before_keyflag&t)&&this.current_keyflag&t},s.prototype._keyCodeToBitCode=function(t){var e;switch(t){case 16:e=i.BUTTON_SHIFT;break;case 32:e=i.BUTTON_SPACE;break;case 37:e=i.BUTTON_LEFT;break;case 38:e=i.BUTTON_UP;break;case 39:e=i.BUTTON_RIGHT;break;case 40:e=i.BUTTON_DOWN;break;case 88:e=i.BUTTON_X;break;case 90:e=i.BUTTON_Z}return e},s.prototype.handleGamePad=function(){if(this.is_connect_gamepad){var t=navigator.getGamepads(),e=t[0];e&&(this.current_keyflag=0,this.current_keyflag|=e.buttons[1].pressed?i.BUTTON_Z:0,this.current_keyflag|=e.buttons[0].pressed?i.BUTTON_X:0,this.current_keyflag|=e.buttons[2].pressed?i.BUTTON_SELECT:0,this.current_keyflag|=e.buttons[3].pressed?i.BUTTON_START:0,this.current_keyflag|=e.buttons[4].pressed?i.BUTTON_SHIFT:0,this.current_keyflag|=e.buttons[5].pressed?i.BUTTON_SHIFT:0,this.current_keyflag|=e.buttons[6].pressed?i.BUTTON_SPACE:0,this.current_keyflag|=e.axes[1]<-.5?i.BUTTON_UP:0,this.current_keyflag|=e.axes[1]>.5?i.BUTTON_DOWN:0,this.current_keyflag|=e.axes[0]<-.5?i.BUTTON_LEFT:0,this.current_keyflag|=e.axes[0]>.5?i.BUTTON_RIGHT:0)}},s.prototype.fullscreen=function(){var t=this.canvas_dom;t.requestFullscreen?t.requestFullscreen():t.msRequestuestFullscreen?t.msRequestuestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()},s.prototype.fontLoadingDone=function(){this.font_loader.notifyLoadingDone()},s.prototype.setupEvents=function(){if(window){var t=this;window.AudioContext=function(){return window.AudioContext||window.webkitAudioContext}(),window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}(),window.document&&window.document.fonts?window.document.fonts.addEventListener("loadingdone",function(){t.fontLoadingDone()}):t.fontLoadingDone(),window.onkeydown=function(e){t.handleKeyDown(e)},window.onkeyup=function(e){t.handleKeyUp(e)},window.Gamepad&&window.navigator&&window.navigator.getGamepads&&t.enableGamePad()}},e.exports=s},{"./asset_loader/audio":22,"./asset_loader/font":23,"./asset_loader/image":24,"./constant":25}],27:[function(t,e,n){"use strict";e.exports={util:t("./util"),core:t("./core"),constant:t("./constant"),serif_manager:t("./serif_manager"),scene:{base:t("./scene/base")},object:{base:t("./object/base"),sprite:t("./object/sprite"),pool_manager:t("./object/pool_manager")},asset_loader:{image:t("./asset_loader/image")}}},{"./asset_loader/image":24,"./constant":25,"./core":26,"./object/base":28,"./object/pool_manager":29,"./object/sprite":30,"./scene/base":31,"./serif_manager":32,"./util":33}],28:[function(t,e,n){"use strict";var i=t("../util"),r=0,a=!1,o=function(t,e){this.scene=t,this.core=t.core,this.parent=e,this.id=++r,this.frame_count=0,this._x=0,this._y=0,this.auto_disable_times_map={},this.velocity={magnitude:0,theta:0},this.objects=[]};o.prototype.init=function(){this.frame_count=0,this._x=0,this._y=0,this.auto_disable_times_map={};for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].init()},o.prototype.beforeDraw=function(){this.frame_count++,this.checkAutoDisableFlags();for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].beforeDraw();this.move()},o.prototype.draw=function(){var t=this.core.ctx;a&&(t.save(),t.fillStyle="rgb( 255, 255, 255 )",t.globalAlpha=.4,t.fillRect(this.getCollisionLeftX(),this.getCollisionUpY(),this.collisionWidth(),this.collisionHeight()),t.restore());for(var e=0,n=this.objects.length;n>e;e++)this.objects[e].draw()},o.prototype.afterDraw=function(){for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].afterDraw()},o.prototype.addSubObject=function(t){this.objects.push(t)},o.prototype.removeSubObject=function(t){for(var e=0,n=this.objects.length;n>e;e++)if(this.objects[e].id===t.id){this.objects.splice(e,1);break}},o.prototype.move=function(){var t=i.calcMoveXByVelocity(this.velocity),e=i.calcMoveYByVelocity(this.velocity);this._x+=t,this._y+=e},o.prototype.onCollision=function(){},o.prototype.width=function(){return 0},o.prototype.height=function(){return 0},o.prototype.globalCenterX=function(){return this.scene.x()+this.x()},o.prototype.globalCenterY=function(){return this.scene.y()+this.y()},o.prototype.globalLeftX=function(){return this.scene.x()+this.x()-this.width()/2},o.prototype.globalRightX=function(){return this.scene.x()+this.x()+this.width()/2},o.prototype.globalUpY=function(){return this.scene.x()+this.y()-this.height()/2},o.prototype.globalDownY=function(){return this.scene.x()+this.y()+this.height()/2},o.prototype.collisionWidth=function(){return 0},o.prototype.collisionHeight=function(){return 0},o.prototype.checkCollisionWithObject=function(t){var e=this;t.checkCollision(e)&&(t.onCollision(e),e.onCollision(t))},o.prototype.checkCollisionWithObjects=function(t){for(var e=this,n=0;n<t.length;n++){var i=t[n];e.checkCollision(i)&&(e.onCollision(i),i.onCollision(e))}},o.prototype.checkCollision=function(t){return Math.abs(this.x()-t.x())<this.collisionWidth()/2+t.collisionWidth()/2&&Math.abs(this.y()-t.y())<this.collisionHeight()/2+t.collisionHeight()/2?!0:!1},o.prototype.getCollisionLeftX=function(){return this.x()-this.collisionWidth()/2},o.prototype.getCollisionRightX=function(){return this.x()+this.collisionWidth()/2},o.prototype.getCollisionUpY=function(){return this.y()-this.collisionHeight()/2},o.prototype.getCollisionDownY=function(){return this.y()+this.collisionHeight()/2},o.prototype.setAutoDisableFlag=function(t,e){var n=this;n[t]=!0,n.auto_disable_times_map[t]=n.frame_count+e},o.prototype.checkAutoDisableFlags=function(){var t=this;for(var e in t.auto_disable_times_map)this.auto_disable_times_map[e]<t.frame_count&&(t[e]=!1,delete t.auto_disable_times_map[e])},o.prototype.x=function(t){return"undefined"!=typeof t&&(this._x=t),this._x},o.prototype.y=function(t){return"undefined"!=typeof t&&(this._y=t),this._y},o.prototype.setVelocity=function(t){this.velocity=t},e.exports=o},{"../util":33}],29:[function(t,e,n){"use strict";var i=t("./base"),r=t("../util"),a=function(t,e){i.apply(this,arguments),this.Class=e,this.objects={}};r.inherit(a,i),a.prototype.init=function(){i.prototype.init.apply(this,arguments),this.objects={}},a.prototype.beforeDraw=function(){i.prototype.beforeDraw.apply(this,arguments);for(var t in this.objects)this.objects[t].beforeDraw()},a.prototype.draw=function(){i.prototype.draw.apply(this,arguments);for(var t in this.objects)this.objects[t].draw()},a.prototype.afterDraw=function(){i.prototype.afterDraw.apply(this,arguments);for(var t in this.objects)this.objects[t].afterDraw()},a.prototype.create=function(){var t=new this.Class(this.scene);return t.init.apply(t,arguments),this.objects[t.id]=t,t},a.prototype.remove=function(t){delete this.objects[t]},a.prototype.checkCollisionWithObject=function(t){for(var e in this.objects){var n=this.objects[e];t.checkCollision(n)&&(t.onCollision(n),n.onCollision(t))}},a.prototype.checkCollisionWithManager=function(t){for(var e in this.objects)for(var n in t.objects)if(this.objects[e].checkCollision(t.objects[n])){var i=this.objects[e],r=t.objects[n];if(i.onCollision(r),r.onCollision(i),!this.objects[e])break}},e.exports=a},{"../util":33,"./base":28}],30:[function(t,e,n){"use strict";var i=t("./base"),r=t("../util"),a=function(t){i.apply(this,arguments),this.current_sprite_index=0};r.inherit(a,i),a.prototype.init=function(){i.prototype.init.apply(this,arguments),this.current_sprite_index=0},a.prototype.beforeDraw=function(){i.prototype.beforeDraw.apply(this,arguments),this.frame_count%this.spriteAnimationSpan()===0&&(this.current_sprite_index++,this.current_sprite_index>=this.spriteIndices().length&&(this.current_sprite_index=0))},a.prototype.draw=function(){if(this.isShow()){var t=this.core.image_loader.getImage(this.spriteName());this.scale()&&console.error("scale method is deprecated. you should use scaleWidth and scaleHeight.");var e=this.core.ctx;e.save(),e.translate(this.globalCenterX(),this.globalCenterY());var n=r.thetaToRadian(this.velocity.theta+this.rotateAdjust());e.rotate(n);var a=this.spriteWidth(),o=this.spriteHeight();a||(a=t.width),o||(o=t.height);var s=this.width(),l=this.height();this.isReflect()&&e.transform(-1,0,0,1,0,0),e.drawImage(t,a*this.spriteIndexX(),o*this.spriteIndexY(),a,o,-s/2,-l/2,s,l),e.restore()}i.prototype.draw.apply(this,arguments)},a.prototype.spriteName=function(){throw new Error("spriteName method must be overridden.")},a.prototype.spriteIndexX=function(){return this.spriteIndices()[this.current_sprite_index].x},a.prototype.spriteIndexY=function(){return this.spriteIndices()[this.current_sprite_index].y},a.prototype.width=function(){return this.spriteWidth()*this.scaleWidth()},a.prototype.height=function(){return this.spriteHeight()*this.scaleHeight()},a.prototype.isShow=function(){return!0},a.prototype.spriteAnimationSpan=function(){return 0},a.prototype.spriteIndices=function(){return[{x:0,y:0}]},a.prototype.spriteWidth=function(){return 0},a.prototype.spriteHeight=function(){return 0},a.prototype.rotateAdjust=function(){return 0},a.prototype.scale=function(){return 0},a.prototype.scaleWidth=function(){return 1},a.prototype.scaleHeight=function(){return 1},a.prototype.isReflect=function(){return!1},e.exports=a},{"../util":33,"./base":28}],31:[function(t,e,n){"use strict";var i=function(t,e){this.core=t,this.parent=e,this.width=this.core.width,this.height=this.core.height,this._x=0,this._y=0,this.frame_count=0,this.objects=[],this.current_scene=null,this._reserved_next_scene=null,this.scenes={}};i.prototype.init=function(){this.current_scene=null,this._reserved_next_scene=null,this._x=0,this._y=0,this.frame_count=0;for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].init()},i.prototype.beforeDraw=function(){this.frame_count++,this.changeNextSubSceneIfReserved();for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].beforeDraw();this.currentSubScene()&&this.currentSubScene().beforeDraw()},i.prototype.draw=function(){for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].draw();this.currentSubScene()&&this.currentSubScene().draw()},i.prototype.afterDraw=function(){for(var t=0,e=this.objects.length;e>t;t++)this.objects[t].afterDraw();this.currentSubScene()&&this.currentSubScene().afterDraw()},i.prototype.addObject=function(t){this.objects.push(t)},i.prototype.currentSubScene=function(){return null!==this.current_scene?this.scenes[this.current_scene]:void 0},i.prototype.addSubScene=function(t,e){this.scenes[t]=e},i.prototype.changeSubScene=function(){var t=Array.prototype.slice.call(arguments);this._reserved_next_scene=t},i.prototype.changeNextSubSceneIfReserved=function(){if(this._reserved_next_scene){this.current_scene=this._reserved_next_scene.shift();var t=this.currentSubScene();t.init.apply(t,this._reserved_next_scene),this._reserved_next_scene=null}},i.prototype.x=function(t){return"undefined"!=typeof t&&(this._x=t),this._x},i.prototype.y=function(t){return"undefined"!=typeof t&&(this._y=t),this._y},e.exports=i},{}],32:[function(t,e,n){"use strict";var i=function(){this.timeoutID=null,this.script=null,this.progress=null,this.left_chara_id=null,this.left_exp=null,this.right_chara_id=null,this.right_exp=null,this.pos=null,this.line_num=0,this.printing_lines=[]};i.prototype.init=function(t){t||console.error("set script arguments to use serif_manager class"),this.script=t,this.progress=-1,this.timeoutID=null,this.left_chara_id=null,this.left_exp=null,this.right_chara_id=null,this.right_exp=null,this.pos=null,this.line_num=0,this.printing_lines=[],this.is_end()||this.next()},i.prototype.is_end=function(){return this.progress+1===this.script.length},i.prototype.next=function(){this.progress++;var t=this.script[this.progress];this._showChara(t),t.serif?this._printMessage(t.serif):this.next()},i.prototype._showChara=function(t){t.pos&&(this.pos=t.pos,"left"===t.pos?(this.left_chara_id=t.chara,this.left_exp=t.exp):"right"===t.pos&&(this.right_chara_id=t.chara,this.right_exp=t.exp))},i.prototype._printMessage=function(t){var e=this;null!==e.timeoutID&&(clearTimeout(e.timeoutID),e.timeoutID=null);var n=t.split(""),i=n.length,r=0;e.line_num=0,e.printing_lines=[];var a=function(){if(!(r>=i)){var t=10,o=n[r];r++,"\n"===o?e.line_num++:(e.printing_lines[e.line_num]||(e.printing_lines[e.line_num]=""),e.printing_lines[e.line_num]=e.printing_lines[e.line_num]+o),e.timeoutID=setTimeout(a,t)}};a()},i.prototype.right_image=function(){return this.right_chara_id?this.right_chara_id+"_"+this.right_exp:null},i.prototype.left_image=function(){return this.left_chara_id?this.left_chara_id+"_"+this.left_exp:null},i.prototype.right_name=function(){return this.right_chara_id?"name_"+this.right_chara_id:null},i.prototype.left_name=function(){return this.left_chara_id?"name_"+this.left_chara_id:null},i.prototype.is_left_talking=function(){return"left"===this.pos?!0:!1},i.prototype.is_right_talking=function(){return"right"===this.pos?!0:!1},i.prototype.lines=function(){return this.printing_lines},e.exports=i},{}],33:[function(t,e,n){"use strict";var i={inherit:function(t,e){var n=function(t){if(Object.create)return Object.create(t);var e=function(){};return e.prototype=t,new e};t.prototype=n(e.prototype),t.prototype.constructor=t},radianToTheta:function(t){return 180*t/Math.PI|0},thetaToRadian:function(t){return t*Math.PI/180},calcMoveXByVelocity:function(t){return t.magnitude*Math.cos(i.thetaToRadian(t.theta))},calcMoveYByVelocity:function(t){return t.magnitude*Math.sin(i.thetaToRadian(t.theta))},hexToRGBString:function(t){var e="#"===t.charAt(0)?t.substring(1,7):t,n=parseInt(e.substring(0,2),16),i=parseInt(e.substring(2,4),16),r=parseInt(e.substring(4,6),16);return"rgb("+n+", "+i+", "+r+")"}};e.exports=i},{}],34:[function(t,e,n){"use strict";var i=function(t,e,n,i,r,a){this.tileDim=i,this.roomDim=r,this.roomMinSize=a,this.floorTiles=e,this.wallTiles=n,this.ambient=t},r=[new i([.1,.1,0],[2,3,3,3,3,3],[2,3],[40,40],[4,4],[5,5]),new i([.1,0,0],[1,2,3],[4],[40,40],[4,4],[4,4]),new i([0,0,.1],[1],[1,2,17,32,33,34,50,51],[45,45],[5,5],[3,3]),new i([0,.1,0],[16,17,19],[4],[50,50],[5,5],[3,3]),new i([.05,0,0],[7],[5],[55,55],[6,6],[3,3]),new i([0,0,0],[176],[192],[55,55],[6,6],[3,3]),new i([0,0,0],[103],[104],[55,55],[6,6],[2,2]),new i([0,0,0],[167],[167],[55,55],[6,6],[1,1])];i.getLevel=function(t){return r[Math.min(Math.floor(t/2),r.length-1)]},e.exports=i},{}],35:[function(t,e,n){"use strict";var i,r=t("./game");window.onload=function(){var t=document.getElementById("mainCanvas");i=new r(t),i.setupEvents(),i.init(),i.startRun()},window.onerror=function(t,e,n,i,r){},window.changeFullScreen=function(){i.fullscreen()}},{"./game":19}],36:[function(t,e,n){"use strict";var i=function(t,e,n,i){this.color=t?t:[1,1,1],this.position=e?e:[0,0,0],this.attenuation=n?n:[.5,.1,0],this.enabled=i?i:!0,this.frame=0};i.prototype.update=function(){for(var t=0;3>t;t++)this.color[t]+=.002*Math.sin(5e-4*this.frame*180/Math.PI);this.frame++},e.exports=i},{}],37:[function(t,e,n){"use strict";var i=t("gl-matrix"),r=t("./shader/world.vs"),a=t("./shader/world.fs"),o=t("./shader/billboard.vs"),s=t("./shader/depth.vs"),l=t("./shader/depth.fs"),u=function(t,e,n){var i=t.createShader(e);if(t.shaderSource(i,n),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS))throw(e==t.VERTEX_SHADER?"Vertex":"Fragment")+" failed to compile:\n\n"+t.getShaderInfoLog(i);return i},h=function(t,e,n){var i=t.createProgram();if(t.attachShader(i,u(t,t.VERTEX_SHADER,e)),t.attachShader(i,u(t,t.FRAGMENT_SHADER,n)),t.linkProgram(i),!t.getProgramParameter(i,t.LINK_STATUS))throw new Error("Could not initialize shaders");return i},c=function(t,e,n,r,a,o){for(var s=h(t,e,n),l={program:s,a:{},u:{},m:{}},u=0;u<r.length;u++)l.a[r[u]]=t.getAttribLocation(s,"a"+r[u]);for(var u=0;u<a.length;u++)l.u[a[u]]=t.getUniformLocation(s,"u"+a[u]);for(var c in o){var f,d=o[c];switch(d){case 2:f=i.mat2;break;case 3:f=i.mat3;break;case 4:f=i.mat4;break;default:console.log("Invalid matrix size")}l.m[c]=f.create(),f.identity(l.m[c])}return l},f=function(t){return{world:c(t,r,a,["Position","Texture","Normal"],["PMatrix","MMatrix","VMatrix","Sampler","LightVMatrix","LightPMatrix","AmbientColor","DepthMap","Light"],{pMatrix:4,mMatrix:4,vMatrix:4}),sprites:c(t,o,a,["Position","Offset","Texture","Moving","Flipped"],["Counter","CamPos","PMatrix","MMatrix","VMatrix","Sampler","AmbientColor","DepthMap","Light"],{}),depth:c(t,s,l,["Position"],["PMatrix","NMatrix","MMatrix"],{pMatrix:4,mMatrix:4,vMatrix:4})}};e.exports=f},{"./shader/billboard.vs":40,"./shader/depth.fs":41,"./shader/depth.vs":42,"./shader/world.fs":43,"./shader/world.vs":44,"gl-matrix":1}],38:[function(t,e,n){"use strict";var i=t("../hakurei").scene.base,r=t("../hakurei").util,a=t("../assets_config"),o=function(t){i.apply(this,arguments)};r.inherit(o,i),o.prototype.init=function(){i.prototype.init.apply(this,arguments);for(var t in a.images)this.core.image_loader.loadImage(t,a.images[t]);for(var e in a.sounds){var n=a.sounds[e];this.core.audio_loader.loadSound(e,n.path,n.volume)}for(var r in a.bgms){var o=a.bgms[r];this.core.audio_loader.loadBGM(r,o.path,1,o.loopStart,o.loopEnd)}},o.prototype.beforeDraw=function(){i.prototype.beforeDraw.apply(this,arguments),this.core.image_loader.isAllLoaded()&&this.core.changeScene("stage")},o.prototype.draw=function(){i.prototype.draw.apply(this,arguments);var t=this.core.ctx;t.save(),t.fillStyle="white",t.fillRect(0,0,this.core.width,this.core.height),t.restore();var e=this.frame_count%60,n=15,r="";r=n>e&&e>=0?"":2*n>e&&e>=1*n?".":3*n>e&&e>=2*n?"..":"...",t.save(),t.fillStyle="rgb( 0, 0, 0 )",t.textAlign="left",t.font="30px 'Migu'",t.fillText("Now Loading"+r,this.core.width-250,this.core.height-50),t.restore(),t.save(),t.fillStyle="rgb(119, 66, 244)",t.fillRect(0,this.core.height-20,this.core.width*this.progress(),50),t.restore()},o.prototype.progress=function(){var t=(this.core.audio_loader.progress()+this.core.image_loader.progress()+this.core.font_loader.progress())/3;return t},e.exports=o},{"../assets_config":12,"../hakurei":21}],39:[function(t,e,n){"use strict";function i(t){return[t[0]+.5,t[1]+.5,t[2]]}Number.prototype.clamp=function(t,e){return t>this?t:this>e?e:this};var r=t("../hakurei").scene.base,a=t("../hakurei").constant,o=t("../hakurei").util,s=(t("../assets_config"),t("../gl")),l=t("../texture"),u=t("../terrain"),h=t("../camera"),c=t("../level"),f=t("../point_light"),d=t("../sprites"),p=t("../dungeon_convert"),m=t("../data"),M=t("gl-matrix"),g=function(t){r.apply(this,arguments)};o.inherit(g,r),g.prototype.init=function(){r.prototype.init.apply(this,arguments),this.canvas=document.getElementById("subCanvas"),this.gl=s(this.canvas),this.data=m(this.gl);var t={};t.land=new l(this.gl,this.core.image_loader.getImage("ldfaithful"),8),t.sprites=new l(this.gl,this.core.image_loader.getImage("oryx"),8),this.counter=0,this.terrain=new u(this.gl,t.land),this.camera=new h,this.levelNum=0,this.level=c.getLevel(this.levelNum),
this.lights=[],this.lights[0]=new f([1,.5,0],[0,0,1],[.3,.1,.05]),this.sprites=new d(this.gl,t.sprites),this.sprites.addSprite(Math.floor(256*Math.random()),[0,0,0]),this.player=this.sprites.sprites[0],this.sprites.addSprite(Math.floor(256*Math.random()),[0,0,1]),this.sprites.sprites[1].maxSpeed*=.8,this.goToLevel(this.levelNum)},g.prototype.goToLevel=function(t){this.level=c.getLevel(t),this.dungeonObj=new p(this.level),this.lights[1]=new f([1,.5,0],i(this.dungeonObj.upstairs),[.2,.1,.05]),this.terrain.generate(this.dungeonObj.cubes),this.player.pos=i(this.dungeonObj.upstairs),this.sprites.sprites[1].pos=i(this.dungeonObj.upstairs),this.sprites.update()},g.prototype.beforeDraw=function(){r.prototype.beforeDraw.apply(this,arguments)},g.prototype.draw=function(){this.gl.clearColor.apply(this,this.data.background),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),M.mat4.perspective(this.data.world.m.pMatrix,45,this.canvas.width/this.canvas.height,.1,100),this.handleInputs(),this.lights[0].position=this.player.pos.slice(0),this.lights[0].position[2]+=2,this.sprites.sprites[1].moveToward(this.terrain,this.player.pos),this.camera.moveCenter(this.player.pos,[0,0,.5]),this.camera.updateMatrix(this.terrain.cubes),this.checkStairs(),this.renderWorld(),this.renderSprites()},g.prototype.renderWorld=function(){this.gl.enable(this.gl.CULL_FACE),this.gl.cullFace(this.gl.BACK),this.gl.useProgram(this.data.world.program),this.data.world.m.vMatrix=this.camera.matrix,this.gl.uniformMatrix4fv(this.data.world.u.MMatrix,!1,this.data.world.m.mMatrix),this.gl.uniformMatrix4fv(this.data.world.u.VMatrix,!1,this.data.world.m.vMatrix),this.gl.uniformMatrix4fv(this.data.world.u.PMatrix,!1,this.data.world.m.pMatrix),this.gl.uniform3fv(this.data.world.u.AmbientColor,this.level.ambient),this.updateLights(this.data.world),this.attribSetup(this.data.world.a.Position,this.terrain.vertexObject,3),this.attribSetup(this.data.world.a.Texture,this.terrain.texCoordObject,2),this.attribSetup(this.data.world.a.Normal,this.terrain.normalObject,3),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.terrain.textureAtlas.texture),this.gl.uniform1i(this.data.world.u.Sampler,0),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.terrain.indexObject),this.gl.drawElements(this.gl.TRIANGLES,this.terrain.numVertices(),this.gl.UNSIGNED_SHORT,0)},g.prototype.updateLights=function(t){for(var e=0;e<this.lights.length;e++)this.lights[e].update(),this.gl.uniform1f(t.u.Light[e].enabled,this.lights[e].enabled),this.gl.uniform3fv(t.u.Light[e].attenuation,this.lights[e].attenuation),this.gl.uniform3fv(t.u.Light[e].color,this.lights[e].color),this.gl.uniform3fv(t.u.Light[e].position,this.lights[e].position)},g.prototype.attribSetup=function(t,e,n,i){i||(i=this.gl.FLOAT),this.gl.enableVertexAttribArray(t),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e),this.gl.vertexAttribPointer(t,n,i,!1,0,0)},g.prototype.renderSprites=function(){this.gl.disable(this.gl.CULL_FACE),this.counter++,this.gl.useProgram(this.data.sprites.program),this.data.world.m.vMatrix=this.camera.matrix,this.sprites.sprites[0].theta=this.camera.theta[2],this.sprites.update(),this.gl.uniformMatrix4fv(this.data.sprites.u.MMatrix,!1,this.data.world.m.mMatrix),this.gl.uniformMatrix4fv(this.data.sprites.u.VMatrix,!1,this.data.world.m.vMatrix),this.gl.uniformMatrix4fv(this.data.sprites.u.PMatrix,!1,this.data.world.m.pMatrix),this.gl.uniform1f(this.data.sprites.u.Counter,this.counter),this.gl.uniform3fv(this.data.sprites.u.AmbientColor,this.level.ambient),this.gl.uniform3fv(this.data.sprites.u.CamPos,this.camera.pos),this.updateLights(this.data.sprites),this.attribSetup(this.data.sprites.a.Position,this.sprites.vertexObject,3),this.attribSetup(this.data.sprites.a.Texture,this.sprites.texCoordObject,2),this.attribSetup(this.data.sprites.a.Offset,this.sprites.offsetObject,3),this.attribSetup(this.data.sprites.a.Moving,this.sprites.movingObject,1),this.attribSetup(this.data.sprites.a.Flipped,this.sprites.flippedObject,1),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.sprites.textureAtlas.texture),this.gl.uniform1i(this.data.sprites.u.Sampler,0),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.sprites.indexObject),this.gl.drawElements(this.gl.TRIANGLES,this.sprites.numVertices(),this.gl.UNSIGNED_SHORT,0)},g.prototype.checkStairs=function(){for(var t=[0,0,0],e=0;3>e;e++)t[e]=Math.floor(this.sprites.sprites[1].pos[e]);t[0]==this.dungeonObj.downstairs[0]&&t[1]==this.dungeonObj.downstairs[1]&&this.goToLevel(++this.levelNum)},g.prototype.handleInputs=function(){this.core.isKeyDown(a.BUTTON_UP)&&this.core.isKeyDown(a.BUTTON_LEFT)?(this.player.flipped=1,this.player.turnAndMove(this.terrain,Math.PI/4)):this.core.isKeyDown(a.BUTTON_DOWN)&&this.core.isKeyDown(a.BUTTON_LEFT)?(this.player.flipped=1,this.player.turnAndMove(this.terrain,.75*Math.PI)):this.core.isKeyDown(a.BUTTON_UP)&&this.core.isKeyDown(a.BUTTON_RIGHT)?(this.player.flipped=0,this.player.turnAndMove(this.terrain,-Math.PI/4)):this.core.isKeyDown(a.BUTTON_DOWN)&&this.core.isKeyDown(a.BUTTON_RIGHT)?(this.player.flipped=0,this.player.turnAndMove(this.terrain,5/4*Math.PI)):this.core.isKeyDown(a.BUTTON_UP)?this.player.turnAndMove(this.terrain,0):this.core.isKeyDown(a.BUTTON_LEFT)?(this.player.flipped=1,this.player.turnAndMove(this.terrain,Math.PI/2)):this.core.isKeyDown(a.BUTTON_DOWN)?this.player.turnAndMove(this.terrain,Math.PI):this.core.isKeyDown(a.BUTTON_RIGHT)&&(this.player.flipped=0,this.player.turnAndMove(this.terrain,-Math.PI/2))},e.exports=g},{"../assets_config":12,"../camera":13,"../data":15,"../dungeon_convert":18,"../gl":20,"../hakurei":21,"../level":34,"../point_light":36,"../sprites":46,"../terrain":47,"../texture":48,"gl-matrix":1}],40:[function(t,e,n){e.exports="#define M_PI 3.1415926535897932384626433832795\n\nattribute vec3 aPosition;\nattribute vec3 aOffset;\nattribute vec2 aTexture;\nattribute float aMoving;\nattribute float aFlipped;\n\nuniform vec3 uCamPos;\nuniform mat4 uMMatrix;\nuniform mat4 uVMatrix;\nuniform mat4 uPMatrix;\nuniform float uCounter;\n\nvarying vec4 vWorldVertex;\nvarying vec3 vWorldNormal;\nvarying vec4 vPosition;\nvarying vec2 vTexture;\n\nconst vec3 camUp = vec3(0.0, 0.0, 1.0);\n\nvoid main(void) {\n	// Billboarding\n	vec3 look = normalize(uCamPos - aPosition);\n	vec3 right = normalize(cross(camUp, look));\n	vec3 up = normalize(cross(look, right));\n\n	vec3 offset = aOffset;\n	if (aMoving > 0.5 && offset.z < 0.5) {\n		// Walking wobble animation\n		float t = mod(1.5*uCounter/M_PI,2.0*M_PI);\n		t = (abs(t-M_PI)-0.5*M_PI)*0.25;\n		float x = offset.x;\n		float z = offset.z;\n		float c = cos(t);\n		float s = sin(t);\n		offset.x = x*c - z*s;\n		offset.z = x*s + z*c;\n		if (x < 0.0)\n			offset.z *= 0.70;\n	}\n	else {\n		// Idle wobble animation\n		float t = mod(uCounter/M_PI,2.0*M_PI);\n\n		vec3 mult = vec3(0.05, 0.0, 0.13);\n		if (offset.x < 0.0)\n			mult.x *= -1.0;\n		if (offset.z > 0.5)\n			mult.z *= -1.0;\n		else\n			mult.z = 0.0;\n\n		offset.x += sin(t)*mult.x;\n		offset.z += cos(t)*mult.z;\n	}\n	if (aFlipped > 0.5)\n		offset.x *= -1.0;\n\n	// Thanks to http://www.gamedev.net/topic/385785-billboard-shader/#entry3550648\n	vec3 vR = offset.x*right;\n	vec3 vU = offset.z*up;\n	vec4 d = vec4(vR+vU+look*0.5, 0.0);\n	vPosition = vWorldVertex =  uMMatrix * (vec4(aPosition, 1.0) + d);\n\n	vWorldNormal = look;\n	vTexture = aTexture;\n\n	gl_Position = uPMatrix * uVMatrix * vWorldVertex;\n}\n\n"},{}],41:[function(t,e,n){e.exports="precision mediump float;\n\nconst float Near = 1.0;\nconst float Far = 30.0;\nconst float LinearDepthConstant = 1.0 / (Far - Near);\n\nvarying vec4 vPosition;\n\n// Via http://devmaster.net/posts/3002/shader-effects-shadow-mapping\nvec4 pack(float depth) {\n	const vec4 bias = vec4(1.0/255.0, 1.0/255.0, 1.0/255.0, 0.0);\n\n	float r = depth;\n	float g = fract(r*255.0);\n	float b = fract(g*255.0);\n	float a = fract(b*255.0);\n	vec4 color = vec4(r, g, b, a);\n\n	return color - (color.yzww * bias);\n}\n\nvoid main(void) {\n	float linearDepth = length(vPosition) * LinearDepthConstant;\n	/*gl_FragColor = pack(linearDepth);*/\n	gl_FragColor = vec4(1.0,0.0,1.0,1.0);\n}\n\n"},{}],42:[function(t,e,n){e.exports="attribute vec3 aPosition;\n\nuniform mat4 uVMatrix;\nuniform mat4 uMMatrix;\nuniform mat4 uPMatrix;\n\nvarying vec4 vPosition;\n\nvoid main(void) {\n	vPosition = uVMatrix * uMMatrix * vec4(aPosition + vec3(-8,-8,-8), 1.0);\n	vPosition += vec4(0,0,-16,0);\n	vPosition = vec4(aPosition, 1.0);\n	gl_Position = uPMatrix * vPosition;\n}\n\n"},{}],43:[function(t,e,n){e.exports="precision mediump float;\n\nconst float Near = 1.0;\nconst float Far = 30.0;\nconst float LinearDepthConstant = 1.0 / (Far - Near);\n\nstruct PointLight\n{\n	float enabled;\n	vec3 color;\n	vec3 position;\n	vec3 attenuation;\n};\n\nvarying vec4 vWorldVertex;\nvarying vec3 vWorldNormal;\nvarying vec4 vPosition;\nvarying vec2 vTexture;\n\nuniform PointLight uLight[4];\nuniform sampler2D uDepthMap;\n\nuniform sampler2D uSampler; // texture coords\nuniform vec3 uAmbientColor;\n\nfloat unpack(vec4 color)\n{\n	const vec4 bitShifts = vec4(1.0, 1.0/255.0, 1.0/(255.0*255.0), 1.0/(255.0*255.0*255.0));\n	return dot(color, bitShifts);\n}\n\nvoid main(void) {\n	vec3 normal = normalize(vWorldNormal);\n	vec4 texColor = texture2D(uSampler, vec2(vTexture.s, vTexture.t));\n	if (texColor.a < 0.1) // Transparent textures\n		discard;\n\n	vec3 color = uAmbientColor;\n\n	for (int i=0; i<4; i++) {\n		if (uLight[i].enabled < 0.5)\n			continue;\n		vec3 lightVec = normalize(uLight[i].position - vWorldVertex.xyz);\n		float l = dot(normal, lightVec);\n\n		if (l <= 0.0)\n			continue;\n\n		float d = distance(vWorldVertex.xyz, uLight[i].position);\n		float a = 1.0/(\n			uLight[i].attenuation.x +\n			uLight[i].attenuation.y*d + \n			uLight[i].attenuation.z*d*d\n		);\n		color += l*a*uLight[i].color;\n	}\n\n	//vec3 depth = vPosition.xyz / vPosition.w;\n	//depth.z = length(vWorldVertex.xyz - uLight[0].position) * LinearDepthConstant;\n	float shadow = 1.0;\n\n	//depth.z *= 0.96; // Offset depth \n	//if (depth.z > unpack(texture2D(uDepthMap, depth.xy)))\n		//shadow *= 0.5;\n\n	gl_FragColor = clamp(vec4(texColor.rgb*color*shadow, texColor.a), 0.0, 1.0);\n}\n\n"},{}],44:[function(t,e,n){e.exports="attribute vec3 aPosition;\nattribute vec3 aNormal;\nattribute vec2 aTexture;\n\nuniform mat4 uMMatrix;\nuniform mat4 uVMatrix;\nuniform mat4 uPMatrix;\n\nuniform mat4 uLightVMatrix;\nuniform mat4 uLightPMatrix;\n\nvarying vec4 vWorldVertex;\nvarying vec3 vWorldNormal;\nvarying vec4 vPosition;\nvarying vec2 vTexture;\n\nvoid main(void) {\n	vWorldVertex = uMMatrix * vec4(aPosition, 1.0);\n	vec4 viewVertex = uVMatrix * vWorldVertex;\n	gl_Position = uPMatrix * viewVertex;\n\n	vTexture = aTexture;\n	vWorldNormal = normalize(mat3(uMMatrix) * aNormal);\n\n	vPosition = uLightPMatrix * uLightVMatrix * vWorldVertex;\n}\n\n"},{}],45:[function(t,e,n){"use strict";var i=function(t){this.pos=t?t:[0,0,0],this.theta=0,this.vel=[0,0,0],this.maxSpeed=.1,this.moving=0,this.flipped=0};i.prototype.moveTo=function(t){this.pos=t,this.moving=0},i.prototype.moveToward=function(t,e){var n=e[0]-this.pos[0],i=e[1]-this.pos[1];Math.abs(n)<.1&&Math.abs(i)<.1||(this.theta=Math.atan2(i,n),this.limitTheta(),this.flipped=this.theta<.5*Math.PI||this.theta>1.5*Math.PI?0:1,this.moveForward(t))},i.prototype.limitTheta=function(){this.theta<0?this.theta+=2*Math.PI:this.theta>2*Math.PI&&(this.theta-=2*Math.PI)},i.prototype.turnAndMove=function(t,e){this.theta+=e,this.moveForward(t),this.theta-=e,this.limitTheta()},i.prototype.moveForward=function(t){this.vel[0]=this.maxSpeed*Math.cos(this.theta),this.vel[1]=this.maxSpeed*Math.sin(this.theta),this.checkCollision(t);for(var e=0;3>e;e++)this.pos[e]+=this.vel[e];this.moving=1},i.prototype.checkCollision=function(t){for(var e=0;3>e;e++)if(0!=this.vel[e]){var n=this.vel[e]>0?.5:-.5,i=this.pos.slice(0);i[e]+=this.vel[e]+n,t.collision(i)&&(this.vel[e]=0)}},e.exports=i},{}],46:[function(t,e,n){"use strict";var i=t("./sprite"),r=function(t,e){this.gl=t,this.textureAtlas=e,this.sprites=[],this.vertices=[],this.offsets=[],this.texCoords=[],this.indices=[],this.moving=[],this.flipped=[],this.baseIndex=0,this.vertexObject=t.createBuffer(),this.texCoordObject=t.createBuffer(),this.offsetObject=t.createBuffer(),this.indexObject=t.createBuffer(),this.movingObject=t.createBuffer(),this.flippedObject=t.createBuffer()};r.prototype.numVertices=function(){return this.indices.length},r.prototype.update=function(){var t;for(t=0;t<this.sprites.length;t++)this.moveSprite(t,this.sprites[t].pos),this.flipSprite(t,this.sprites[t].flipped);for(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexObject),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.vertices),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.texCoordObject),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.texCoords),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.offsetObject),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.offsets),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.movingObject),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.moving),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.flippedObject),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.flipped),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.indexObject),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),t=0;t<this.sprites.length;t++)this.sprites[t].moving=0},r.prototype.addSprite=function(t,e){var n=[[.5,0,1],[-.5,0,1],[-.5,0,0],[.5,0,0]];this.sprites.push(new i(e));for(var r=0;4>r;r++)this.vertices=this.vertices.concat(e),this.offsets=this.offsets.concat(n[r]),this.moving.push(0),this.flipped.push(0);var a=this.textureAtlas.getST(t);this.texCoords=this.texCoords.concat(a[2],a[1],a[0],a[1],a[0],a[3],a[2],a[3]),this.indices.push(this.baseIndex,this.baseIndex+1,this.baseIndex+2,this.baseIndex,this.baseIndex+2,this.baseIndex+3),this.baseIndex+=4},r.prototype.flipSprite=function(t,e){for(var n=0;4>n;n++)this.flipped[4*t+n]=this.sprites[t].flipped},r.prototype.moveSprite=function(t,e){for(var n=0;4>n;n++){this.moving[4*t+n]=this.sprites[t].moving;for(var i=0;3>i;i++)this.vertices[12*t+3*n+i]=e[i]}},r.prototype.offsetSprite=function(t,e){for(var n=0;4>n;n++)for(var i=0;3>i;i++)this.vertices[4*t+3*n+i]+=e[i]},e.exports=r},{"./sprite":45}],47:[function(t,e,n){"use strict";var i=function(t,e){this.gl=t,this.textureAtlas=e,this.cubes=[],this.vertices=[],this.normals=[],this.texCoords=[],this.indices=[],this.baseIndex=0,this.vertexObject=null,this.normalObject=null,this.texCoordObject=null,this.indexObject=null};i.prototype.numVertices=function(){return this.indices.length},i.prototype.collision=function(t,e,n){return t instanceof Array&&(n=t[2],e=t[1],t=t[0]),t=Math.floor(t),e=Math.floor(e),n=Math.floor(n),0>n||n>=this.cubes.length||0>e||e>=this.cubes[n].length||0>t||t>=this.cubes[n][e].length?!0:this.cubes[n][e][t]},i.prototype.generate=function(t){this.cubes=t,this.vertices=[],this.normals=[],this.texCoords=[],this.indices=[],this.baseIndex=0;for(var e=0;e<t.length;e++)for(var n=0;n<t[e].length;n++)for(var i=0;i<t[e][n].length;i++)if(0!=t[e][n][i])if(0!=e){var r=[!0,!0,!0,!0,!0,!0];i>0&&(r[0]=!t[e][n][i-1]),i<t[e][n].length-1&&(r[1]=!t[e][n][i+1]),n>0&&(r[2]=!t[e][n-1][i]),n<t[e].length-1&&(r[3]=!t[e][n+1][i]),e>0&&(r[4]=!t[e-1][n][i]),e<t.length-1&&(r[5]=!t[e+1][n][i]),this.addBlock(t[e][n][i],[i,n,e],r)}else this.addBlock(t[e][n][i],[i,n,e],[!1,!1,!1,!1,!1,!0]);this.gl.deleteBuffer(this.vertexObject),this.gl.deleteBuffer(this.normalObject),this.gl.deleteBuffer(this.texCoordObject),this.gl.deleteBuffer(this.indexObject),this.vertexObject=this.gl.createBuffer(),this.normalObject=this.gl.createBuffer(),this.texCoordObject=this.gl.createBuffer(),this.indexObject=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertexObject),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.vertices),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.normalObject),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.normals),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.texCoordObject),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.texCoords),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.indexObject),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)},i.prototype.addBlock=function(t,e,n){for(var i=[[1,1,1],[0,1,1],[0,0,1],[1,0,1],[1,0,0],[1,1,0],[0,1,0],[0,0,0]],r=0;r<i.length;r++)i[r][0]+=e[0],i[r][1]+=e[1],i[r][2]+=e[2];for(var a=[[-1,0,0],[1,0,0],[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],o=[[2,1,6,7],[0,3,4,5],[3,2,7,4],[1,0,5,6],[6,5,4,7],[0,1,2,3]],s=0;6>s;s++)n[s]&&(this.addFaceVertices(i,o[s]),this.addFaceNormals(a[s]),this.addFaceTexCoords(t,s))},i.prototype.addFaceVertices=function(t,e){for(var n=0;n<e.length;n++)this.vertices=this.vertices.concat(t[e[n]]);this.indices.push(this.baseIndex,this.baseIndex+1,this.baseIndex+2,this.baseIndex,this.baseIndex+2,this.baseIndex+3),this.baseIndex+=4},i.prototype.addFaceNormals=function(t){for(var e=0;4>e;e++)this.normals=this.normals.concat(t)},i.prototype.addFaceTexCoords=function(t,e){if(this.specialTiles.hasOwnProperty(t)){var n=this.specialTiles[t];switch(Array.isArray(n)||(n=this.specialTiles[this.specialTiles[t]]),e){case 2:t=n[0];break;case 4:t=n[3];break;case 5:t=n[2];break;default:t=n[1]}}var i=this.textureAtlas.getST(t);this.texCoords=this.texCoords.concat(i[2],i[1],i[0],i[1],i[0],i[3],i[2],i[3])},i.prototype.specialTiles={3:[3,3,0,2],5:[5,5,6,6],6:5,8:[8,8,9,10],9:8,10:8,20:[20,20,21,21],21:20,43:[59,60,43,43],59:43,60:43,44:[44,45,62,62],45:44,62:44,46:[46,45,62,62],69:[70,70,69,71],70:69,71:69,74:[74,74,75,75],75:74,77:[77,77,78,2],78:77,102:[119,118,102,102],120:[120,118,102,102],118:102,119:102,108:[110,108,109,109],109:108,110:108,116:[20,20,116,116],117:[20,20,117,117],121:[122,122,121,124],122:121,124:121,123:121,136:[136,136,137,137],137:136,138:[154,154,138,155],154:138,155:138,158:[159,159,158,175],159:158,166:[182,182,166,183],182:166,183:166,176:[192,192,176,208],192:176,208:176},e.exports=i},{}],48:[function(t,e,n){"use strict";var i=function(t,e,n){this.gl=t,this.tileSizePx=n,this.imageSizePx=0,this.tileSizeNormalized=0,this.tilesPerRow=0,this.paddingNormalized=0,this.texture=null;var i=this.gl.createTexture();this.handleTexture(e,i)};i.prototype.handleTexture=function(t,e){this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,t),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.texture=e,this.imageSizePx=t.width,this.tileSizeNormalized=this.tileSizePx/this.imageSizePx,this.paddingNormalized=.5/this.imageSizePx,this.tilesPerRow=Math.floor(this.imageSizePx/this.tileSizePx)},i.prototype.getST=function(t){var e=[this.tileSizeNormalized*(t%this.tilesPerRow)+this.paddingNormalized,this.tileSizeNormalized*Math.floor(t/this.tilesPerRow)+this.paddingNormalized];return e[2]=e[0]+this.tileSizeNormalized-1.5*this.paddingNormalized,e[3]=e[1]+this.tileSizeNormalized-1.5*this.paddingNormalized,e},e.exports=i},{}]},{},[35]);